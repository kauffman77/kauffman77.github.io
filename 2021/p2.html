<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-02-17 Fri 12:17 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CSCI 2021 Project 2: Bit Ops and Debugging</title>
<meta name="author" content="Chris Kauffman" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1" />
<style type="text/css">
@media screen {
:root {
--heading-bg-color:#e8c62e;
--heading-fg-color:#7a0019;
}
html {
font-family: serif;
text-align: justify;
}
pre.src, pre.example {
overflow-x: scroll;
}
/* Merge subtitle area with title area */
.subtitle {
text-align: center;
margin-top: -2em;
padding-top: 1em;
padding-bottom: 0.1em;
}
.title, .subtitle {
color: var(--heading-fg-color);
background-color: var(--heading-bg-color);
}
/* Section borders, left section header style */
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
blockquote {
font-style: italic;
}
td, th {
padding-top: 2px;
padding-bottom: 2px;
}
body {
background-color: #EEE;
}
pre {
}
#content, #preamble, #postamble {
margin-left:300px;
max-width: 100%;
}
.tag {
background-color: inherit; font-family: inherit;
padding: inherit; font-size: 80%; font-weight: inherit;
text-transform: uppercase;
}

.figure p { text-align: inherit; }
figure-number { font-style: italic; }
#table-of-contents {
text-align: left;
position: fixed;
left: 0;
margin: 0 auto;
padding: 0;
width: 300px;
top: 0;
height: 100%;
border: 0;
display: block;
}
#text-table-of-contents {
overflow-y: scroll;
height: 100%;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
#table-of-contents > h2 {
padding: 0.1em;
margin: 0;
}
/* adjustments for small screen, toc at top only */
@media (max-width: 800px) { /* landscape for iphone */
html {
-webkit-text-size-adjust: none;  /* prevent scaling of text on mobile */
}
body {
background-color: #EEE;
width:100%;
margin:0 auto;
}
#content, #preamble, #postamble {
margin-left:0;
}
#table-of-contents {
position: static;
left: inherit;
width:inherit;
height: auto;
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
border: 0.75em solid #006633;
}
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
#text-table-of-contents {
overflow-y: visible;
height: inherit;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
}
.linenr { font-size: xx-small; }
}

@media print {
html {
font-family: serif;
font-size: 10pt;
text-align: justify;
.linenr { font-size: xx-small; }
}
}
</style>
</head>
<body>
<div id="preamble" class="status">
<i>Last Updated: 2023-02-17 Fri 12:17</i>
</div>
<div id="content" class="content">
<h1 class="title">CSCI 2021 Project 2: Bit Ops and Debugging</h1>
<ul class="org-ul">
<li><b>Due: 11:59pm Mon 27-Feb-2023</b></li>
<li><i>Approximately 3.0-4.0% of total grade</i></li>
<li>Submit to <a href="https://www.gradescope.com/"><b>Gradescope</b></a></li>
<li>Projects are <b>individual work</b>: no collaboration with other students
is allowed. Seek help from course staff if you get stuck for too long.</li>
</ul>

<div id="outline-container-org4b58b73" class="outline-4">
<h4 id="org4b58b73">CODE/TEST DISTRIBUTION: <a href="p2-code.zip">p2-code.zip</a></h4>
</div>

<div id="outline-container-orgfc13f16" class="outline-4">
<h4 id="orgfc13f16">VIDEO OVERVIEW: <i>Not Yet Available</i></h4>
</div>
<div id="outline-container-orgea7f22a" class="outline-4">
<h4 id="orgea7f22a">CHANGELOG: <i>Empty</i></h4>
</div>
<div id="outline-container-org03782f8" class="outline-4">
<h4 id="org03782f8"></h4>
<div class="outline-text-4" id="text-org03782f8">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgef55830">1. Introduction</a></li>
<li><a href="#orge462c41">2. Download Code and Setup</a></li>
<li><a href="#orgcdc9592">3. <b>Problem 1</b>: Digital Clock Simulation</a>
<ul>
<li><a href="#org8a5eccb">3.1. Overview</a></li>
<li><a href="#org04b69fb">3.2. Diagrams of Digits</a></li>
<li><a href="#org08446bd">3.3. Diagram of Time Display</a></li>
<li><a href="#orgf64455c">3.4. <code>clock_update.c</code>: Updating the Display with User Code</a></li>
<li><a href="#org021827a">3.5. Clock Simulator</a></li>
<li><a href="#orgaf32416">3.6. Sample Runs of <code>clock_main</code></a></li>
<li><a href="#org57a1e35">3.7. Problem 1 Grading Criteria</a></li>
</ul>
</li>
<li><a href="#org348e620">4. <b>Problem 2</b>: Debugging the Puzzlebox</a>
<ul>
<li><a href="#org3d3ae28">4.1. Overview</a></li>
<li><a href="#orgbda30e7">4.2. <code>input.txt</code> Input File</a></li>
<li><a href="#org14f18e5">4.3. <code>gdb</code> The GNU Debugger</a></li>
<li><a href="#orgf04a9ad">4.4. Typical Cycle</a></li>
<li><a href="#org8c3e70b">4.5. Kinds of Puzzles</a></li>
<li><a href="#orgb8a5460">4.6. Tests for <code>puzzlebox.c</code></a></li>
</ul>
</li>
<li><a href="#orgc25865c">5. Assignment Submission</a>
<ul>
<li><a href="#orga63447b">5.1. Submit to Gradescope</a></li>
<li><a href="#org760208b">5.2. Late Policies</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgef55830" class="outline-2">
<h2 id="orgef55830"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
<b>Bit-level operations</b> are common in C and systems programming.  This
assignment features a problem in which shifting and bitwise AND/OR-ing
are required to complete the requirements.
</p>

<p>
Debugging is also a critical skill enabled by the <b>debugger</b>. The
second problem in the assignment makes use of the GNU Debugger, <code>gdb</code>,
to work through a puzzle program requiring specific inputs to pass its
"phases".
</p>
</div>

<div id="outline-container-orgcc503fc" class="outline-4">
<h4 id="orgcc503fc">Makefile</h4>
<div class="outline-text-4" id="text-orgcc503fc">
<p>
As in the first assignment, a <code>Makefile</code> is provided as part of this
project. The essential targets pertinent to each problem are described
in those sections. The <code>Makefile</code> is equipped with a brief help
listing:
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; make help
Typical usage is:
  &gt; make                          # build all programs
  &gt; make clean                    # remove all compiled items
  &gt; make zip                      # create a zip file for submission
  &gt; make prob1                    # built targets associated with problem 1
  &gt; make test-prob1 testnum=5     # run problem 1 test #5 only
  &gt; make test-prob2               # run test for problem 2
  &gt; make test                     # run all tests
</pre>
</div>
</div>
</div>


<div id="outline-container-orgcd4e657" class="outline-4">
<h4 id="orgcd4e657">Automated Tests</h4>
<div class="outline-text-4" id="text-orgcd4e657">
<p>
As in previous assignments, automated tests are provided and
associated with problems. Each problem describes how to run tests
associated with it. Generally this is done as before:
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; make test-prob1
gcc -Wall -Wno-comment -Werror -g  -c clock_main.c
gcc -Wall -Wno-comment -Werror -g  -c clock_sim.c
...
./testy test_prob1.org 
============================================================
== test_prob1.org : Problem 1 test_clock_update and clock_main tests
== Running 35 / 35 tests
1)  test_clock_update midnight-set           : ok
2)  test_clock_update after-midnight-set     : ok
3)  test_clock_update after-1am-set          : ok
4)  test_clock_update nearly-noon-set        : ok
5)  test_clock_update is-noon-set            : ok
...

&gt; make test-prob2         # run "tests" associated with problem 2
... 
&gt; ./puzzlebox input.txt   # same as above: run puzzlebox to test answers
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orge462c41" class="outline-2">
<h2 id="orge462c41"><span class="section-number-2">2</span> <a id="org9dae970"></a> Download Code and Setup</h2>
<div class="outline-text-2" id="text-2">
<p>
Download the code pack linked at the top of the page. Unzip this which
will create a project folder. Create new files in this
folder. Ultimately you will re-zip this folder to submit it.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">File</th>
<th scope="col" class="org-left">State</th>
<th scope="col" class="org-left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>Makefile</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Build file to compile all programs</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>clock_update.c</code></td>
<td class="org-left">CREATE</td>
<td class="org-left">Create this file and write required function in it to complete Problem 1</td>
</tr>

<tr>
<td class="org-left"><code>clock.h</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 header file</td>
</tr>

<tr>
<td class="org-left"><code>clock_main.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 main() function for clockmeter simulation</td>
</tr>

<tr>
<td class="org-left"><code>clock_sim.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 suppor functions to assist with simulating clock device</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>test_clock_update.c</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Problem 1 functions tests for <code>clock_upate.c</code></td>
</tr>

<tr>
<td class="org-left"><code>test_clock.org</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Problem 1 testing data file</td>
</tr>

<tr>
<td class="org-left"><code>testy</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Problem 1 test running script</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>clock_examples.sh</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 script to produce a variety of clock examples</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>puzzlebox.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 2 Debugging problem</td>
</tr>

<tr>
<td class="org-left"><code>input.txt</code></td>
<td class="org-left">CREATE</td>
<td class="org-left">Problem 2 Input for <code>puzzlebox</code>, fill this in</td>
</tr>

<tr>
<td class="org-left"><code>sample-input.txt</code></td>
<td class="org-left">COPY-TO</td>
<td class="org-left">Problem 2 sample input file, copy this to <code>input.txt</code></td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-orgcdc9592" class="outline-2">
<h2 id="orgcdc9592"><span class="section-number-2">3</span> <b>Problem 1</b>: Digital Clock Simulation</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org8a5eccb" class="outline-3">
<h3 id="org8a5eccb"><span class="section-number-3">3.1</span> Overview</h3>
<div class="outline-text-3" id="text-3-1">
<p>
You are tasked with writing code which will be run by a
microcontroller in a digital clock.  The hardware has the following
relevant features.
</p>
<ul class="org-ul">
<li>An internal clock that increments 16 time per second. The value
reported by the clock is stored in a special hardware location that
is presented as a global variable.</li>
<li>A digital display with a control port; setting certain global
variable will change the display to show information to a user of
the clock.</li>
<li>User code that you will need to write to update the display based on
the value reported by the internal clock.</li>
<li>A simulator program with <code>Makefile</code> to test your code</li>
</ul>
<p>
Each feature is discussed in subsequent sections.
</p>
</div>

<div id="outline-container-orgb38d16d" class="outline-4">
<h4 id="orgb38d16d">Time of Day Register</h4>
<div class="outline-text-4" id="text-orgb38d16d">
<p>
A special register is periodically updated to contain an integer that
reflects how much time has passed since the beginning of the day.
This special hardware location is accessible in C programs via a
global variable:
</p>
<div class="org-src-container">
<pre class="src src-c">extern int TIME_OF_DAY_PORT;
// Time of day in units of 1/16th of a second. Tied to a hardware
// clock that automatically increments it 16 times per second starting
// at midnight. The simulatator provides a C global variable to
// emulate this part of the hardware. This variable is present when
// #include "clock.h" is used and should not be declared in any user
// code.
</pre>
</div>
<p>
You do not need to define this variable as it is already there. You
do not need to set this variable as it is automatically changed by
the hardware.  Instead, you will need to access its value to
determine various aspects of the current time relevant to display.
</p>
<ul class="org-ul">
<li>Calculate the total number of seconds since midnight and round this
up if 8/16th or more of a second has passed. This can be done using
bit shift and mask operations due to the power of 2 involved.</li>
<li>Whether it is AM or PM (AM is hours 12midnight to 11:59am, PM if
12noon to 11:59pm)</li>
<li>The hour of the day (12-hour format so this is 1-12)</li>
<li>The ones and tens digits in the hour (blank or 1 for tens, 0-9 for ones)</li>
<li>The time in minutes (0-59)</li>
<li>The ones and tens digits in the minutes (0-5 for tens, 0-9 for ones)</li>
</ul>
</div>
</div>

<div id="outline-container-orgaaadd31" class="outline-4">
<h4 id="orgaaadd31">Clock Display Port Register</h4>
<div class="outline-text-4" id="text-orgaaadd31">
<p>
A special register controls the display of the LCD clock.  This
register is accessible in C programs via a global variable.
</p>
<div class="org-src-container">
<pre class="src src-c">extern int CLOCK_DISPLAY_PORT;
// Global variable used to control the LCD display on the
// clock. Making changes to this variable will change the clock
// time. Type ensures 32 bits.
</pre>
</div>
<p>
Your code can examine the current values of the register but this is
not relevant to the present problem. More importantly you will need to
set the bits of this variable to properly show the time.
</p>
</div>
</div>
</div>

<div id="outline-container-org04b69fb" class="outline-3">
<h3 id="org04b69fb"><span class="section-number-3">3.2</span> Diagrams of Digits</h3>
<div class="outline-text-3" id="text-3-2">
<p>
The following diagram shows bit patterns for various digits and how
they will be displayed in the ones digit of the minutes place.
Digits are displayed by darkening certain <b>bars</b> in the display which
correspond to certain bits in the <code>CLOCK_DISPLAY_PORT</code> register being
set. 
</p>

<div class="org-center">

<div id="org39f3537" class="figure">
<p><img src="digital-digits-topdown.png" alt="digital-digits-topdown.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 1: </span>Bit to clock display bar correspondence for the ones digit of the minute.  The 0th bit controls the upper horizontal bar, the 1th bit controls the horizontal bar counter-clockwise from it, and so on around the 6 outer bars in a counter-clockwise fashion. The 6th bit controls the middle horizontal bar. When a bit is 1 (set), the bar will be darkened while when the bit is 0 (clear) the bar will not be displayed (shown as empty).  The combinations of bits shown are the only ones that arise when showing digits for times.</p>
</div>
</div>


<p>
Notice the following.
</p>
<ul class="org-ul">
<li>Bits that are set (equal to 1) will turn on (darken) one <b>bar</b> of
the clock digit</li>
<li>Bits that are clear (equal to 0) will turn off one bar of the digit</li>
<li>7 bits are required to control the display of one digit</li>
<li>The bits are arranged with the low order bit (bit 0) at the top and
progress counter-clockwise around the digit.
<ul class="org-ul">
<li>Bit 0 top</li>
<li>Bit 1 upper left</li>
<li>Bit 2 upper right</li>
<li>Bit 3 middle</li>
<li>Bit 4 lower left</li>
<li>Bit 5 lower right</li>
<li>Bit 6 bottom</li>
</ul></li>
<li>The programmer can set bits to any pattern which will be displayed
but only patterns shown in the figure correspond to digits of
interest.</li>
</ul>
</div>
</div>

<div id="outline-container-org08446bd" class="outline-3">
<h3 id="org08446bd"><span class="section-number-3">3.3</span> Diagram of Time Display</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Time is displayed with several adjacent digits along with an AM/PM
display.  The diagram below shows two full times along with the bits
representing the digits.  The bits correspond to how the global
variable <code>CLOCK_DISPLAY_PORT</code> should be set in order to make the clock
appear as it does.
</p>

<div class="org-center">

<div id="orga673e20" class="figure">
<p><img src="digital-clock-topdown.png" alt="digital-clock-topdown.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 2: </span>Two full examples of how the 30 bits of the clock display state control which parts of the clock are shown.  Each digit follows the same pattern of bit to bar correspondence as the right-most with bits. The lowest order (rightmost) bit controls the top bar of each digit and proceed around the outside counter-clockwise with the final bit for each digit controlling the middle bar.  The highest order bits (28 and 29) control whether the "AM" or "PM" lights are shown. Note that both could be shown at the same time or neither shown but this should not be done for actual times.</p>
</div>
</div>

<p>
Notice the following.
</p>
<ul class="org-ul">
<li>You may presume that the <code>CLOCK_DISPLAY_PORT</code> register is a 32-bit
integer.</li>
<li>30 bits are used to control the full clock display.</li>
<li>Bits 0-6 control the ones place of the minutes</li>
<li>Bits 7-13 control the tens place of the minutes</li>
<li>Bits 14-20 control the ones place of the hours</li>
<li>Bits 21-27 control the tens place of the hours</li>
<li>Bit 28 controls whether AM is displayed</li>
<li>Bit 29 controls whether PM is displayed</li>
<li>Bits 30 and 31 are not used and should always be 0.</li>
</ul>
</div>
</div>


<div id="outline-container-orgf64455c" class="outline-3">
<h3 id="orgf64455c"><span class="section-number-3">3.4</span> <code>clock_update.c</code>: Updating the Display with User Code</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Periodically the microcontroller will run code to adjust the LCD
display for the clock to show the current time.  This function is
called:
</p>
<pre class="example">
clock_update()
</pre>

<p>
and it will be your job to write this function.
</p>

<p>
Rather than write everything that needs to be done within
<code>clock_update()</code>, several helper functions will be used to divide this
task into several more manageable and testable chunks.
</p>

<p>
These should all be written in <code>clock_update.c</code> and are as follows.
</p>
</div>



<div id="outline-container-org4c9b013" class="outline-4">
<h4 id="org4c9b013">Converting time of Day in Seconds to a Struct</h4>
<div class="outline-text-4" id="text-org4c9b013">
<div class="org-src-container">
<pre class="src src-c">int set_tod_from_secs(tod_t *tod);
// Reads the time of day from the TIME_OF_DAY_PORT global variable. If
// the port's value is invalid (negative or larger than 16 times the
// number of seconds in a day) does nothing to tod and returns 1 to
// indicate an error. Otherwise, this function uses the port value to
// calculate the number of seconds from start of day (port value is
// 16*number of seconds from midnight). Rounds seconds up if there at
// least 8/16 have passed. Uses shifts and masks for this calculation
// to be efficient. Then uses division on the seconds since the
// begining of the day to calculate the time of day broken into hours,
// minutes, seconds, and sets the AM/PM designation with 1 for AM and
// 2 for PM. By the end, all fields of the `tod` struct are filled in
// and 0 is returned for success.
 // 
// CONSTRAINT: Uses only integer operations. No floating point
// operations are used as the target machine does not have a FPU.
// 
// CONSTRAINT: Limit the complexity of code as much as possible. Do
// not use deeply nested conditional structures. Seek to make the code
// as short, and simple as possible. Code longer than 40 lines may be
// penalized for complexity.
</pre>
</div>

<p>
This function works with the <code>struct tod_t</code> defined in <code>clock.h</code> which
has the following layout.
</p>
<div class="org-src-container">
<pre class="src src-c">// Breaks time down into 12-hour format
typedef struct{
  int   day_secs;    // seconds from start of day
  short time_secs;   // seconds in current hour
  short time_mins;   // minutes in current hour
  short time_hours;  // current hour of day
  char ampm;         // 1 for am, 2 for pm
} tod_t;
</pre>
</div>

<p>
Calculating <code>day_secs</code> should be done using bitwise operations: shifts
and logical operations. Once the <code>day_secs</code> has been determined, the
process of filling in values is simply a matter of doing some
division/modulo and assigning field values.
</p>

<p>
<b>HINT</b>: Review the correspondence between right shift operations and
division and note that any bits shifted off would be the remainder
of a division.
</p>
</div>
</div>

<div id="outline-container-orgbbcfc71" class="outline-4">
<h4 id="orgbbcfc71">Setting bits in an integer according to a <code>tod_t</code></h4>
<div class="outline-text-4" id="text-orgbbcfc71">
<div class="org-src-container">
<pre class="src src-c">int set_display_from_tod(tod_t tod, int *display);
// Accepts a tod and alters the bits in the int pointed at by display
// to reflect how the LCD clock should appear. If any time_** fields
// of tod are negative or too large (e.g. bigger than 12 for hours,
// bigger than 59 for min/sec) or if the AM/PM is not 1 or 2, no
// change is made to display and 1 is returned to indicate an
// error. The display pattern is constructed via shifting bit patterns
// representing digits and using logical operations to combine them.
// May make use of an array of bit masks corresponding to the pattern
// for each digit of the clock to make the task easier.  Returns 0 to
// indicate success. This function DOES NOT modify any global
// variables
// 
// CONSTRAINT: Limit the complexity of code as much as possible. Do
// not use deeply nested conditional structures. Seek to make the code
// as short, and simple as possible. Code longer than 85 lines may be
// penalized for complexity.
</pre>
</div>

<p>
This function will need to do bit shifting along with bitwise
operations to construct the correct bit patter for the clock display.  
</p>

<p>
A good trick to use is to create a series of bit patterns that
correspond to the various digits. For example, according to the
diagrams above, the bit patter for <code>9</code> is <code>0b1101111</code>.  If a <code>9</code>
should appear on the clock somewhere, this bit pattern should be
shifted and combined with the existing bits in <code>display</code> so that a 9
will show.  Creating similar constant <i>mask</i> patterns for each digit
and AM/PM is a good way to simplify this problem. 
</p>

<p>
A detailed explanation of one approach to the problem:
</p>
<ul class="org-ul">
<li>Create an array of bit masks for each of the digits 0-9. The 0th
element of the array contains a bit mask like <code>0b1110111</code> which
represents the bits that should be set for a 0 digit, the 1th
element of this array has a mask like <code>0b0110000</code> which are the bits
to be set for a 1. There should be ten entries in this array in
indices 0-9.</li>
<li>Use modulo to determine the integer value for the ones and tens
digits for both hours and minutes. Call these variables something
like <code>min_ones</code> and <code>min_tens</code> and similarly for hours. Each
variable should be in the range 0-9.</li>
<li>Start with a state variable of 0 (all 0 bits).</li>
<li>Use <code>min_ones</code> to index into your array of masks to determine the
bits that should be set for it. Combine the state variable with
<code>min_ones</code> mask.</li>
<li>Combining bits here is a logical operation of setting all bits that
are one in the mask to 1 in the state variable.</li>
<li>Use <code>min_tens</code> to index into your array of masks for the right mask
for that digit. The bits corresponding to the tens place of the
minutes is shifted to the left by 7 bits so shift the mask to the
left and combine it with the state variable.</li>
<li>Repeat this process for the ones digit of the hours (shifted by 14
to the left) and the tens digit of the hour (shifted by
21).</li>
<li>The tens digit of the hour is special in that it should be either 1
or blank (don't show a 0 for hours 1-9) so adjust your mask
appropriately before shifting.</li>
<li>Set the 28th bit of the state if the time is in the AM or the 29th
bit if time is in the PM.</li>
<li>The state variable should now be populated.</li>
</ul>
</div>
</div>


<div id="outline-container-org140f4d3" class="outline-4">
<h4 id="org140f4d3">Changing the clock display</h4>
<div class="outline-text-4" id="text-org140f4d3">
<div class="org-src-container">
<pre class="src src-c">int clock_update();
// Examines the TIME_OF_DAY_PORT global variable to determine hour,
// minute, and am/pm.  Sets the global variable CLOCK_DISPLAY_PORT bits
// to show the proper time.  If TIME_OF_DAY_PORT appears to be in error
// (to large/small) makes no change to CLOCK_DISPLAY_PORT and returns 1
// to indicate an error. Otherwise returns 0 to indicate success.
//
// Makes use of the previous two functions: set_tod_from_ports() and
// set_display_from_tod().
// 
// CONSTRAINT: Does not allocate any heap memory as malloc() is NOT
// available on the target microcontroller.  Uses stack and global
// memory only.
</pre>
</div>
<p>
This function makes use of the previous two functions and the global
variables that correspond to the clock hardware to alter the
display. It should be relatively short by making use of the previous
functions. 
</p>
</div>
</div>
</div>

<div id="outline-container-org021827a" class="outline-3">
<h3 id="org021827a"><span class="section-number-3">3.5</span> Clock Simulator</h3>
<div class="outline-text-3" id="text-3-5">
<p>
While we do not have actual hardware with the features mentioned, a
simulator for the clock system is in the provided files <code>clock_main.c</code>
and <code>clock_sim.c</code>.  You do not need to modify or understand code in
either file to complete the HW though it will certainly expand you C
skills to spend some time examining them.
</p>

<p>
The <code>main()</code> function in <code>clock_main.c</code> accepts a command line argument
which is a number of seconds since the beginning of the day and will
call your functions for this problem and show results for it.  You are
encouraged to use this function to test your code incrementally
</p>
<ul class="org-ul">
<li>Examine whether <code>set_tod_from_secs()</code> is correct based on the first
part of output in <code>clock_main.c</code></li>
<li>Once <code>set_tod_from_secs()</code> is complete, examine whether the output
of <code>set_display_from_tod()</code> is correct based on the latter part
of the output.</li>
<li>Once both these functions are correct, examine whether
<code>cock_update()</code> is correct based on the final part of the output of
the <code>main()</code> function.</li>
</ul>

<p>
Note that there are a variety of functions in the file <code>clock_sim.c</code>
which are used to simulate how the clock will display. This is also
where the global variables <code>CLOCK_DISPLAY_PORT</code> and <code>TIME_OF_DAY_SEC</code>
are defined.  However, you do not need to modify or even understand
the code in <code>clock_sim.c</code>. It is only used to show how the clock would
look when the <code>CLOCK_DISPLAY_PORT</code> bits are set.
</p>
</div>
</div>

<div id="outline-container-orgaf32416" class="outline-3">
<h3 id="orgaf32416"><span class="section-number-3">3.6</span> Sample Runs of <code>clock_main</code></h3>
<div class="outline-text-3" id="text-3-6">
<p>
You can build the <code>clock_main</code> executable via
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; make
OR
&gt; make clock_main
</pre>
</div>
<p>
Below are samples generated by compiling and running the <code>main()</code>
function in the <code>clock_main.c</code> file.  The code is compiled by using the
provided <code>Makefile</code> to create the <code>clock_main</code> program.  It compiles the
<code>clock_sim.c</code> library along with the functions you write in the file
<code>clock_update.c</code> and the <code>main()</code> in <code>clock_main.c</code>.
</p>

<pre class="example" id="org1f13b18">
&gt; make clock_main
make: 'clock_main' is up to date.

&gt; ./clock_main 0
TIME_OF_DAY_PORT set to: 0
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 0
  .time_hours = 12
  .time_mins  = 0
  .time_secs  = 0
  .ampm       = 1
}              
Simulated time is: 12 : 00 : 00 am
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 01 0100100 1011101 1110111 1110111
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 01 0100100 1011101 1110111 1110111
index: 30 28      21      14       7       0

Clock Display:
   # ####   #### ####   
   #    #   #  # #  #   
   #    # o #  # #  #   
   # ####   #  # #  #   
   # #    o #  # #  #   
   # #      #  # #  # AM
   # ####   #### ####   


&gt; ./clock_main 16
TIME_OF_DAY_PORT set to: 16
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 1
  .time_hours = 12
  .time_mins  = 0
  .time_secs  = 1
  .ampm       = 1
}              
Simulated time is: 12 : 00 : 01 am
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 01 0100100 1011101 1110111 1110111
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 01 0100100 1011101 1110111 1110111
index: 30 28      21      14       7       0

Clock Display:
   # ####   #### ####   
   #    #   #  # #  #   
   #    # o #  # #  #   
   # ####   #  # #  #   
   # #    o #  # #  #   
   # #      #  # #  # AM
   # ####   #### ####   


&gt; ./clock_main 89
TIME_OF_DAY_PORT set to: 89
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 6
  .time_hours = 12
  .time_mins  = 0
  .time_secs  = 6
  .ampm       = 1
}              
Simulated time is: 12 : 00 : 06 am
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 01 0100100 1011101 1110111 1110111
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 01 0100100 1011101 1110111 1110111
index: 30 28      21      14       7       0

Clock Display:
   # ####   #### ####   
   #    #   #  # #  #   
   #    # o #  # #  #   
   # ####   #  # #  #   
   # #    o #  # #  #   
   # #      #  # #  # AM
   # ####   #### ####   


&gt; ./clock_main 961
TIME_OF_DAY_PORT set to: 961
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 60
  .time_hours = 12
  .time_mins  = 1
  .time_secs  = 0
  .ampm       = 1
}              
Simulated time is: 12 : 01 : 00 am
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 01 0100100 1011101 1110111 0100100
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 01 0100100 1011101 1110111 0100100
index: 30 28      21      14       7       0

Clock Display:
   # ####   ####    #   
   #    #   #  #    #   
   #    # o #  #    #   
   # ####   #  #    #   
   # #    o #  #    #   
   # #      #  #    # AM
   # ####   ####    #   


&gt; ./clock_main 72115
TIME_OF_DAY_PORT set to: 72115
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 4507
  .time_hours = 1
  .time_mins  = 15
  .time_secs  = 7
  .ampm       = 1
}              
Simulated time is: 01 : 15 : 07 am
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 01 0000000 0100100 0100100 1101011
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 01 0000000 0100100 0100100 1101011
index: 30 28      21      14       7       0

Clock Display:
        #      # ####   
        #      # #      
        # o    # #      
        #      # ####   
        # o    #    #   
        #      #    # AM
        #      # ####   


&gt; ./clock_main 612199
TIME_OF_DAY_PORT set to: 612199
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 38262
  .time_hours = 10
  .time_mins  = 37
  .time_secs  = 42
  .ampm       = 1
}              
Simulated time is: 10 : 37 : 42 am
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 01 0100100 1110111 1101101 0100101
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 01 0100100 1110111 1101101 0100101
index: 30 28      21      14       7       0

Clock Display:
   # ####   #### ####   
   # #  #      #    #   
   # #  # o    #    #   
   # #  #   ####    #   
   # #  # o    #    #   
   # #  #      #    # AM
   # ####   ####    #   


&gt; ./clock_main 691191
TIME_OF_DAY_PORT set to: 691191
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 43199
  .time_hours = 11
  .time_mins  = 59
  .time_secs  = 59
  .ampm       = 1
}              
Simulated time is: 11 : 59 : 59 am
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 01 0100100 0100100 1101011 1101111
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 01 0100100 0100100 1101011 1101111
index: 30 28      21      14       7       0

Clock Display:
   #    #   #### ####   
   #    #   #    #  #   
   #    # o #    #  #   
   #    #   #### ####   
   #    # o    #    #   
   #    #      #    # AM
   #    #   #### ####   


&gt; ./clock_main 691196
TIME_OF_DAY_PORT set to: 691196
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 43200
  .time_hours = 12
  .time_mins  = 0
  .time_secs  = 0
  .ampm       = 2
}              
Simulated time is: 12 : 00 : 00 pm
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 10 0100100 1011101 1110111 1110111
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 10 0100100 1011101 1110111 1110111
index: 30 28      21      14       7       0

Clock Display:
   # ####   #### ####   
   #    #   #  # #  #   
   #    # o #  # #  #   
   # ####   #  # #  #   
   # #    o #  # #  #   
   # #      #  # #  #   
   # ####   #### #### PM


&gt; ./clock_main 852045
TIME_OF_DAY_PORT set to: 852045
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 53253
  .time_hours = 2
  .time_mins  = 47
  .time_secs  = 33
  .ampm       = 2
}              
Simulated time is: 02 : 47 : 33 pm
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 10 0000000 1011101 0101110 0100101
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 10 0000000 1011101 0101110 0100101
index: 30 28      21      14       7       0

Clock Display:
     ####   #  # ####   
        #   #  #    #   
        # o #  #    #   
     ####   ####    #   
     #    o    #    #   
     #         #    #   
     ####      #    # PM


&gt; ./clock_main 1037010
TIME_OF_DAY_PORT set to: 1037010
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 64813
  .time_hours = 6
  .time_mins  = 0
  .time_secs  = 13
  .ampm       = 2
}              
Simulated time is: 06 : 00 : 13 pm
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 10 0000000 1111011 1110111 1110111
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 10 0000000 1111011 1110111 1110111
index: 30 28      21      14       7       0

Clock Display:
     ####   #### ####   
     #      #  # #  #   
     #    o #  # #  #   
     ####   #  # #  #   
     #  # o #  # #  #   
     #  #   #  # #  #   
     ####   #### #### PM


&gt; ./clock_main 1368626
TIME_OF_DAY_PORT set to: 1368626
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 85539
  .time_hours = 11
  .time_mins  = 45
  .time_secs  = 39
  .ampm       = 2
}              
Simulated time is: 11 : 45 : 39 pm
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 10 0100100 0100100 0101110 1101011
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 10 0100100 0100100 0101110 1101011
index: 30 28      21      14       7       0

Clock Display:
   #    #   #  # ####   
   #    #   #  # #      
   #    # o #  # #      
   #    #   #### ####   
   #    # o    #    #   
   #    #      #    #   
   #    #      # #### PM


&gt; ./clock_main 1382386
TIME_OF_DAY_PORT set to: 1382386
result = set_tod_from_ports(&amp;tod );
result: 0
tod = {
  .day_secs   = 86399
  .time_hours = 11
  .time_mins  = 59
  .time_secs  = 59
  .ampm       = 2
}              
Simulated time is: 11 : 59 : 59 pm
result = set_display_from_tod(tod, &amp;display);
result: 0
display is
bits:  00 10 0100100 0100100 1101011 1101111
index: 30 28      21      14       7       0

result = clock_update();
result: 0
CLOCK_DISPLAY_PORT is
bits:  00 10 0100100 0100100 1101011 1101111
index: 30 28      21      14       7       0

Clock Display:
   #    #   #### ####   
   #    #   #    #  #   
   #    # o #    #  #   
   #    #   #### ####   
   #    # o    #    #   
   #    #      #    #   
   #    #   #### #### PM


&gt; ./clock_main 1426225
TIME_OF_DAY_PORT set to: 1426225
result = set_tod_from_ports(&amp;tod );
result: 1
tod = {
  .day_secs   = 541404448
  .time_hours = 0
  .time_mins  = 0
  .time_secs  = 32604
  .ampm       = 0
}              
Simulated time is: 00 : 00 : 32604 pm
WARNING: Non-zero value returned
result = set_display_from_tod(tod, &amp;display);
result: 1
display is
bits:  00 00 0000000 0000000 0000000 0000000
index: 30 28      21      14       7       0
WARNING: Non-zero value returned

result = clock_update();
result: 1
CLOCK_DISPLAY_PORT is
bits:  00 00 0000000 0000000 0000000 0000000
index: 30 28      21      14       7       0
WARNING: Non-zero value returned

Clock Display:
                        
                        
          o             
                        
          o             
                        
                        


</pre>
</div>
</div>

<div id="outline-container-org57a1e35" class="outline-3 grading 50">
<h3 id="org57a1e35"><span class="section-number-3">3.7</span> Problem 1 Grading Criteria&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading">grading</span>&#xa0;<span class="50">50</span></span></h3>
<div class="outline-text-3" id="text-3-7">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Weight</th>
<th scope="col" class="org-left">Criteria</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">AUTOMATED TESTS</td>
</tr>

<tr>
<td class="org-right">35</td>
<td class="org-left"><code>make test-prob1</code> which uses programs <code>test_clock_update</code> and <code>clock_main</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Provides 35 tests for functions in <code>clock_update.c</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">1 point per test passed</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">MANUAL INSPECTION of <code>clock_update.c</code></td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left"><code>set_tod_from_secs()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear effort to do error checking of out of bounds values.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear flow to how each field of <code>tod</code> is calculated.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Correctly setting fields of <code>tod</code> via pointer dereference or arrow operator.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Makes use of shift / logical operations to convert port value to seconds</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Adherence to constraints: no floats, no float math ops, no deeply nested conditionals</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left"><code>set_display_from_tod()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear effort to do error checking for out of bounds values in <code>tod</code> parameter</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear code that calculates digits to be displayed</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of bit masks corresponding to digits to be displayed</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of bitwise operators to shift bits appropriately</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of bitwise operators to combine shifted digit bits</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear derference/set of the integer pointed to by the <code>display</code> parameter</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Adherence to constraints: no floats, no math float ops, no deeply nested conditionals</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left"><code>clock_update()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of the global variables <code>TIME_OF_DAY_SEC / CLOCK_DISPLAY_PORT</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Does not re-define these variables</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of previous two functions</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Error checking on function return values</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">No use of <code>malloc()</code></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org348e620" class="outline-2">
<h2 id="org348e620"><span class="section-number-2">4</span> <b>Problem 2</b>: Debugging the Puzzlebox</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org3d3ae28" class="outline-3">
<h3 id="org3d3ae28"><span class="section-number-3">4.1</span> Overview</h3>
<div class="outline-text-3" id="text-4-1">
<p>
The file <code>puzzlebox.c</code> contains source code that reads inputs from a
file named on the command line. If the inputs are correct, points are
awarded. If inputs are incorrect, error messages are printed.  
</p>

<p>
The <code>puzzlebox</code> is arranged into a series of <i>phases</i> each of which
has some points associated with it.
</p>
<ul class="org-ul">
<li>Not all phases must be completed to get full credit but the phases
must done in order.</li>
<li>Each phase reads inputs from the file provided on the command line
and performs calculations on them to see if they are "correct"
according to various criteria</li>
<li>The very first input is your <b>internet ID</b> like <code>kauf0095</code> (first
part of your UMN email address).  This input is used to add
randomness to the puzzle so that <b>your answers will be different
from most other students</b>. You must you use your own internet ID.</li>
</ul>

<p>
<b>The purpose of this problem is get familiar with using a debugger.</b>
This is a powerful tool that pauses programs, allows internal values
to be printed and code to be stepped through line by line.  It is
nearly essential to use as the code in <code>puzzlebox</code> is intentionally
convoluted in places. Being able to pause execution and print values
at various points make it <b>much easier</b> to solve the puzzles.
</p>
</div>
</div>

<div id="outline-container-orgbda30e7" class="outline-3">
<h3 id="orgbda30e7"><span class="section-number-3">4.2</span> <code>input.txt</code> Input File</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Name your input file <code>input.txt</code> and put your internet ID in it along
with some numbers like <code>1 2 3</code>. Then compile and run the <code>puzzlebox</code>
program on it.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; make puzzlebox                             # compile puzzlebox
gcc -Wall -g -c puzzlebox.c
gcc -Wall -g -o puzzlebox puzzlebox.o

&gt; cat input.txt                              # show contents of input.txt
kauf0095 1 2 3

&gt; ./puzzlebox input.txt                      # run puzzlebox with input.txt
UserID 'kauf0095' accepted: hash value = 1397510491
PHASE 1: A puzzle you say? Challenge accepted!

Ah ah ah, you didn't say the magic word...
Failure: Double debugger burger, order up!

  * Score: 0 / 50 pts *
</pre>
</div>

<p>
This is automated with the <code>Makefile</code> target <code>make test-prob2</code>:
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; make test-prob2                       # compile/run puzzlebox with input.txt
gcc -Wall -g -c puzzlebox.c
gcc -Wall -g -o puzzlebox puzzlebox.o
./puzzlebox input.txt
UserID 'kauf0095' accepted: hash value = 1397510491
PHASE 1: A puzzle you say? Challenge accepted!

Ah ah ah, you didn't say the magic word...
Failure: Double debugger burger, order up!

  * Score: 0 / 50 pts *
</pre>
</div>

<p>
These initial forays are not positive (0 / 50 points) but the real
meat of the problem is in examining the source code and determining
inputs for <code>input.txt</code>.
</p>
</div>
</div>

<div id="outline-container-org14f18e5" class="outline-3">
<h3 id="org14f18e5"><span class="section-number-3">4.3</span> <code>gdb</code> The GNU Debugger</h3>
<div class="outline-text-3" id="text-4-3">
<p>
You will definitely need to use a debugger to solve the puzzlebox and
<code>gdb</code> is the quintessential debugger associated with our compiler
<code>gcc</code>.  It is installed by default on all lab machines and is an easy
install on must Linux machines.
</p>

<p>
For a quick overview of GDB, here are some resources
</p>
<ul class="org-ul">
<li><a href="http://www-users.cs.umn.edu/~kauffman/tutorials/gdb.html">CSCI 2021 Quick Guide to gdb: The GNU Debugger</a>: Page describing how
to start the debugger, a sample session using <code>puzzlebox</code>, an
overview of the most common commands.</li>
<li><a href="https://youtu.be/PorfLSr3DDI">CppCon 2015: Greg Law "Give me 15 minutes &amp; I'll change your view
of GDB"</a>: Video giving basic overview of hope to run <code>gdb</code> on simple
programs with an emphasis on differences between "normal" mode and
TUI mode</li>
<li><a href="http://www.yolinux.com/TUTORIALS/GDB-Commands.html">GNU GDB Debugger Command Cheat Sheet</a>: Extensive list of commands</li>
<li><a href="https://sourceware.org/gdb/current/onlinedocs/gdb">Debugging with GDB</a>: Official manual for <code>gdb</code></li>
</ul>
</div>
</div>

<div id="outline-container-orgf04a9ad" class="outline-3">
<h3 id="orgf04a9ad"><span class="section-number-3">4.4</span> Typical Cycle</h3>
<div class="outline-text-3" id="text-4-4">
<p>
A typical cycle of working on <code>puzzlebox</code> will be the following.
</p>
<ul class="org-ul">
<li><p>
Start the debugger with puzzlebox
</p>
<pre class="example">
gdb -tui ./puzzlebox
</pre></li>
<li><p>
Set the arguments array to <code>input.txt</code>
</p>
<pre class="example">
set args input.txt
</pre></li>
<li><p>
Set a breakpoint at a phase like <code>phase3</code>
</p>
<pre class="example">
break phase3
</pre></li>
<li><p>
Run the program
</p>
<pre class="example">
run
</pre></li>
<li><p>
Do some stepping / nexting
</p>
<pre class="example">
step
next
</pre></li>
<li><p>
Print some variables
</p>
<pre class="example">
print a
print/x b
</pre></li>
<li>Make some changes to <code>input.txt</code> in a different window</li>
<li><p>
Re-run the program to see if things have changed favorably
</p>
<pre class="example">
kill
run
</pre></li>
</ul>
</div>
</div>

<div id="outline-container-org8c3e70b" class="outline-3">
<h3 id="org8c3e70b"><span class="section-number-3">4.5</span> Kinds of Puzzles</h3>
<div class="outline-text-3" id="text-4-5">
<p>
The puzzles presented in the different phases make use of a variety of
C program techniques which we have or will discuss including.
</p>
<ul class="org-ul">
<li>Bit-wise operations and their use in place of arithmetic</li>
<li>String and character array manipulations</li>
<li>Interpreting bits as one of several kinds of things (integer, float,
character) through pointers and unions</li>
<li>More extensive C control structures like <code>goto</code> and labels</li>
</ul>
</div>
</div>

<div id="outline-container-orgb8a5460" class="outline-3 grading 50">
<h3 id="orgb8a5460"><span class="section-number-3">4.6</span> Tests for <code>puzzlebox.c</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading">grading</span>&#xa0;<span class="50">50</span></span></h3>
<div class="outline-text-3" id="text-4-6">
<p>
<code>puzzlebox.c</code> itself reports how many points one can earn at the end
of its execution.
</p>

<p>
Currently there are <b>60 points available but 50 points is considered
full credit.</b> 
</p>

<p>
If any additional points are earned, they will be counted as <b>Makeup
Credit for Projects</b> to make up for credit lost on past or future
projects.  Your total score on All Projects cannot exceed 100% so any
points beyond will simply be dropped.
</p>

<p>
<b>Run the following command to 'test' puzzlebox</b>:
</p>
<pre class="example">
make test-prob2
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc25865c" class="outline-2">
<h2 id="orgc25865c"><span class="section-number-2">5</span> Assignment Submission</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orga63447b" class="outline-3">
<h3 id="orga63447b"><span class="section-number-3">5.1</span> <a id="org7d12221"></a> Submit to Gradescope</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Refer to the Project 1 instructions and adapt them for details of how
to submit to Gradescope. In summary they are
</p>

<ol class="org-ol">
<li>Type <code>make zip</code> in the project directory to create <code>p2-code.zip</code></li>
<li>Log into <a href="https://www.gradescope.com/">Gradescope</a>, select Project 2, and upload <code>p2-code.zip</code></li>
</ol>
</div>
</div>

<div id="outline-container-org760208b" class="outline-3">
<h3 id="org760208b"><span class="section-number-3">5.2</span> Late Policies</h3>
<div class="outline-text-3" id="text-5-2">
<p>
You may wish to review the policy on late project submission which
will cost 1 Engagement Point per day late. <b>No projects will be
accepted more than 48 hours after the deadline.</b>
</p>

<p>
<a href="https://www-users.cs.umn.edu/~kauffman/2021/syllabus.html">https://www-users.cs.umn.edu/~kauffman/2021/syllabus.html</a>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/> <i> Author: Chris Kauffman (<a href="mailto:kauffman@umn.edu">kauffman@umn.edu</a>) <br/> Date: 2023-02-17 Fri 12:17 <br/> </i>
</div>
</body>
</html>
