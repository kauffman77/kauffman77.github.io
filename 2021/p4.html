<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-04-15 Fri 13:02 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CSCI 2021 Project 4: Performance Optimization and Timing</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Chris Kauffman" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1" />
<style type="text/css">
@media screen {
:root {
--heading-bg-color:#e8c62e;
--heading-fg-color:#7a0019;
}
html {
font-family: serif;
text-align: justify;
}
pre.src, pre.example {
overflow-x: scroll;
}
/* Merge subtitle area with title area */
.subtitle {
text-align: center;
margin-top: -2em;
padding-top: 1em;
padding-bottom: 0.1em;
}
.title, .subtitle {
color: var(--heading-fg-color);
background-color: var(--heading-bg-color);
}
/* Section borders, left section header style */
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
blockquote {
font-style: italic;
}
td, th {
padding-top: 2px;
padding-bottom: 2px;
}
body {
background-color: #EEE;
}
pre {
}
#content, #preamble, #postamble {
margin-left:300px;
}
.tag {
background-color: inherit; font-family: inherit;
padding: inherit; font-size: 80%; font-weight: inherit;
text-transform: uppercase;
}

.figure p { text-align: inherit; }
figure-number { font-style: italic; }
#table-of-contents {
text-align: left;
position: fixed;
left: 0;
margin: 0 auto;
padding: 0;
width: 300px;
top: 0;
height: 100%;
border: 0;
display: block;
}
#text-table-of-contents {
overflow-y: scroll;
height: 100%;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
#table-of-contents > h2 {
padding: 0.1em;
margin: 0;
}
/* adjustments for small screen, toc at top only */
@media (max-width: 800px) { /* landscape for iphone */
html {
-webkit-text-size-adjust: none;  /* prevent scaling of text on mobile */
}
body {
background-color: #EEE;
width:100%;
margin:0 auto;
}
#content, #preamble, #postamble {
margin-left:0;
}
#table-of-contents {
position: static;
left: inherit;
width:inherit;
height: auto;
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
border: 0.75em solid #006633;
}
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
#text-table-of-contents {
overflow-y: visible;
height: inherit;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
}
.linenr { font-size: xx-small; }
}

@media print {
html {
font-family: serif;
font-size: 10pt;
text-align: justify;
.linenr { font-size: xx-small; }
}
}
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="preamble" class="status">
<i>Last Updated: 2022-04-15 Fri 13:02</i>
</div>
<div id="content">
<h1 class="title">CSCI 2021 Project 4: Performance Optimization and Timing</h1>
<ul class="org-ul">
<li><b>Due: 11:59pm Tue 4/19/2022</b> <del>Mon 4/18/2022</del></li>
<li><i>Approximately 3.0-4.0% of total grade</i></li>
<li>Submit to <a href="https://www.gradescope.com/"><b>Gradescope</b></a></li>
<li>Projects are <b>individual work</b>: no collaboration with other students
is allowed. Seek help from course staff if you get stuck for too long.</li>
</ul>

<div id="outline-container-org5cd9811" class="outline-4">
<h4 id="org5cd9811">CODE/TEST DISTRIBUTION: <a href="p4-code.zip">p4-code.zip</a></h4>
</div>
<div id="outline-container-org54f81ee" class="outline-4">
<h4 id="org54f81ee">Video Overview: <a href="https://canvas.umn.edu/courses/290363/pages/week-11-videos/edit">Wed 4/6/2022 Lecture</a></h4>
</div>

<div id="outline-container-org511054b" class="outline-4">
<h4 id="org511054b">CHANGELOG:</h4>
<div class="outline-text-4" id="text-org511054b">
<dl class="org-dl">
<dt>Fri Apr 15 10:56:10 AM CDT 2022</dt><dd><p>
CSE Labs will doing maintenance on Sunday, April 17th, 2022 4:00
a.m. - 12:00 p.m. This will likely make the home directory space for
students inaccessible and interfere with work on P4, particularly
benchmarking on atlas.cselabs.umn.edu.
</p>

<p>
For that reason, the deadline for P4 is being extended to Tue 4/19
11:59pm.  Late submission may be made up to 2 days later through Thu
4/21 11:59pm.
</p></dd>

<dt>Wed Apr 13 04:56:08 PM CDT 2022</dt><dd>A student reported during lecture some minor bugs in the <a href="#orgcb0e09d">Problem 2
section on handling commandline arguments to <code>search_benchmark</code>.</a>
These errors were left over from a previous version of the program
and have been corrected to reflect the present conventions for
command line arguments.</dd>
<dt>Fri Apr  8 09:03:47 AM CDT 2022</dt><dd>One of the <code>P4-WRITEUP.txt</code> questions mistakenly mentioned reporting
times from the wrong machine. This has been corrected: all
benchmarks should be run on <code>csel-atlas.cselabs.umn.ed</code>.</dd>
<dt>Thu Apr  7 02:05:27 PM CDT 2022</dt><dd><p>
The <code>P4-WRITEUP.txt</code> file was missing from the codepack but has now
been added in.
</p>

<p>
A minor bug in the tests for Problem 2 <code>search_benchmark</code> were
identified. You can either download a fresh version of the
<a href="test_search_benchmark.org">test_search_benchmark.org</a> file or manually fix this by
adjusting line 71 (change 1000 to 150):
</p>

<div id="orgf0d6a4a" class="figure">
<p><img src="test-bug-fix.png" alt="test-bug-fix.png" style="max-width:100%;" />
</p>
</div></dd>
</dl>
</div>
</div>

<div id="outline-container-org4e6ceea" class="outline-4">
<h4 id="org4e6ceea"></h4>
<div class="outline-text-4" id="text-org4e6ceea">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc891f13">1. Introduction</a></li>
<li><a href="#org543844e">2. Download Code and Setup</a></li>
<li><a href="#orgc2ce406">3. <b>Problem 1</b>: A<sup>T</sup> × A Matrix Operation</a>
<ul>
<li><a href="#orgf2ce7c9">3.1. Overview</a></li>
<li><a href="#org76ec01b">3.2. Optimize Matata</a></li>
<li><a href="#org7ea9b32">3.3. Evaluation on <code>csel-atlas</code></a></li>
<li><a href="#orga1f3bf1">3.4. <code>matata_print.c</code> Testing Program</a></li>
<li><a href="#org50b616f">3.5. Optimization Suggestions and Documentation</a></li>
<li><a href="#org64fa5ef">3.6. Grading Criteria for Problem 1 (55%)</a></li>
</ul>
</li>
<li><a href="#org50e4d05">4. <b>Problem 2</b>: Timing Search Algorithms</a>
<ul>
<li><a href="#orgb0c3a65">4.1. Overview</a></li>
<li><a href="#orgef76be7">4.2. <code>main()</code> in <code>search_benchmark.c</code></a></li>
<li><a href="#org810ae58">4.3. Running Algorithms based on Command Line Arguments</a></li>
<li><a href="#org5f97fee">4.4. Sample <code>main()</code> Runs</a></li>
<li><a href="#org9b422e9">4.5. Proper Setup and Cleanup for Searches</a></li>
<li><a href="#org124bae4">4.6. What to Measure</a></li>
<li><a href="#org858fd8e">4.7. MAKEUP CREDIT: Code Layout in <code>search_benchmark.c</code></a></li>
<li><a href="#orgfe810ff">4.8. Grading Criteria for Problem 2 (45%)</a></li>
</ul>
</li>
<li><a href="#org2017b37">5. Writeup</a></li>
</ul>
</div>
</div>
</div>
</div>


<div id="outline-container-orgc891f13" class="outline-2">
<h2 id="orgc891f13"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This assignment focuses on aspects of optimizing and measuring
performance.  
</p>
<ul class="org-ul">
<li>The first problem provides a baseline implementation for
a function and asks for a more performant version which runs
faster. To do so, one must exploit knowledge of the memory hierarchy
and processor pipeline.</li>
<li>The second problem provides a series of functions for classic search
algorithms and requires implementation of a <code>main()</code> function to
benchmark the performance of those functions.</li>
</ul>
</div>
</div>

<div id="outline-container-org543844e" class="outline-2">
<h2 id="org543844e"><span class="section-number-2">2</span> <a id="org01a78eb"></a> Download Code and Setup</h2>
<div class="outline-text-2" id="text-2">
<p>
Download the code pack linked at the top of the page. Unzip this which
will create a project folder. Create new files in this
folder. Ultimately you will re-zip this folder to submit it.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">File</th>
<th scope="col" class="org-left">State</th>
<th scope="col" class="org-left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>Makefile</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 &amp; 2 Build file</td>
</tr>

<tr>
<td class="org-left"><code>P4-WRITEUP.txt</code></td>
<td class="org-left">Edit</td>
<td class="org-left">Fill in answers to assignment questions</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>matata_benchmark.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 main benchmark</td>
</tr>

<tr>
<td class="org-left"><code>matata_print.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 testing program</td>
</tr>

<tr>
<td class="org-left"><code>matvec.h</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 header file</td>
</tr>

<tr>
<td class="org-left"><code>matvec_util.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 utility functions for matrices/vectors</td>
</tr>

<tr>
<td class="org-left"><code>matata_base.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 baseline function to beat</td>
</tr>

<tr>
<td class="org-left"><code>matata_optm.c</code></td>
<td class="org-left">EDIT/COMPLETE</td>
<td class="org-left">Problem 1 create and fill in optimized function definition</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>search.h</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 2 header file</td>
</tr>

<tr>
<td class="org-left"><code>search_funcs.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 2 search, setup, and cleanup functions</td>
</tr>

<tr>
<td class="org-left"><code>search_benchmark.c</code></td>
<td class="org-left">EDIT/COMPLETE</td>
<td class="org-left">Problem 2 timing <code>main()</code> to create</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>testy</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Testing script</td>
</tr>

<tr>
<td class="org-left"><code>test_matata.org</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Tests to check for memory issues in problem 1</td>
</tr>

<tr>
<td class="org-left"><code>test_search_benchmark.org</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Tests to check for memory issues in problem 2</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-orgc2ce406" class="outline-2">
<h2 id="orgc2ce406"><span class="section-number-2">3</span> <b>Problem 1</b>: A<sup>T</sup> × A Matrix Operation</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgf2ce7c9" class="outline-3">
<h3 id="orgf2ce7c9"><span class="section-number-3">3.1</span> Overview</h3>
<div class="outline-text-3" id="text-3-1">
<p>
A problem that occasionally arises in numerical computing when working
with Matrices (2D Arrays) is to multiply the transpose of a matrix by
itself, notated <b>A<sup>T</sup> × A</b>. This is a special case of general <a href="https://en.wikipedia.org/wiki/Matrix_multiplication">matrix
multiplication</a> and students unfamiliar with this operation should
study it to get some context for the present work.
</p>

<p>
This operation is often done when the Matrix A is square (it has an
equal number of rows and columns).  The diagram below illustrates the
result of computing A<sup>T</sup> × A.
</p>

<div class="org-center">

<div id="orgf20df24" class="figure">
<p><img src="matata.png" alt="matata.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 2: </span>3 by 3 matrix <code>A</code> with colored elements along with result of multiplying its transpose by itself as <code>At*A</code>.</p>
</div>
</div>

<p>
Note that that for each of the elements of the result matrix, the
elements are the result of a row in the transpose multiplied by a
column in the original matrix:
</p>
<div class="org-src-container">
<pre class="src src-text">Ans[i][j] = 0;
for(k = 0 to Ans.cols){
  Ans[i][j] += At[i][k] * A[k][j];
}
</pre>
</div>
<p>
The file <code>matata_base.c</code> provides a baseline function that performs
this computation in a direct fashion as the above definition indicates
The algorithm uses the most "natural" approach of multiplying each row
of the transpose by each column of the original to produce the result
in the for each part of the squared result. The transposed matrix is
formed via a <code>malloc()</code>, copying elements, then performing the
multiply.  As you survey the code, note the use of various convenience
macros such as <code>MGET(mat,i,j)</code> interact with the matrix type used.
</p>

<div class="org-src-container">
<pre class="src src-c">// Baseline version from matata_base.c
int matata_BASE_NORMAL(matrix_t mat, matrix_t ans) {
  matrix_t tra;
  matrix_init(&amp;tra, mat.rows, mat.cols);

  for(int i=0; i&lt;mat.rows; i++){                // form transpose mat
    for(int j=0; j&lt;mat.cols; j++){
      int mij = MGET(mat, i, j);
      MSET(tra, j, i, mij);
    }
  }

  for(int i=0; i&lt;mat.rows; i++){                // compute ans = A^T * A
    for(int j=0; j&lt;mat.cols; j++){
      MSET(ans,i,j,0);                          // initial sum 0's
      for(int k=0; k&lt;mat.rows; k++){            // sum over dot(row, col)
        int tik = MGET(tra, i, k);
        int mkj = MGET(mat, k, j);
        int cur = MGET(ans, i, j);
        int new = cur + tik*mkj;
        MSET(ans, i, j, new);
      }
    }
  }

  matrix_free_data(&amp;tra);                       // de-allocate transpose mat

  return 0;                                     // return success
}
</pre>
</div>
<p>
Note that the original matrix comes in as the parameter <code>mat</code> and the
result of squaring the matrix is stored in the parameter <code>ans</code>.
</p>

<p>
While this algorithm is a direct translation of how humans would
visually calculate the square of small matrices, it is unfortunately
fairly slow when executing on most modern computing systems.
</p>
</div>
</div>

<div id="outline-container-org76ec01b" class="outline-3">
<h3 id="org76ec01b"><span class="section-number-3">3.2</span> Optimize Matata</h3>
<div class="outline-text-3" id="text-3-2">
<p>
The purpose of this problem is to write <code>matata_OPTM()</code> which is a
faster version of the provided <code>matata_BASE()</code> to calculate the
results.
</p>

<p>
Write your code in the file <code>matata_optm.c</code>.
</p>

<p>
Keep the following things in mind.
</p>
<ol class="org-ol">
<li>You will need to acquaint yourself with the functions and types
related to matrices and vectors provided in the <code>matvec.h</code> and
demonstrated in the baseline function. Understanding the layout of
the matrix in memory is essential to unlocking performance.</li>
<li>The goal of <code>matata_OPTM()</code> is to exceed the performance of
<code>matata_BASE()</code> by as much as possible.</li>
<li>To achieve this goal, several optimizations must be implemented and
suggestions are given in a later section.</li>
<li>You will need to document your optimizations in the file
<code>P4-WRITEUP.txt</code> and provide timing results of running the
optimized version.</li>
<li>Part of your grade will be based on the speed of the optimized code
on the machine <code>csel-atlas.cselabs.umn.edu</code>. The main routine
<code>matata_benchmark.c</code> will be used for this.</li>
</ol>

<p>
Some details are provided in subsequent sections.
</p>
</div>
</div>


<div id="outline-container-org7ea9b32" class="outline-3">
<h3 id="org7ea9b32"><span class="section-number-3">3.3</span> Evaluation on <code>csel-atlas</code></h3>
<div class="outline-text-3" id="text-3-3">
<p>
The provided file <code>matata_benchmark.c</code> provides a benchmark for the
speed of squaring a matrix. It will be used by graders to evaluate the
submitted code and should be used during development to gauge
performance improvements.
</p>

<p>
The machine <code>csel-atlas.cselabs.umn.edu</code> will be used for evaluation
and the scoring present in <code>matata_benchmark.c</code> is "tuned" to the
CPU/Memory on these machines.  That means that codes should be <b>tested
on csel-atlas</b> so that no unexpected results occur after
submission. Results reported should be from <code>csel-atlas</code>.
</p>

<p>
The output of the <code>matata_benchmark</code> is shown below.
</p>
<ul class="org-ul">
<li>SIZE: the size of the matrix being used. The benchmark always
uses square matrices</li>
<li>Runtimes for the 2 functions
<ul class="org-ul">
<li>BASE: the time it takes for <code>matata_BASE()</code> to complete.</li>
<li>OPTM: the time it takes for <code>matata_OPTM()</code> to complete.</li>
</ul></li>
<li>SPDUP: the speedup of <code>matata_OPTM()</code> over <code>matata_BASE()</code> which
is <code>BASE / OPTM</code>.</li>
<li><p>
POINTS: which are earned according to the following code:
</p>
<div class="org-src-container">
<pre class="src src-c">    double factor =                               // scale based on size: speedup on 
      (( ((double) size) / ((double) sizes[0]))); // larger matrix worth more points

    double log2spdup = log2(speedup_OPTM);        // log_2 so equal speed is 0 points, 2X is 1pt, etc
    if(log2spdup &lt; 0){                            // no negative scores
      log2spdup = 0.0;
    }
    double points = log2spdup * factor;           // scale speedup by size factor
</pre>
</div>
<p>
This scheme, while a little involved, means that unless actual
optimizations are implemented, 0 points will be scored. It is also
weighted towards earning more points on for larger size matrices.
</p></li>
</ul>

<p>
Below are several demonstration runs of <code>matata_benchmark</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh"># BUILD/RUN ON NON-ATLAS MACHINE: NOTE WARNINGS
homeputer&gt;&gt; make
gcc -Wall -Werror -g -Og -c matata_print.c
gcc -Wall -Werror -g -Og -c matvec_util.c
gcc -Wall -Werror -g -Og -c matata_base.c
gcc -Wall -Werror -g -Og -c matata_optm.c
...
homeputer&gt;&gt; ./matata_benchmark
WARNING: expected host 'csel-atlas' but got host 'homeputer'
WARNING: timing results / scoring will not reflect actual scoring
WARNING: run on host 'csel-atlas' for accurate results
==== Matrix A^T*A Benchmark Version 1 ====
  SIZE       BASE       OPTM  SPDUP   LOG2 FACTOR POINTS 
   171 2.6778e-02 6.0280e-03   4.44   2.15   1.00   2.15 
   196 1.4976e-02 6.4580e-03   2.32   1.21   1.15   1.39 
   256 3.8301e-02 1.2818e-02   2.99   1.58   1.50   2.36 
   320 6.4765e-02 2.5887e-02   2.50   1.32   1.87   2.48 
   801 1.1916e+00 4.0796e-01   2.92   1.55   4.68   7.24 
  1024 7.8590e+00 8.8310e-01   8.90   3.15   5.99  18.89 
RAW POINTS: 34.51
TOTAL POINTS: 35 / 35
WARNING: expected host 'csel-atlas' but got host 'val'
WARNING: timing results / scoring will not reflect actual scoring
WARNING: run on host 'csel-atlas' for accurate results

# PARTIAL CREDIT RUN
atlas&gt;&gt; ./matata_benchmark
==== Matrix A^T*A Benchmark Version 1 ====
  SIZE       BASE       OPTM  SPDUP   LOG2 FACTOR POINTS 
   171 3.1978e-02 2.6232e-02   1.22   0.29   1.00   0.29 
   196 4.7283e-02 4.1769e-02   1.13   0.18   1.15   0.21 
   256 1.3549e-01 1.1288e-01   1.20   0.26   1.50   0.39 
   320 2.5207e-01 2.0147e-01   1.25   0.32   1.87   0.60 
   801 5.1340e+00 3.5704e+00   1.44   0.52   4.68   2.45 
  1024 2.3474e+01 2.6712e+01   0.88   0.00   5.99   0.00 
RAW POINTS: 3.94
TOTAL POINTS: 4 / 35

# FULL CREDIT RUN
atlas&gt;&gt; ./matata_benchmark
==== Matrix A^T*A Benchmark Version 1 ====
  SIZE       BASE       OPTM  SPDUP   LOG2 FACTOR POINTS 
   171 3.3137e-02 1.1389e-02   2.91   1.54   1.00   1.54 
   196 4.7676e-02 1.7190e-02   2.77   1.47   1.15   1.69 
   256 1.3586e-01 3.9148e-02   3.47   1.80   1.50   2.69 
   320 2.5219e-01 7.4042e-02   3.41   1.77   1.87   3.31 
   801 5.1388e+00 1.1710e+00   4.39   2.13   4.68   9.99 
  1024 2.4306e+01 2.5422e+00   9.56   3.26   5.99  19.50 
RAW POINTS: 38.72
TOTAL POINTS: 35 / 35
</pre>
</div>

<p>
Note that it is possible to exceed the score associated with maximal
performance (as seen in the RAW POINTS reported) but no more than the
final reported points will be given for the performance portion of the
problem. <i>There may be Makeup Credit associate with sufficient
speedups;</i> <i>if this occurs, output for the program will make this
obvious.</i>
</p>
</div>
</div>

<div id="outline-container-orga1f3bf1" class="outline-3">
<h3 id="orga1f3bf1"><span class="section-number-3">3.4</span> <code>matata_print.c</code> Testing Program</h3>
<div class="outline-text-3" id="text-3-4">
<p>
As one works on implementing optimizations in <code>matata_OPTM()</code>, bugs
which compute incorrect results are often introduced.  To aid in
testing, the <code>matata_print()</code> program runs both the BASE and OPTM
versions on the same matrix and shows all results. The matrix size is
determined from the command line and is printed on the screen to
enable hand verification. Examples are below.
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; matata_print 3                # run on 3 by 3 matrix
==== Matrix A^T*A Print ====   
Original Matrix:                 # original test matrix
3 x 3 matrix                   
   0:      0      1      2     
   1:      3      4      5     
   2:      6      7      8     
                               
BASE Matrix A^T*A :              # results for matata_BASE()
3 x 3 matrix                   
   0:     45     54     63     
   1:     54     66     78     
   2:     63     78     93     
                               
OPTM Matrix A^T*A :              # results for matata_OPTM()
3 x 3 matrix                   
   0:     45     54      0     
   1:     54     66      0     
   2:     63     78      0     
                               
BASE/OPTM Element Comparison:  
[  i][  j]:   BASE   OPTM        # elemnent by element comparison
[  0][  0]:     45     45        # to help spot errors in results
[  0][  1]:     54     54        # for matata_OPTM()
[  0][  2]:     63      0 ***    # NON-matching
[  1][  0]:     54     54      
[  1][  1]:     66     66        
[  1][  2]:     78      0 ***    # NON-matching
[  2][  0]:     63     63      
[  2][  1]:     78     78        
[  2][  2]:     93      0 ***    # NON-matching
</pre>
</div>
</div>
</div>


<div id="outline-container-org50b616f" class="outline-3">
<h3 id="org50b616f"><span class="section-number-3">3.5</span> <a id="org24685ba"></a> Optimization Suggestions and Documentation</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Labs and lectures have covered several kinds of optimizations which
are useful to improve the speed of <code>matata_OPTM()</code>.  These techniques
include:
</p>
<ul class="org-ul">
<li>Re-ordering memory accesses to be as sequential as possible which
favors cache (<b>very important</b>)</li>
<li>Potentially reducing the overall memory usage of the program. Note
that in <code>matata_base()</code>, additional memory is allocated to
explicitly create the transpose matrix. This puts additional memory
pressure on the computing system which may interfere with
performance.</li>
<li>Increasing potential processor pipelining by adjusting the
destinations of arithmetic operations.</li>
<li>Consider user of functions that perform bulk changes to
memory. If matrices need to be "zeroed out", it is possible that
functions like <code>memset()</code> can perform faster than iteration.</li>
<li>Decreasing any unnecessary work such as memory accesses or
arithmetic operations. It may be worth it to examine how matrix
indices are computed in the <code>MGET() / MSET()</code> macros.  These use
arithmetic operations which must be performed to find elements.</li>
</ul>

<p>
These should be sufficient to gain full credit though you are free to
explore additional optimizations.
</p>

<p>
A useful avenue to pursue is finding a way to re-order the memory
access pattern to favor cache. Recall that the most favorable access
pattern for most matrix computations in a row-major programming
environment like C is to work across rows.  Below is a diagram which
suggests one possible way to do this in the context of computing <code>A^T
× A</code>.  It favors repeated walking across a matrix in a row-wise
fashion to avoid the stride required for column-wise access.  Study
this diagram carefully and consider implementing the approach
illustrated as your first optimization. As discussed in lecture, if
data is not getting to the processor, other optimizations that favor
pipelining/superscalar execution will have no effect so focusing first
on the memory access pattern is crucial.
</p>

<div class="org-center">

<div id="orgc22a709" class="figure">
<p><img src="matata-order.png" alt="matata-order.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 3: </span>Illustration of how to favor row-wise access to compute squared matrix. Computation of first row results are shown with the beginnings of the second row.</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org64fa5ef" class="outline-3 grading 55">
<h3 id="org64fa5ef"><span class="section-number-3">3.6</span> Grading Criteria for Problem 1 (55%)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading">grading</span>&#xa0;<span class="55">55</span></span></h3>
<div class="outline-text-3" id="text-3-6">
<p>
The file <code>P4-WRITEUP.txt</code> has several questions that should be
answered in a similar fashion to lab write-ups. These document the
optimizations used in <code>matata_OPTM()</code> require a justification for
their use.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Weight</th>
<th scope="col" class="org-left">Criteria</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">AUTOMATED TESTS</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">No memory errors reported by Valgrind via <code>make test-prob1</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">MANUAL INSPECTION of <code>matata_optm.c</code></td>
</tr>

<tr>
<td class="org-right">35</td>
<td class="org-left">Performance of <code>matata_OPTM()</code> on <code>csel-atlas.cselabs.umn.edu</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">As measured by the provided <code>matata_benchmark</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">+5 MAKEUP CREDIT points are available for getting a benchmark score of 40 or more</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Clean and well-documented code for <code>matata_OPTM()</code></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><code>P4-WRITEUP.txt</code></td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Answer 1A <code>P4-WRITEUP.txt</code> (source code)</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">Answer 1B <code>P4-WRITEUP.txt</code> (timing table)</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Answer 1C <code>P4-WRITEUP.txt</code> (optimizations description)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org50e4d05" class="outline-2">
<h2 id="org50e4d05"><span class="section-number-2">4</span> <b>Problem 2</b>: Timing Search Algorithms</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgb0c3a65" class="outline-3">
<h3 id="orgb0c3a65"><span class="section-number-3">4.1</span> Overview</h3>
<div class="outline-text-3" id="text-4-1">
<p>
This problem centers on timing several algorithms to measure their
performance. This will require use of C timing functions which have
been demonstrated in various parts of the class including the previous
problem.
</p>

<p>
You will measure the performance of 4 search functions which simply
determine whether an integer <code>query</code> is present in an associated data
structure.  All of these along with associated setup functions are
provided in the <code>search_funcs.c</code> file.  The search algorithms are as
follows.
</p>

<dl class="org-dl">
<dt>Linear Search in an Array</dt><dd>The array need not be sorted and is
searched from beginning to end.</dd>
<dt>Linear Search in a Linked List</dt><dd>Nodes are linked together and the
list is searched for a query from beginning to end.</dd>
<dt>Binary Search in a Sorted Array</dt><dd>The classic divide and conquer
algorithm which repeatedly halves the search space.</dd>
<dt>Binary Search in a Tree</dt><dd>A binary search tree enables searching
for a query by following left/right branches.</dd>
</dl>

<p>
If you do not have a sense of the relative computational complexities
of these algorithms, you should review these as they should factor
into your analysis of the timings of the algorithms.
</p>

<p>
As was the case for problem 1, you can develop your timing program on
any platform but the analysis should be conducted on
<code>csel-atlas.cselabs.umn.edu</code> to ensure comparability.
</p>
</div>
</div>


<div id="outline-container-orgef76be7" class="outline-3">
<h3 id="orgef76be7"><span class="section-number-3">4.2</span> <code>main()</code> in <code>search_benchmark.c</code></h3>
<div class="outline-text-3" id="text-4-2">
<p>
The requirements from this problem is that you provide a <code>main()</code>
function in the file <code>search_benchmark.c</code> with the following features.
</p>

<ol class="org-ol">
<li>Runs on a range of sizes that can be specified on the command
line.  A typical approach is to allow one to specify a minimum and
maximum size of the search data structures and repeatedly double
starting at the minimum and ending at the max.</li>
<li><p>
Create "even" data in the structures using the provided
functions. 
</p>
<ul class="org-ul">
<li><code>make_even_array()</code> for arrays</li>
<li><code>make_even_list()</code> for linked lists</li>
<li><code>make_even_trees()</code> for  trees</li>
</ul>
<p>
This will populate the data structure with the sequence
<code>0,2,4,...,(len-1)*2</code>.  This data population allows searches
for items that are known to be present (even numbers) and items
that are known not to be present (odd numbers).
</p></li>
<li><p>
Perform a variable number of searches on the data structures.  This
should be done the following way.
</p>
<ul class="org-ul">
<li>On the command line the number of repetitions of searches should
be specified on the command line.</li>
<li>Search for every element in the data structures the given number
of repetitions.</li>
<li>Search an equal number of times for elements NOT in the data
structure.</li>
</ul>
<p>
A typical example method for this is as follows. For a size 100
data structure perform
</p>
<ul class="org-ul">
<li>An outer loop over the number of repetitions</li>
<li>An inner loop that searches for the numbers
<code>0,1,2,3,4,...,(2*len)-1</code></li>
</ul>
<p>
This pattern searches for an equal number of present/not-present
items.
</p></li>
<li><p>
Measure the <b>Total Time for the Entire Search Loop</b> for a given
algorithm. Since individual searches will take a minuscule amount
of time, the Total Time for the loop is the most robust measure to
discuss. While such a time may include some artifacts such as
incriminating loop variables, these will be "charged" to all
algorithms equally so that the comparison remains fair. <b>Avoid use
of functions like pow()</b> as these will introduce unnecessarily
calculations inflating the measured times. Favor multiplications to
increase size such as
</p>
<pre class="example">
cur_search_size = cur_search_size * 2;
</pre></li>
<li><p>
Enable any combination of algorithms to be tested by specifying
which are to be run on the command line.  The required way to do
this is to accept optional 4th, 5th, etc. command line arguments
which enable different search types.  The associated strings for
each algorithm are
</p>
<ul class="org-ul">
<li><code>la</code> for linear array search</li>
<li><code>ll</code> for linked list search</li>
<li><code>bl</code> for binary search</li>
<li><code>bt</code> for tree search</li>
</ul>
<p>
Specify additional command line arguments which enable the searches:
</p>
<ul class="org-ul">
<li><code>ll</code>: run linked list search only</li>
<li><code>la ba</code>: run linear array search and binary array search</li>
<li><code>la ll bt</code>: run all but the binary array search</li>
<li><code>ll bt la ba</code>: run all algorithms</li>
<li>If no string is specified, run all algorithms; this is the
default.</li>
<li>The order of the additional command line arguments need not
affect the output. For example specifying <code>la ll</code> can have the
same output as <code>ll la</code> (both run linear search in arrays and
linked lists).</li>
</ul></li>
<li>Ensure that an equal number of searches is done for each
of the algorithms being benchmarked.</li>
<li>Ensure that the timing that is done is ONLY for searching and not
for setup and cleanup for the data structures.</li>
<li>Ensure that there are no memory leaks or other problems in setup
and cleanup for the searches.</li>
</ol>
</div>
</div>

<div id="outline-container-org810ae58" class="outline-3">
<h3 id="org810ae58"><span class="section-number-3">4.3</span> Running Algorithms based on Command Line Arguments</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Many folks who have not had to handle command line arguments struggle
some what with the style of <code>search_benchmark</code> so here is some
additional guidance on handling this aspect of the program.
</p>
</div>


<div id="outline-container-org8a4a2c6" class="outline-4">
<h4 id="org8a4a2c6">Run the algorithms in a fixed order</h4>
<div class="outline-text-4" id="text-org8a4a2c6">
<p>
An invocation like
</p>
<pre class="example">
./search_benchmark 5 10 10 la ll
</pre>

<p>
should run the linear array search (<code>a</code>) and linear linked list search
(<code>l</code>).  So should the invocation
</p>
<pre class="example">
./search_benchmark 5 10 10 ll la
</pre>

<p>
Since we are interested <b>only</b> in comparing timing for these
algorithms, the order of which is run first and printed first does not
matter so <b>run the algorithms and print results in a fixed order.</b>
That is, both of the above will run the array search first and linked
list search second giving identical ordering results:
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt; ./search_benchmark 5 10 10 la ll
  LENGTH SEARCHES      array       list 
      32      640 1.2345e+06 1.2345e+06 
      64     1280 1.2345e+06 1.2345e+06 
     128     2560 1.2345e+06 1.2345e+06 
     256     5120 1.2345e+06 1.2345e+06 
     512    10240 1.2345e+06 1.2345e+06 
    1024    20480 1.2345e+06 1.2345e+06 

&gt; ./search_benchmark 5 10 10 ll la         # still running linear array search first
  LENGTH SEARCHES      array       list 
      32      640 1.2345e+06 1.2345e+06 
      64     1280 1.2345e+06 1.2345e+06 
     128     2560 1.2345e+06 1.2345e+06 
     256     5120 1.2345e+06 1.2345e+06 
     512    10240 1.2345e+06 1.2345e+06 
    1024    20480 1.2345e+06 1.2345e+06 

</pre>
</div>

<p>
Search times above are intentionally left out so you will need to
trust your own code to get an idea of how long things are
running. However, very short run times are generally unreliable. Aim
for a <b>minimum time of 1e-03 seconds</b> in order to make sure your
results are reliable.  Shorter times like 1e-05 will vary too much to
trust. 
</p>
</div>
</div>

<div id="outline-container-orge2e9204" class="outline-4">
<h4 id="orge2e9204">Use Boolean-like variables to track which algorithms to run</h4>
<div class="outline-text-4" id="text-orge2e9204">
<p>
If following the advice of the previous section, to run the 4
algorithms in a fixed order, one can simple assign variables in
<code>main()</code> which indicate which algorithms to run as in the following.
</p>
<div class="org-src-container">
<pre class="src src-c">  int run_linear_array = 0;
  int run_linear_list  = 0;
  ...
</pre>
</div>
<p>
Later, these variables are checked in a conditional as in:
</p>
<div class="org-src-container">
<pre class="src src-c">  if(run_linear_array){
    // run loops to time linear search in an array
  }
  if(run_linear_list){
    // run loops to time linear search in a list
  }
  ...
</pre>
</div>

<p>
<a id="orgcb0e09d"></a> <i>Updated Wed Apr 13 04:56:08 PM CDT 2022</i>
</p>

<p>
When processing the command line argument
associated with which algorithms to run, one can 'turn on' the
algorithm if the associated string is present on the command line
according to the following pseudo-code
</p>
<div class="org-src-container">
<pre class="src src-c">turn on all algorithms as this is the default;
if(#arguments &gt; 4){
  turn off all algorithms since command line arguments dictate which to run;
  for(each argument in argv[] at index 4 or above){
    if( argv[i] is equal to "la" ){
      run_linear_array = 1;
    }
    ...
  }
</pre>
</div>
<p>
While the above approach does not allow one to run algorithms in an
arbitrary order, it does allow any combination of algorithms to be run
and compared which is all that is needed to complete the timing.
</p>

<p>
Keep in mind that C uses the following conventions for command line
arguments based on the parameters to <code>main(int argc, char *argv[])</code>.
</p>
<ul class="org-ul">
<li><code>int argc</code> is the total number of strings appearing on the command
including the program name</li>
<li><code>char *argv[]</code> is an array of strings which are the command lines</li>
</ul>

<p>
For example, here are a couple command line configurations based on
possible runs of <code>search_benchmark</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; ./search_benchmark 5 10 20 
# argc = 4
# argv[0] = "search_benchmark"
# argv[1] = "5"
# argv[2] = "10"
# argv[3] = "20"

&gt;&gt; ./search_benchmark 5 10 20 la bt
# argc = 6
# argv[0] = "search_benchmark"
# argv[1] = "5"
# argv[2] = "10"
# argv[3] = "20"
# argv[3] = "la"
# argv[3] = "bt"
</pre>
</div>
</div>
</div>


<div id="outline-container-org03d97d3" class="outline-4">
<h4 id="org03d97d3">Free and Re-allocate Memory for Different Sizes</h4>
<div class="outline-text-4" id="text-org03d97d3">
<p>
While the search functions for Linked Lists and Binary Search Trees
both take size arguments, these are ignored in the searches.  Instead,
<code>NULL</code>'s in the data structures are used to find the bounds of them.
This means if one is searching for data that is not in a small list,
the end of the data structure will be reached sooner and <i>not found</i>
will be determined faster than if searching in a large list.  To that
end <b>allocate data structures that are sized specifically to the
search size</b> each time. Do NOT allocate one large data structure and
do all size searches on it as this will create artificially bad
timings for the linked structures.
</p>
</div>
</div>
</div>


<div id="outline-container-org5f97fee" class="outline-3">
<h3 id="org5f97fee"><span class="section-number-3">4.4</span> Sample <code>main()</code> Runs</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Below are some sample runs of the <code>main()</code> function and output that is
produced.  Note that the times have intentionally been set to all
identical times.  Your exact output may vary some but <code>main()</code> must
use the command line options as indicated below. These arguments are
</p>
<ol class="org-ol">
<li>Minimum data size (power of 2)</li>
<li>Maximum data size (power of 2)</li>
<li>Number of repeats</li>
<li>(Optional) Characters specifying which search algorithms to run. If
this is omitted, run all algorithms.</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">&gt; ./search_benchmark 
usage: ./search_benchmark &lt;minpow&gt; &lt;maxpow&gt; &lt;repeats&gt; [alg1 alg2 ...]
 with alg1 alg2 as a combination of:
  la : Linear Array Search
  ll : Linked List Search
  ba : Binary Array Search
  bt : Binary Tree Search
  (default all)

# run all algorithms, single repetition of searches
&gt; ./search_benchmark 9 14 1 
  LENGTH SEARCHES      array       list     binary       tree 
     512     1024 1.2345e+06 1.2345e+06 1.2345e+06 1.2345e+06 
    1024     2048 1.2345e+06 1.2345e+06 1.2345e+06 1.2345e+06
    2048     4096 1.2345e+06 1.2345e+06 1.2345e+06 1.2345e+06
    4096     8192 1.2345e+06 1.2345e+06 1.2345e+06 1.2345e+06
    8192    16384 1.2345e+06 1.2345e+06 1.2345e+06 1.2345e+06
   16384    32768 1.2345e+06 1.2345e+06 1.2345e+06 1.2345e+06

# Note that SEARCHES is 2*LENGTH as 1 successful and 1 unsuccessful
# search is run for each element in the data structure

# run linear array, linked list, binary array search algorithms, 10 repetition of searches
&gt; ./search_benchmark 5 10 10 la ll ba
  LENGTH SEARCHES      array       list     binary 
      32      640 1.2345e+06 1.2345e+06 1.2345e+06
      64     1280 1.2345e+06 1.2345e+06 1.2345e+06
     128     2560 1.2345e+06 1.2345e+06 1.2345e+06
     256     5120 1.2345e+06 1.2345e+06 1.2345e+06
     512    10240 1.2345e+06 1.2345e+06 1.2345e+06
    1024    20480 1.2345e+06 1.2345e+06 1.2345e+06

# run linear binary array and tree search algorithms, 2 repetition of searches
&gt; ./search_benchmark 14 19 2 ba bt
  LENGTH SEARCHES     binary       tree 
   16384    65536 1.2345e+06 1.2345e+06
   32768   131072 1.2345e+06 1.2345e+06
   65536   262144 1.2345e+06 1.2345e+06
  131072   524288 1.2345e+06 1.2345e+06
  262144  1048576 1.2345e+06 1.2345e+06
  524288  2097152 1.2345e+06 1.2345e+06

</pre>
</div>
</div>
</div>


<div id="outline-container-org9b422e9" class="outline-3">
<h3 id="org9b422e9"><span class="section-number-3">4.5</span> Proper Setup and Cleanup for Searches</h3>
<div class="outline-text-3" id="text-4-5">
<p>
Each search algorithm requires setup and cleanup which is described
below. All these follow the same patter which can enable somewhat more
elegant setup/search/cleanup which is discussed in the section on
bonus credit.
</p>
</div>

<div id="outline-container-orgbc0bfec" class="outline-4">
<h4 id="orgbc0bfec">Linear and Binary Array Search</h4>
<div class="outline-text-4" id="text-orgbc0bfec">
<p>
Use the function <code>make_evens_array()</code> to create an appropriately
sized <code>int</code> array for these functions.  Call <code>free()</code> on this array
when finished with it.
</p>
</div>
</div>

<div id="outline-container-org1d8e532" class="outline-4">
<h4 id="org1d8e532">Linked List Search</h4>
<div class="outline-text-4" id="text-org1d8e532">
<p>
Use the function <code>make_evens_list()</code> to create an appropriately
sized <code>list_t</code>.  Call <code>list_free()</code> on this list when finished with
it.
</p>
</div>
</div>

<div id="outline-container-org9099d44" class="outline-4">
<h4 id="org9099d44">Binary Tree Search</h4>
<div class="outline-text-4" id="text-org9099d44">
<p>
Use the function <code>make_evens_tree()</code> to create an appropriately
sized <code>bst_t</code>.  Call <code>bst_free()</code> on this list when finished with
it.
</p>
</div>
</div>
</div>

<div id="outline-container-org124bae4" class="outline-3">
<h3 id="org124bae4"><span class="section-number-3">4.6</span> What to Measure</h3>
<div class="outline-text-3" id="text-4-6">
<p>
The reason for the requirements mentioned above is to study the
performance of different search algorithms and answer associated
questions in the <code>P4-WRITEUP.txt</code>.  The main goals of these questions
are to elucidate.
</p>
<ol class="org-ol">
<li>To compare the linear and logarithmic search complexities to see if
one or the other is superior at small and large input sizes</li>
<li>To compare the contiguous memory (array) approaches to the linked
memory (list/tree) approaches to see if one or the other is
superior at small and large sizes.</li>
</ol>
<p>
To that end make sure to answer the thoroughly answer questions
provided.
</p>
</div>
</div>

<div id="outline-container-org858fd8e" class="outline-3">
<h3 id="org858fd8e"><span class="section-number-3">4.7</span> MAKEUP CREDIT: Code Layout in <code>search_benchmark.c</code></h3>
<div class="outline-text-3" id="text-4-7">
<p>
"Makeup" credit will allow the score on this assignment to exceed 100%
but will not allow the overall score on the project portion of the
grade to exceed the weight specified in the syllabus. It is designed
to help "make up" for lost credit on previous assignments.
</p>

<p>
Makeup credit is available in this assignment for implementing the
selection of which search functions to run in an "elegant" fashion.
Likely the best method for this is to use a table of function
pointers. This style is demonstrated in Lab09 and Lab11 but must be
expanded upon in this lab to reach its full potential.
</p>

<p>
The main purpose to using such a table is to avoid a large <code>if/else</code>
or <code>switch/case</code> block.  For example, a simple approach to doing
different search types is something like the following.
</p>
<div class="org-src-container">
<pre class="src src-c">int main(...){
  int do_linear_array = 1;
  int do_linked_list  = 1;
  ...;
  for(all sizes){
    if(do_linear_array){
      // setup array
      // start timer
      // do searches
      // stop timer
      // print output
      // free the array
    }
    if(do_linked_list){
      // setup list
      // start timer
      // do searches
      // stop timer
      // print output
      // free the list
    }
    ...;
  }
}
</pre>
</div>
<p>
This formulation obviously involves a much redundant code. A good way
to avoid this is to parameterize the repeated parts as functions and
iterate over the table invoking functions appropriate to the different
types of searches.
</p>

<p>
To get a sense of how this might work, here is an incomplete example
setup used in one solution.
</p>
<div class="org-src-container">
<pre class="src src-c">// Table of search algorithms
searchalg_t algs[] = {
  {"Linear Array Search", "array",  'a', 1,
   (search_t) linear_array_search, (setup_t) make_evens_array, (cleanup_t) free},
  {"Linked List Search",  "list",   'l', 1,
   (search_t) linkedlist_search,   (setup_t) make_evens_list,  (cleanup_t) list_free},
  ...
  {NULL}
};
</pre>
</div>
<p>
None of the types are given in the above but several notable things
are present.
</p>
<ol class="org-ol">
<li>The types of searches are described in an array (table) of structs</li>
<li>Each field pertains to a description or function for the search</li>
<li>Some of the functions are for setup, others for cleanup, and the
first is the actual search function.</li>
<li>Casting is required to get the different function prototypes to
"fit" into the same kind of struct.</li>
<li>All of the searches are enabled by default but fields can changed
to disable them.</li>
<li>One only needs to iterate through the array invoking appropriate
functions. This avoids the need for a large <code>if/else</code> style
program.</li>
</ol>

<p>
To complete this part, document your code with comments and also
describe you design using function pointers/structs in
<code>P4-WRITEUP.txt</code>.
</p>
</div>
</div>

<div id="outline-container-orgfe810ff" class="outline-3 grading 45">
<h3 id="orgfe810ff"><span class="section-number-3">4.8</span> Grading Criteria for Problem 2 (45%)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading">grading</span>&#xa0;<span class="45">45</span></span></h3>
<div class="outline-text-3" id="text-4-8">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Weight</th>
<th scope="col" class="org-left">Criteria</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">AUTOMATED TESTS</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Passed tests associated with <code>make test-prob2</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">MANUAL INSPECTION of <code>search_benchmark.c</code></td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Accepts parameters that control the min/max data sizes and number of repeats</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Proper searching for success and fail elements</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">The Total Search Loop Time is measured for each algorithm and reported, not an average per search</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Timing does not include memory allocationo/de-allocation</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Allocates data that is exactly to search sizes to prevent handicapping lists and arrays</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Clean and well-documented code for <code>main()</code> that uses simple approaches to run algorithms requested</td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-left">SUBTOTAL</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><code>P4-WRITEUP.txt</code></td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Timing results larger than 1e-03 seconds for most cases; smaller times are unreliable.</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">Answer 2A <code>P4-WRITEUP.txt</code> (min size for differences)</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Answer 2B <code>P4-WRITEUP.txt</code> (list vs array)</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Answer 2C <code>P4-WRITEUP.txt</code> (tree vs array))</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">Answer 2D <code>P4-WRITEUP.txt</code> (caching effects))</td>
</tr>

<tr>
<td class="org-right">25</td>
<td class="org-left">SUBTOTAL</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">OPTIONAL MAKEUP CREDIT</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">Use a table of function pointers effectively in <code>search_benchmark.c</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Must describe this design in section 2E of <code>P4-WRITEUP.txt</code></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


<div id="outline-container-org2017b37" class="outline-2">
<h2 id="org2017b37"><span class="section-number-2">5</span> Writeup</h2>
<div class="outline-text-2" id="text-5">
<p>
This assignment involves answering questions in the file
<code>P4-WRITEUP.txt</code> which is included in the code pack and pasted below.
</p>

<div class="org-src-container">
<pre class="src src-text">                              ____________

                               P4 WRITEUP
                              ____________


- Name: (FILL THIS in)
- NetID: (THE kauf0095 IN kauf0095@umn.edu)

Answer the questions below according to the project specification. Write
your answers directly in this text file and submit it along with your
code.


PROBLEM 1: matsquare_OPTM()
===========================

  Do your timing study on csel-atlas.cselabs.umn.edu


(A) Paste Source Code
~~~~~~~~~~~~~~~~~~~~~

  Paste a copy of your source code for the function `matsquare_OPTM()'

  ####################### YOUR ANSWER HERE #########################

  ##################################################################


(B) Timing on csel-atlas
~~~~~~~~~~~~~~~~~~~~~~~~

  Paste a copy of the results of running `matsquare_benchmark' on
  csel-atlas.cselabs.umn.edu in the space below which shows how your
  performance optimizations improved on the baseline codes.

  ####################### YOUR ANSWER HERE #########################

  ##################################################################


(C) Optimizations
~~~~~~~~~~~~~~~~~

  Describe in some detail the optimizations you used to speed the code
  up.  THE CODE SHOULD CONTAIN SOME COMMENTS already to describe these
  but in the section below, describe in English the techniques you used
  to make the code run faster.  Format your descriptions into discrete
  chunks such as.
        Optimization 1: Blah bla blah... This should make run
        faster because yakkety yakeety yak.

        Optimization 2: Blah bla blah... This should make run
        faster because yakkety yakeety yak.

        ...  Optimization N: Blah bla blah... This should make run
        faster because yakkety yakeety yak.
  Full credit solutions will have a least two optimizations and describe
  WHY these improved performance in at least a couple sentences.

  ####################### YOUR ANSWER HERE #########################

  ##################################################################


PROBLEM 2: Timing Search Algorithms
===================================

  Do your timing study on csel-atlas.cselabs.umn.edu. In most cases,
  report times larger than 1e-03 seconds as times shorter than this are
  unreliable. Run searches for more repetitions to lengthen run times.


(A) Min Size for Algorithmic Differences
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  Determine the size of input array where one starts to see a measurable
  difference in the performance of the linear and logarithmic
  algorithms.  Produce a timing table which includes all algorithms
  which clearly demonstrates an uptick in the times associated with some
  while others remain much lower.  Identify what size this appears to be
  a occur. SHOW A TIMING TABLE to support your conclusions and ensure
  that the times reported are larger that 1e-03.

  ####################### YOUR ANSWER HERE #########################

  ##################################################################


(B) Linear Search in List vs Array
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  Determine whether the linear array and linked list search remain
  approximately at the same performance level as size increases to large
  data or whether one begins to become favorable over other. Determine
  the approximate size at which this divergence becomes obvious. Discuss
  reasons WHY this difference arises.  SHOW A TIMING TABLE to support
  your conclusions and ensure that the times reported are larger that
  1e-03.

  ####################### YOUR ANSWER HERE #########################

  ##################################################################


(C) Binary Search in Tree vs Array
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  Compare the binary array search and binary tree search on small to
  very large arrays. Determine if there is a size at which the
  performance of these two begins to diverge. If so, describe why this
  might be happening based on your understanding of the data structures
  and the memory system. If not, describe why you believe there is
  little performance difference between the two. SHOW A TIMING TABLE to
  support your conclusions and ensure that the times reported are larger
  that 1e-03.

  ####################### YOUR ANSWER HERE #########################

  ##################################################################


(D) Caching Effects on Algorithms
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  It is commonly believed that memory systems that feature a Cache will
  lead to arrays performing faster than linked structures such as Linked
  Lists and Binary Search Trees. Describe whether your timings confirm
  or refute this belief.  Address both types of algorithms in your
  answer:
  - What effects does Cache have on Linear Search in arrays and lists
    and why?
  - What effects does Cache have on Binary Search in arrays and trees
    and why?

  ####################### YOUR ANSWER HERE #########################

  ##################################################################


(E) OPTIONAL MAKEUP CREDIT
~~~~~~~~~~~~~~~~~~~~~~~~~~

  If you decided to make use of a table of function pointers/structs
  which is worth makeup credit, describe your basic design for this
  below.

  ####################### YOUR ANSWER HERE #########################

  ##################################################################
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/> <i> Author: Chris Kauffman (<a href="mailto:kauffman@umn.edu">kauffman@umn.edu</a>) <br/> Date: 2022-04-15 Fri 13:02 <br/> </i>
</div>
</body>
</html>
