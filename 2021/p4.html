<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-04-21 Fri 15:12 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CSCI 2021 Project 4: Performance Optimization and Timing</title>
<meta name="author" content="Chris Kauffman" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1" />
<style type="text/css">
@media screen {
:root {
--heading-bg-color:#e8c62e;
--heading-fg-color:#7a0019;
}
html {
font-family: serif;
text-align: justify;
}
pre.src, pre.example {
overflow-x: scroll;
}
/* Merge subtitle area with title area */
.subtitle {
text-align: center;
margin-top: -2em;
padding-top: 1em;
padding-bottom: 0.1em;
}
.title, .subtitle {
color: var(--heading-fg-color);
background-color: var(--heading-bg-color);
}
/* Section borders, left section header style */
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
blockquote {
font-style: italic;
}
td, th {
padding-top: 2px;
padding-bottom: 2px;
}
body {
background-color: #EEE;
}
pre {
}
#content, #preamble, #postamble {
margin-left:300px;
max-width: 100%;
}
.tag {
background-color: inherit; font-family: inherit;
padding: inherit; font-size: 80%; font-weight: inherit;
text-transform: uppercase;
}

.figure p { text-align: inherit; }
figure-number { font-style: italic; }
#table-of-contents {
text-align: left;
position: fixed;
left: 0;
margin: 0 auto;
padding: 0;
width: 300px;
top: 0;
height: 100%;
border: 0;
display: block;
}
#text-table-of-contents {
overflow-y: scroll;
height: 100%;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
#table-of-contents > h2 {
padding: 0.1em;
margin: 0;
}
/* adjustments for small screen, toc at top only */
@media (max-width: 800px) { /* landscape for iphone */
html {
-webkit-text-size-adjust: none;  /* prevent scaling of text on mobile */
}
body {
background-color: #EEE;
width:100%;
margin:0 auto;
}
#content, #preamble, #postamble {
margin-left:0;
}
#table-of-contents {
position: static;
left: inherit;
width:inherit;
height: auto;
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
border: 0.75em solid #006633;
}
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
#text-table-of-contents {
overflow-y: visible;
height: inherit;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
}
.linenr { font-size: xx-small; }
}

@media print {
html {
font-family: serif;
font-size: 10pt;
text-align: justify;
.linenr { font-size: xx-small; }
}
}
</style>
</head>
<body>
<div id="preamble" class="status">
<i>Last Updated: 2023-04-21 Fri 15:12</i>
</div>
<div id="content" class="content">
<h1 class="title">CSCI 2021 Project 4: Performance Optimization and Timing</h1>
<ul class="org-ul">
<li><b>Due: 11:59pm Mon 01-May-2023</b></li>
<li><i>Approximately 3.0-4.0% of total grade</i></li>
<li>Submit to <a href="https://www.gradescope.com/"><b>Gradescope</b></a></li>
<li>Projects are <b>individual work</b>: no collaboration with other students
is allowed. Seek help from course staff if you get stuck for too long.</li>
</ul>

<div id="outline-container-orgb33b10d" class="outline-4">
<h4 id="orgb33b10d">CODE/TEST DISTRIBUTION: <a href="p4-code.zip">p4-code.zip</a></h4>
</div>
<div id="outline-container-org3063875" class="outline-4">
<h4 id="org3063875">Video Overview: <i>Not yet available</i></h4>
</div>
<div id="outline-container-orge141407" class="outline-4">
<h4 id="orge141407">CHANGELOG:</h4>
<div class="outline-text-4" id="text-orge141407">
<dl class="org-dl">
<dt>Fri Apr 21 03:11:01 PM CDT 2023</dt><dd>Fixed several typos such as
incorrect totals for problem points and mention of a writing answers
in a writeup file which should instead be done in the comments in
<code>matsquare_optm.c</code></dd>

<dt>Fri Apr 21 01:05:17 PM CDT 2023</dt><dd>The missing <code>test-input/</code>
directory has been added to the codepack which should fix problems
for those attempting to run <code>make test-prob2</code>.  Download a fresh
copy of the code pack and copy this directory into your project
directory.</dd>
</dl>
</div>
</div>
<div id="outline-container-org1e8fb58" class="outline-4">
<h4 id="org1e8fb58"></h4>
<div class="outline-text-4" id="text-org1e8fb58">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org1f6c639">1. Introduction</a></li>
<li><a href="#orgd7d4654">2. Download Code and Setup</a></li>
<li><a href="#org7627c99">3. <b>Problem 1</b>: Squaring a Matrix</a>
<ul>
<li><a href="#org0769f79">3.1. Overview</a></li>
<li><a href="#org0eb7354">3.2. Optimize Matrix Squaring</a></li>
<li><a href="#orgf59f370">3.3. Evaluation on <code>loginNN</code></a></li>
<li><a href="#orgbbbad51">3.4. <code>matsquare_print.c</code> Testing Program</a></li>
<li><a href="#org110effe">3.5. Optimization Suggestions and Documentation</a></li>
<li><a href="#orgb56ae65">3.6. Grading Criteria for Problem 1 (55%)</a></li>
</ul>
</li>
<li><a href="#orgecb8862">4. <b>Problem 2</b>: showsym</a>
<ul>
<li><a href="#org4ed1465">4.1. Overview</a></li>
<li><a href="#org5db9767">4.2. ELF File References</a></li>
<li><a href="#org7bdca9a">4.3. Overall Approach</a></li>
<li><a href="#org7414623">4.4. ELF Header and Section Header Array</a></li>
<li><a href="#orgfdc5c47">4.5. String Tables, Names, Section Headers</a></li>
<li><a href="#org8e11ef5">4.6. Symbol Table and .strtab</a></li>
<li><a href="#org9f02c5b">4.7. Behavior in Error Cases</a></li>
<li><a href="#org6710247">4.8. <code>showsym</code> Template</a></li>
<li><a href="#org943b216">4.9. Grading Criteria for showsym (45%)</a></li>
</ul>
</li>
<li><a href="#orgcd52d37">5. Project Submission</a>
<ul>
<li><a href="#orgc4261b1">5.1. Submit to Gradescope</a></li>
<li><a href="#org93af712">5.2. Late Policies</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>


<div id="outline-container-org1f6c639" class="outline-2">
<h2 id="org1f6c639"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This assignment focuses on two aspects discussed in lecture over the
last month.
</p>

<ol class="org-ol">
<li>Program Optimization: The project pack provides a baseline
implementation for a function and asks for a more performant
version which runs faster. To do so, one must exploit knowledge of
the memory hierarchy and processor architecture to complete the
computations more quickly.</li>
<li>Memory Mapping a Binary file in the ELF format and locating a
specific section to access its contents.</li>
</ol>
</div>
</div>

<div id="outline-container-orgd7d4654" class="outline-2">
<h2 id="orgd7d4654"><span class="section-number-2">2</span> <a id="orgf093465"></a> Download Code and Setup</h2>
<div class="outline-text-2" id="text-2">
<p>
Download the code pack linked at the top of the page. Unzip this which
will create a project folder. Create new files in this
folder. Ultimately you will re-zip this folder to submit it.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">File</th>
<th scope="col" class="org-left">State</th>
<th scope="col" class="org-left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>Makefile</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 &amp; 2 Build file</td>
</tr>

<tr>
<td class="org-left"><code>testy</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Testing script</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>matsquare_optm.c</code></td>
<td class="org-left">EDIT</td>
<td class="org-left">Problem 1 create and fill in optimized function definition</td>
</tr>

<tr>
<td class="org-left"><code>matsquare_base.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 baseline function to beat</td>
</tr>

<tr>
<td class="org-left"><code>matsquare_benchmark.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 main benchmark</td>
</tr>

<tr>
<td class="org-left"><code>matsquare_print.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 testing program</td>
</tr>

<tr>
<td class="org-left"><code>matvec.h</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 header file</td>
</tr>

<tr>
<td class="org-left"><code>matvec_util.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 utility functions for matrices/vectors</td>
</tr>

<tr>
<td class="org-left"><code>test_matsquare.org</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Tests to check for memory issues in problem 1</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>showsym.c</code></td>
<td class="org-left">COMPLETE</td>
<td class="org-left">Problem 2 template to complete</td>
</tr>

<tr>
<td class="org-left"><code>test_showsym.org</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Problem 2 Testing script for <code>showsym</code></td>
</tr>

<tr>
<td class="org-left"><code>test-input/quote_data.o</code></td>
<td class="org-left">Data</td>
<td class="org-left">Problem 2 ELF object file for input to showsym</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Several other ELF and non-ELF files provided</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-org7627c99" class="outline-2">
<h2 id="org7627c99"><span class="section-number-2">3</span> <b>Problem 1</b>: Squaring a Matrix</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org0769f79" class="outline-3">
<h3 id="org0769f79"><span class="section-number-3">3.1</span> Overview</h3>
<div class="outline-text-3" id="text-3-1">
<p>
A problem that occasionally arises in numerical computing when working
with Matrices (2D Arrays) is to compute the <b>Square</b> of a matrix. This
is a special case of general <a href="https://en.wikipedia.org/wiki/Matrix_multiplication">matrix multiplication</a> and students
unfamiliar with this operation should study it to get some context for
the present work.  
</p>

<p>
Terminology can get a little confusing so keep the following in mind.
</p>
<ul class="org-ul">
<li>A <b>Square Matrix</b> has equal numbers of rows and columns and can be
multiplied by itself.</li>
<li><b>Squaring</b> a matrix, sometimes notated <code>M*M = M^2</code> is multiplying a
matrix by itself which can only be done if it is a square matrix
(equal rows/columns).</li>
</ul>

<p>
The diagram below illustrates the result of squaring a matrix by
multiplying it by itself.  
</p>

<div class="org-center">

<div id="org1469b95" class="figure">
<p><img src="matsquare.png" alt="matsquare.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 1: </span>3 by 3 matrix <code>M</code> with colored elements along with result of squaring the matrix as <code>M*M</code>.</p>
</div>
</div>

<p>
Note that that for each of the elements of the squared matrix, the
elements are the result of a row multiplied by a column from the
original matrix:
</p>
<div class="org-src-container">
<pre class="src src-text">MatSq[i][j] = 0;
for(k = 0 to Mat.rows){
  MatSq[i][j] += Mat[i][k] * Mat[k][j];
}
</pre>
</div>
<p>
The file <code>matsquare_base.c</code> provides a baseline function that performs
this computation in a direct fashion as the above definition indicates
The algorithm uses the most "natural" approach of multiplying each row
by each column to produce the result in the for each part of the
squared result.  As you survey the code, note the use of various
convenience macros such as <code>MGET(mat,i,j)</code> interact with the matrix
type used.
</p>

<div class="org-src-container">
<pre class="src src-c">// Baseline version
int matsquare_BASE_NORMAL(matrix_t *mat, matrix_t *matsq) {
  for(int i=0; i&lt;mat-&gt;rows; i++){
    for(int j=0; j&lt;mat-&gt;cols; j++){
      mset(matsq,i,j,0);                          // initialize to 0s
      for(int k=0; k&lt;mat-&gt;rows; k++){
        int mik = mget(mat, i, k);
        int mkj = mget(mat, k, j);
        int cur = mget(matsq, i, j);
        int new = cur + mik*mkj;
        mset(matsq, i, j, new);
      }
    }
  }
  return 0;                                       // return success
}
</pre>
</div>
<p>
Note that the original matrix comes in as the parameter <code>mat</code> and the
result of squaring the matrix is stored in the parameter <code>matsq</code>.
</p>

<p>
While this algorithm is a direct translation of how humans would
visually calculate the square of small matrices, it is unfortunately
fairly slow when executing on most modern computing systems.
</p>
</div>
</div>

<div id="outline-container-org0eb7354" class="outline-3">
<h3 id="org0eb7354"><span class="section-number-3">3.2</span> Optimize Matrix Squaring</h3>
<div class="outline-text-3" id="text-3-2">
<p>
The purpose of this problem is to write <code>matsquare_OPTM()</code> which is a
faster version of the provided <code>matsquare_BASE()</code> to calculate the
results.
</p>

<p>
Write your code in the file <code>matsquare_optm.c</code>.
</p>

<p>
Keep the following things in mind.
</p>
<ol class="org-ol">
<li>You will need to acquaint yourself with the functions and types
related to matrices and vectors provided in the <code>matvec.h</code> and
demonstrated in the baseline function. Understanding the layout of
the matrix in memory is essential to unlocking performance.</li>
<li>The goal of <code>matsquare_OPTM()</code> is to exceed the performance of
<code>matsquare_BASE()</code> by as much as possible.</li>
<li>To achieve this goal, several optimizations must be implemented and
suggestions are given in a later section.</li>
<li>You will need to document your optimizations in comments included
in the <code>matsquare_optm.c</code> file and provide timing results of
running the optimized version.</li>
<li>Part of your grade will be based on the speed of the optimized code
on the machine <code>loginNN.cselabs.umn.edu</code>. The main routine
<code>matsquare_benchmark.c</code> will be used for this.</li>
</ol>

<p>
Some details are provided in subsequent sections.
</p>
</div>
</div>

<div id="outline-container-orgf59f370" class="outline-3">
<h3 id="orgf59f370"><span class="section-number-3">3.3</span> Evaluation on <code>loginNN</code></h3>
<div class="outline-text-3" id="text-3-3">
<p>
The provided file <code>matsquare_benchmark.c</code> provides a benchmark for the
speed of squaring a matrix. It will be used by graders to evaluate the
submitted code and should be used during development to gauge
performance improvements.
</p>

<p>
The following machines may be used to evaluate the benchmark:
</p>
<div class="org-src-container">
<pre class="src src-text">login01.cselabs.umn.edu  OR  csel-remote-lnx-01.cselabs.umn.edu
login02.cselabs.umn.edu  OR  csel-remote-lnx-02.cselabs.umn.edu
login03.cselabs.umn.edu  OR  csel-remote-lnx-03.cselabs.umn.edu
login04.cselabs.umn.edu  OR  csel-remote-lnx-04.cselabs.umn.edu
login05.cselabs.umn.edu  OR  csel-remote-lnx-05.cselabs.umn.edu
login06.cselabs.umn.edu  OR  csel-remote-lnx-06.cselabs.umn.edu
login07.cselabs.umn.edu  OR  csel-remote-lnx-07.cselabs.umn.edu
</pre>
</div>
<p>
These are newer server machines with quite a few processors and are
not virtualized making them ideal for performance benchmarks.
</p>

<p>
The scoring present in <code>matsquare_benchmark.c</code> is "tuned" to these
machines and will likely report incorrect results on other machines.
That means that codes should be <b>tested on loginNN machines</b> so that
no unexpected results occur after submission. Results reported should
be from one of <code>loginNN</code>.
</p>

<p>
The output of the <code>matsquare_benchmark</code> is shown below.
</p>
<ul class="org-ul">
<li>SIZE: the size of the matrix being used. The benchmark always
uses square matrices</li>
<li>Runtimes for the 2 functions
<ul class="org-ul">
<li>BASE: the time it takes for <code>matsquare_BASE()</code> to complete.</li>
<li>OPTM: the time it takes for <code>matsquare_OPTM()</code> to complete.</li>
</ul></li>
<li>SPDUP: the speedup of <code>matsquare_OPTM()</code> over <code>matsquare_BASE()</code> which
is <code>BASE / OPTM</code>.</li>
<li><p>
POINTS: which are earned according to the following code:
</p>
<div class="org-src-container">
<pre class="src src-c">    double speedup_OPTM = (cpu_time_BASE / cpu_time_OPTM); // Scoring based on speedup
    double log2_speedup = log(speedup_OPTM) / log(2.0);    // 2X speedup starts at 1 point
    double scale =  size / SCALE_FACTOR;                   // Larger sizes give more points
    double points = log2_speedup * scale;                  // 
    points = points &lt; 0 ? 0.0 : points;                    // No negative points
</pre>
</div>
<p>
This scheme, while a little involved, means that unless actual
optimizations are implemented, 0 points will be scored. It is also
weighted towards earning more points on for larger size matrices.
</p></li>
</ul>

<p>
Below are several demonstration runs of <code>matsquare_benchmark</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh"># BUILD/RUN ON NON-CSEL-KH1250-NN MACHINE: NOTE WARNINGS
homeputer&gt; make
gcc -Wall -Werror -g -Og -c matsquare_print.c
gcc -Wall -Werror -g -Og -c matvec_util.c
gcc -Wall -Werror -g -Og -c matsquare_base.c
gcc -Wall -Werror -g -Og -c matsquare_optm.c
gcc -Wall -Werror -g -Og -o matsquare_print matsquare_print.o matvec_util.o matsquare_base.o matsquare_optm.o
gcc -Wall -Werror -g -Og -c matsquare_benchmark.c
gcc -Wall -Werror -g -Og -o matsquare_benchmark matsquare_benchmark.o matvec_util.o matsquare_base.o matsquare_optm.o -lm
...

homeputer&gt; ./matsquare_benchmark 
WARNING: expected host 'csel-remote-lnx-NN' but got host 'val'
WARNING: timing results / scoring will not reflect actual scoring
WARNING: run on host 'csel-remote-lnx-NN' for accurate results
==== Matrix Square Benchmark Version 2 ====
  SIZE       BASE       OPTM  SPDUP   LOG2  SCALE POINTS 
   256 3.6133e-01 5.8248e-02   6.20   2.63   0.94   2.47 
   273 3.7156e-01 7.0970e-02   5.24   2.39   1.00   2.39 
   512 3.4430e+00 4.5978e-01   7.49   2.90   1.88   5.45 
   801 9.7616e+00 1.7626e+00   5.54   2.47   2.93   7.25 
  1024 4.3545e+01 3.6822e+00  11.83   3.56   3.75  13.37 
RAW POINTS: 30.92
TOTAL POINTS: 30 / 30
WARNING: expected host 'csel-remote-lnx-NN' but got host 'val'
WARNING: timing results / scoring will not reflect actual scoring
WARNING: run on host 'csel-remote-lnx-NN' for accurate results

# PARTIAL CREDIT RUN
csel-remote-lnx-06&gt; ./matsquare_benchmark 
==== Matrix Square Benchmark Version 2 ====
  SIZE       BASE       OPTM  SPDUP   LOG2  SCALE POINTS 
   256 4.0254e-01 1.0640e-01   3.78   1.92   0.94   1.80 
   273 3.8679e-01 1.0814e-01   3.58   1.84   1.00   1.84 
   512 3.7187e+00 1.1006e+00   3.38   1.76   1.88   3.29 
   801 1.2810e+01 2.9671e+00   4.32   2.11   2.93   6.19 
  1024 3.3382e+01 1.1026e+01   3.03   1.60   3.75   5.99 
RAW POINTS: 19.12
TOTAL POINTS: 19 / 30

# FULL CREDIT RUN
csel-remote-lnx-06&gt; ./matsquare_benchmark 
==== Matrix Square Benchmark Version 2 ====
  SIZE       BASE       OPTM  SPDUP   LOG2  SCALE POINTS 
   256 3.4854e-01 4.2761e-02   8.15   3.03   0.94   2.84 
   273 3.5633e-01 5.2120e-02   6.84   2.77   1.00   2.77 
   512 3.4802e+00 3.5176e-01   9.89   3.31   1.88   6.20 
   801 1.1208e+01 1.3412e+00   8.36   3.06   2.93   8.99 
  1024 3.3112e+01 2.8701e+00  11.54   3.53   3.75  13.23 
RAW POINTS: 34.03
TOTAL POINTS: 30 / 30
</pre>
</div>

<p>
Note that it is possible to exceed the score associated with maximal
performance (as seen in the RAW POINTS reported) but no more than the
final reported points will be given for the performance portion of the
problem. <i>There may be Makeup Credit associate with sufficient
speedups;</i> <i>if this occurs, output for the program will make it
obvious that bonus credit has been awarded.</i>
</p>
</div>
</div>

<div id="outline-container-orgbbbad51" class="outline-3">
<h3 id="orgbbbad51"><span class="section-number-3">3.4</span> <code>matsquare_print.c</code> Testing Program</h3>
<div class="outline-text-3" id="text-3-4">
<p>
As one works on implementing optimizations in <code>matsquare_OPTM()</code>, bugs
which compute incorrect results are often introduced.  To aid in
testing, the <code>matsquare_print()</code> program runs both the BASE and OPTM
versions on the same matrix and shows all results. The matrix size is
determined from the command line and is printed on the screen to
enable hand verification. Examples are below.
</p>

<div class="org-src-container">
<pre class="src src-sh">./matsquare_print 3             # run on 3 by 3 matrix
==== Matrix Square Print ====
Original Matrix:                # original test matrix
3 x 3 matrix
   0:      0      1      2 
   1:      3      4      5 
   2:      6      7      8 

BASE Matrix Squared :           # results for matsquare_BASE()
3 x 3 matrix
   0:     15     18     21 
   1:     42     54     66 
   2:     69     90    111 

OPTM Matrix Squared :           # results for matsquare_OPTM()
3 x 3 matrix
   0:     15     18     21 
   1:     42     59     66 
   2:     69    103    111 

BASE/OPTM Element Comparison:
[  i][  j]:   BASE   OPTM       # elemnent by element comparison
[  0][  0]:     15     15       # to help spot errors in results
[  0][  1]:     18     18       # for matsquare_OPTM()
[  0][  2]:     21     21 
[  1][  0]:     42     42 
[  1][  1]:     54     59 ***   # NON-matching
[  1][  2]:     66     66 
[  2][  0]:     69     69 
[  2][  1]:     90    103 ***   # NON-matching
[  2][  2]:    111    111 

</pre>
</div>
</div>
</div>


<div id="outline-container-org110effe" class="outline-3">
<h3 id="org110effe"><span class="section-number-3">3.5</span> <a id="orgcdb6693"></a> Optimization Suggestions and Documentation</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Labs and lectures have covered several kinds of optimizations which
are useful to improve the speed of <code>matsquare_OPTM()</code>.  These techniques
include:
</p>
<ul class="org-ul">
<li>Re-ordering memory accesses to be as sequential as possible which
favors cache (<b>very important</b>)</li>
<li>Increasing potential processor pipelining by adjusting the
destinations of arithmetic operations.</li>
<li>Decreasing any unnecessary work such as memory accesses or
arithmetic operations.</li>
</ul>
<p>
These should be sufficient to gain full credit though you are free to
explore additional optimizations.
</p>

<p>
One handy realization most folks will reach is that it is useful to
recognize a way to re-order the memory access pattern to favor
cache. Recall that the most favorable access pattern for most matrix
computations in a row-major programming environment like C is to work
across rows.  Below is a diagram which suggests one possible way to do
this in the context of squaring a matrix.  It favors repeated walking
across a matrix in a row-wise fashion to avoid the stride required for
column-wise access.  Study this diagram carefully and consider
implementing the approach illustrated as your first optimization. As
discussed in lecture, if data is not getting to the processor, other
optimizations that favor pipelining/superscalar execution will have no
effect so focusing first on the memory access pattern is crucial.
</p>

<div class="org-center">

<div id="org03cf6be" class="figure">
<p><img src="matsquare-order.png" alt="matsquare-order.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 2: </span>Illustration of how to favor row-wise access to compute squared matrix. Computation of first row results are shown with the beginnings of the second row.</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgb56ae65" class="outline-3 grading55">
<h3 id="orgb56ae65"><span class="section-number-3">3.6</span> Grading Criteria for Problem 1 (55%)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading55">grading55</span></span></h3>
<div class="outline-text-3" id="text-3-6">
<p>
In addition to completing the code and the points associated with its
performance, answer the questions that appear below the source code
template to report your performance and your approach to optimizing.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Weight</th>
<th scope="col" class="org-left">Criteria</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><b>Automated Tests</b></td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">No memory errors reported by Valgrind via <code>make test-prob1</code></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><b>Manual Inspection of <code>matsquare_optm.c</code></b></td>
</tr>

<tr>
<td class="org-right">30</td>
<td class="org-left">Performance of <code>matsquare_OPTM()</code> on <code>loginNN.cselabs.umn.edu</code> measured during grading</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">Answer for (B) Timing Table in comments of <code>matsquare_optm.c</code></td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">Answer for (C) Optimizations in comments of <code>matsquare_optm.c</code></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">55</td>
<td class="org-left">Problem Total</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


<div id="outline-container-orgecb8862" class="outline-2">
<h2 id="orgecb8862"><span class="section-number-2">4</span> <b>Problem 2</b>: showsym</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org4ed1465" class="outline-3">
<h3 id="org4ed1465"><span class="section-number-3">4.1</span> Overview</h3>
<div class="outline-text-3" id="text-4-1">
<p>
The <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">Executable and Linkable (ELF) File Format</a> is the Unix standard for
binary files with runnable code in them.  By default, any executable
or <code>.o</code> file produced by Unix compilers such as GCC produce ELF
files as evidenced by the <code>file</code> command.
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; gcc -c code.c

&gt;&gt; file code.o
code.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped

&gt;&gt; gcc program.c

&gt;&gt; file a.out
a.out: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0
</pre>
</div>

<p>
This problem explores the file format of ELF in order to show any
<b>symbol table</b> present.  The symbol table contains information on
publicly accessible items in the file such as functions and global
data. The standard utility <code>readelf</code> shows human readable versions of
ELF files and the <code>-s</code> option specifically prints out the symbol table
section.
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; readelf -s test-input/quote_data.o

Symbol table '.symtab' contains 17 entries:
   Num:    Value          Size Type    Bind   Vis      Ndx Name
     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND 
     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS quote_data.c
     2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1 
     3: 0000000000000000     0 SECTION LOCAL  DEFAULT    3 
     4: 0000000000000000     0 SECTION LOCAL  DEFAULT    4 
     5: 0000000000000000     0 SECTION LOCAL  DEFAULT    5 
     6: 0000000000000000     0 SECTION LOCAL  DEFAULT    6 
     7: 0000000000000000     0 SECTION LOCAL  DEFAULT    9 
     8: 0000000000000000     0 SECTION LOCAL  DEFAULT   10 
     9: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT    5 .LC0
    10: 0000000000000000     0 SECTION LOCAL  DEFAULT    8 
    11: 0000000000000000    11 FUNC    GLOBAL DEFAULT    1 max_size
    12: 0000000000000000     8 OBJECT  GLOBAL DEFAULT    6 choices
    13: 000000000000000b    60 FUNC    GLOBAL DEFAULT    1 list_get
    14: 0000000000000047    30 FUNC    GLOBAL DEFAULT    1 get_it
    15: 0000000000000010    16 OBJECT  GLOBAL DEFAULT    6 choices_actual
    16: 0000000000000020  3960 OBJECT  GLOBAL DEFAULT    6 nodes
</pre>
</div>

<p>
This problem re-implements this functionality in the <code>showsym</code> program
to instruct on some the format of the ELF file. It has the following
output.
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; gcc -o showsym showsym.c                    # compile showsym

&gt;&gt; ./showsym test-input/quote_data.o           # run on provided data file
Symbol Table                                   # output of program
- 4296 bytes offset from start of file         # location and size of symbol table 
- 408 bytes total size
- 24 bytes per entry
- 17 entries
[idx]      TYPE SIZE NAME                      # symbol table entries
[  0]:   NOTYPE    0 &lt;NONE&gt;
[  1]:     FILE    0 quote_data.c
[  2]:  SECTION    0 &lt;NONE&gt;
[  3]:  SECTION    0 &lt;NONE&gt;
[  4]:  SECTION    0 &lt;NONE&gt;
[  5]:  SECTION    0 &lt;NONE&gt;
[  6]:  SECTION    0 &lt;NONE&gt;
[  7]:  SECTION    0 &lt;NONE&gt;
[  8]:  SECTION    0 &lt;NONE&gt;
[  9]:   NOTYPE    0 .LC0
[ 10]:  SECTION    0 &lt;NONE&gt;
[ 11]:     FUNC   11 max_size
[ 12]:   OBJECT    8 choices
[ 13]:     FUNC   60 list_get
[ 14]:     FUNC   30 get_it
[ 15]:   OBJECT   16 choices_actual
[ 16]:   OBJECT 3960 nodes

&gt; showsym test-input/quote_main.c              # some files are not ELF file format
Magic bytes wrong, this is not an ELF file

&gt; showsym test-input/ls                        # some ELF files don't have symbol tables
Couldn't find symbol table
</pre>
</div>

<p>
The output of <code>showsym</code> is a similar to <code>readelf -s</code> but abbreviated,
showing only information on public symbols in the ELF file.
</p>
</div>
</div>

<div id="outline-container-org5db9767" class="outline-3">
<h3 id="org5db9767"><span class="section-number-3">4.2</span> ELF File References</h3>
<div class="outline-text-3" id="text-4-2">
<p>
It is recommended to do some reading on the structure of the ELF
format as it will assist in coming to grips with this problem. As you
encounter parts of the below walk-through of how to find and print the
symbol table, refer to the following resources.
</p>
<ul class="org-ul">
<li>Diagrams shown below provide some information about the basics of
what is provided in each portion of the file and how some of the
records relate to each other.</li>
<li><a href="http://man7.org/linux/man-pages/man5/elf.5.html">Manual Pages</a>: The manual page on ELF (found online or by typing <code>man
  elf</code> in any terminal) gives <i>excellent</i> coverage of the structs and
values in the file format. Essentially the entire format is covered
here though there may be a few ambiguities.</li>
<li><a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">Wikipedia</a>: A good overview of the file format and has some
extensive tables on the structs/values that comprise it.</li>
<li><a href="https://docs.oracle.com/cd/E23824_01/html/819-0690/chapter6-43405.html#scrolltoc">Oracle Docs</a>: A somewhat more detailed and hyper-linked version of
the manual pages.</li>
</ul>

<p>
Note that we will use the <b>64-bit ELF format only</b> which means most of
the C types for variables should mention <code>ELF64_xxx</code> in them though
use of 32-bit integers may still apply via <code>uint32_t</code>.
</p>
</div>
</div>

<div id="outline-container-org7bdca9a" class="outline-3">
<h3 id="org7bdca9a"><span class="section-number-3">4.3</span> Overall Approach</h3>
<div class="outline-text-3" id="text-4-3">
<p>
ELF files are divided into sections. Our main interest is to identify
the Symbol Table section but this is done in several steps.
</p>
<ol class="org-ol">
<li>Parse the File Header to identify the positions of the Section
Header Array and Section Header String Table</li>
<li>Search the Section Header Array and associated string table to find
the section named <code>.symtab</code> which is the symbol table and <code>.strtab</code>
which contains the string names of the symbol table. Note the
position in the file of these two</li>
<li>Iterate through the Symbol Table section which is also an array of
structs. Use the fields present there along with the associated
string names in <code>.strtab</code> to print each symbol and some associated
information.</li>
</ol>

<p>
Since this is a binary file with a considerable amount of jumping and
casting to structs, it makes sense to use <code>mmap()</code> to map the entire
file into virtual memory. <b>It is a requirement to use mmap() for this
problem</b>. Refer to lecture notes, textbook, and lab materials for
details on how to set up a memory map and clean it up once
finished. In particular <b>Lab 13 uses mmap() to parse binary files</b> in
a way that is directly relevant to the present program.
</p>
</div>
</div>

<div id="outline-container-org7414623" class="outline-3">
<h3 id="org7414623"><span class="section-number-3">4.4</span> ELF Header and Section Header Array</h3>
<div class="outline-text-3" id="text-4-4">
<p>
The initial bytes in an ELF file always have a fixed structure which
is the <code>ELF64_Ehdr</code> type.  Of primary interest are the following
</p>
<ol class="org-ol">
<li><p>
Identification bytes and types in the field <code>e_ident[]</code>. These
initial bytes identify the file as ELF format or NOT (will check for
this).
</p>

<p>
<code>showsym</code> should check these "magic bytes" (first elements of
<code>e_ident[]</code> in header). If they match the expected values, proceed
but if they are incorrect, print the message:
</p>
<pre class="example">
ERROR: Magic bytes wrong, this is not an ELF file
</pre>

<p>
and exit immediately.
</p></li>

<li>The Section Header Array byte position in the field <code>e_shoff</code>.  The
Section Header Array is like a table of contents for a book giving
positions of most other sections in the file. It usually occurs near
the end of the file.</li>
<li>The index of the Section Header String Table in field
<code>e_shstrndx</code>. This integer gives an index into the Section Header
Array where a string table can be found containing the names of
headers.</li>
</ol>

<p>
The following diagram shows the layout of these first few important
parts of an ELF file. 
</p>

<div class="org-center">

<div id="org1616577" class="figure">
<p><img src="elf1.png" alt="elf1.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 3: </span>ELF File Header with Section Header Array and Section Header String Table.</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfdc5c47" class="outline-3">
<h3 id="orgfdc5c47"><span class="section-number-3">4.5</span> String Tables, Names, Section Headers</h3>
<div class="outline-text-3" id="text-4-5">
<p>
To keep the sizes of structures fixed while still allowing variable
length names for things, all the names that are stored in ELF files
are in <b>string tables</b>.  You can see one of these laid in the middle
purple section of the diagram above starting at byte offset 1000. It
is simply a sequence of multiple null-terminated strings laid out
adjacent to one another in the file.
</p>

<p>
When a name is required, a field will give an offset into a specific
string table.  For example, each entry of the Section Header Array has
an <code>sh_name</code> field which is an offset into the <code>.shstrtab</code> (the <code>sh</code>
is for "section header").. The offset indicates how far from the start
of the string table to find the require name.
</p>
<ul class="org-ul">
<li>The <code>.shstrtab</code> section begins at byte 1000 so all name positions
are <code>1000 + sh_name</code></li>
<li>The 0th <code>.text</code> section has <code>sh_name = 0</code>; the string <code>.text\0</code>
appears at position 1000.</li>
<li>The 1th <code>.symtab</code> section has <code>sh_name = 6</code>; the string <code>.symtab\0</code>
appears at byte position 1006.</li>
<li>The 4th <code>.bss</code> section has <code>sh_name = 32</code>; the string <code>.bss\0</code>
appears at byte position 1032.</li>
</ul>

<p>
The Section Header Array is an array of <code>Elf64_Shdr</code> structs.  By
iterating over this array, fishing out the names from <code>.shstrtab</code>, and
examining names using <code>strcmp()</code>, the positions for the two desired
sections, <code>.symtab</code> and <code>.strtab</code> can be obtained via the associated
<code>sh_offset</code> field.
</p>

<p>
Note that one will need to also determine length of the Section Header
Array from the ELF File Header field <code>e_shnum</code>. 
</p>

<p>
Also, on finding the Symbol Table section, <b>note its size in bytes</b>
from the <code>sh_size</code> field. This will allow you to determine the number
of symbol table entries.
</p>
</div>
</div>

<div id="outline-container-org8e11ef5" class="outline-3">
<h3 id="org8e11ef5"><span class="section-number-3">4.6</span> Symbol Table and .strtab</h3>
<div class="outline-text-3" id="text-4-6">
<p>
Similar to the Section Header Array, the Symbol Table is comprised of
an array of <code>Elf64_Sym</code> structs.  Each of these structs has a
<code>st_name</code> field giving an offset into the <code>.symtab</code> section where a
symbol's name resides. The following diagram shows this relationship.
</p>

<div class="org-center">

<div id="org4be0a1c" class="figure">
<p><img src="elf2.png" alt="elf2.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 4: </span>ELF Symbol Table and associated String Table</p>
</div>
</div>

<p>
While iterating over the table, print the following information.
</p>
<ul class="org-ul">
<li>The index starting at 0 (note that index 0 will always contain a
blank entry)</li>
<li>The type of symbol which can be determined using the methods below</li>
<li>The size from the <code>st_size</code> field. This corresponds to the number of
bytes a variable will occupy or the number of bytes of instructions
for a function.</li>
<li>The name of the symbol or <code>&lt;NONE&gt;</code> if the symbol's name has
length 0. Use the <code>st_name</code> field which is an offset into the
<code>.strtab</code> where the name of the symbol is located.</li>
</ul>

<p>
To determine the symbol's type, make use of the following code
</p>
<div class="org-src-container">
<pre class="src src-c">unsigned char typec = ELF64_ST_TYPE(symtable_entry[i].st_info);
</pre>
</div>
<p>
This macro extracts bits from the <code>st_info</code> field and assigns them to
<code>typec</code> which will be one of the following defined variables.
</p>
<div class="org-src-container">
<pre class="src src-text">- STT_NOTYPE  : print type "NOTYPE"  
- STT_OBJECT  : print type "OBJECT"  
- STT_FUNC    : print type "FUNC"    
- STT_FILE    : print type "FILE"    
- STT_SECTION : print type "SECTION" 
</pre>
</div>
<p>
An <code>if/else</code> or <code>switch/case</code> block to determine the type is best here.
</p>
</div>
</div>

<div id="outline-container-org9f02c5b" class="outline-3">
<h3 id="org9f02c5b"><span class="section-number-3">4.7</span> <a id="org6782df5"></a> Behavior in Error Cases</h3>
<div class="outline-text-3" id="text-4-7">
<p>
The following errors can occur during execution of <code>showsym</code> and
should result in the given error messages being printed.
</p>
</div>

<div id="outline-container-org23063de" class="outline-4">
<h4 id="org23063de">Wrong Magic Bytes</h4>
<div class="outline-text-4" id="text-org23063de">
<p>
<code>showsym</code> should check these "magic bytes" (first elements of
<code>e_ident[]</code> in header). If they match the expected values, proceed but
if they are incorrect, print the following example message
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; ./showsym test-input/globals.c 
ERROR: Magic bytes wrong, this is not an ELF file
</pre>
</div>
</div>
</div>

<div id="outline-container-org06e6f37" class="outline-4">
<h4 id="org06e6f37">Missing Symbol Tables</h4>
<div class="outline-text-4" id="text-org06e6f37">
<p>
During the search for the symbol table, it is possible that it is not
found. Such objects are usually executables that have been "stripped"
of a symbol table. After iterating through all sections in the Section
Header array and finding that no entry has the <code>.symtab</code> name print
the message in the example below.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; ./showsym test-input/naked_globals
ERROR: Couldn't find symbol table
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6710247" class="outline-3">
<h3 id="org6710247"><span class="section-number-3">4.8</span> <code>showsym</code> Template</h3>
<div class="outline-text-3" id="text-4-8">
<p>
A basic template for <code>showsym.c</code> is provided in the code pack which
outlines the structure of the code along with some printing formats to
make the output match examples. Follow this outline closely to make
sure that your code complies with tests when the become available.
</p>
</div>
</div>

<div id="outline-container-org943b216" class="outline-3 grading45">
<h3 id="org943b216"><span class="section-number-3">4.9</span> Grading Criteria for showsym (45%)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading45">grading45</span></span></h3>
<div class="outline-text-3" id="text-4-9">
<p>
Both binary and shell tests can be run with <code>make test-p2</code>
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Weight</th>
<th scope="col" class="org-left">Criteria</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><b>Automated Tests</b></td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left"><code>make test-prob1</code> runs 10 tests with Valgrind checking for memory problems</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><code>make test-prob1 tesnum=5</code> to run individual tests</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><b>Manual Inspection</b></td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Correctly sets up a memory map using <code>open(), fstat(), mmap()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Correct unmap and close of file description at end of execution</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Sets a pointer to the ELF File Header properly</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Checks identifying bytes for sequence <code>{0x7f,'E','L','F'}</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Properly extracts the Section Header Array offset, length, string table index</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">Sets up pointers to Section Header Array and associate String Table</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Loops over Section Header Array for sections named <code>.symtab / .strtab</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Properly uses SH String Table to look at names of each section while searching</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Extracts offsets and sizes of <code>.symtab / .strtab</code> sections</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">Prints information on byte position of symbol table and its size</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Sets up pointer to Symbol Table and associated String Table</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Loops over entries in Symbol Table printing name, size, type</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Uses <code>ELF64_ST_TYPE()</code> to extract symbol type from <code>st_info</code> field</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Style (Clean, readable code)</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">45</td>
<td class="org-left">Problem Total</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgcd52d37" class="outline-2">
<h2 id="orgcd52d37"><span class="section-number-2">5</span> Project Submission</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgc4261b1" class="outline-3">
<h3 id="orgc4261b1"><span class="section-number-3">5.1</span> <a id="org4e3b9dd"></a> Submit to Gradescope</h3>
<div class="outline-text-3" id="text-5-1">
<ol class="org-ol">
<li><p>
In a terminal, change to your project code directory and type
<b>make zip</b> which will create a zip file of your code. A session
should look like this:
</p>
<div class="org-src-container">
<pre class="src src-sh">   &gt; cd Desktop/2021/p4-code      # location of project code

   &gt; ls 
   Makefile    matsquare_optm.c    test-input/
   ...

   &gt; make zip                     # create a zip file using Makefile target
   rm -f p4-code.zip
   cd .. &amp;&amp; zip "p4-code/p4-code.zip" -r "p4-code"
     adding: p4-code/ (stored 0%)
     adding: p4-code/matsquare_optm.c (deflated 72%)
     adding: p4-code/Makefile (deflated 49%)
     ...
   Zip created in p4-code.zip

   &gt; ls p4-code.zip
   p4-code.zip
</pre>
</div></li>
<li>Log into <a href="https://www.gradescope.com/">Gradescope</a> and locate and click Project 5' which will
open up submission</li>
<li>Click on the 'Drag and Drop' text which will open a file selection
dialog; locate and choose your <code>p5-code.zip</code> file</li>
<li>This will show the contents of the Zip file and should include your
C source files along with testing files and directories.</li>
<li>Click 'Upload' which will show progress uploading files.  It may
take a few seconds before this dialog closes to indicate that the
upload is successful. Note: there is a limit of 256 files per
upload; normal submissions are not likely to have problems with
this but you may want to make sure that nothing has gone wrong such
as infinite loops creating many files or incredibly large files.</li>
<li>Once files have successfully uploaded, the Autograder will begin
running the command line tests and recording results.  These are
the same tests that are run via <code>make test</code>.</li>
<li>When the tests have completed, results will be displayed
summarizing scores along with output for each batch of tests.</li>
<li>Refer to the <a href="https://www-users.cs.umn.edu/~kauffman/2021/p1.html">Submission instructions for P1</a> for details and
pictures.</li>
</ol>
</div>
</div>

<div id="outline-container-org93af712" class="outline-3">
<h3 id="org93af712"><span class="section-number-3">5.2</span> Late Policies</h3>
<div class="outline-text-3" id="text-5-2">
<p>
You may wish to review the policy on late project submission which
will cost you late tokens to submit late or credit if you run out of
tokens. <b>No projects will be accepted more than 48 hours after the
deadline.</b>
</p>

<p>
<a href="https://www-users.cs.umn.edu/~kauffman/2021/syllabus.html">https://www-users.cs.umn.edu/~kauffman/2021/syllabus.html</a>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/> <i> Author: Chris Kauffman (<a href="mailto:kauffman@umn.edu">kauffman@umn.edu</a>) <br/> Date: 2023-04-21 Fri 15:12 <br/> </i>
</div>
</body>
</html>
