<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-12-14 Tue 11:36 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CSCI 2021 Project 5: ELF File Symbol Modification</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Chris Kauffman" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1" />
<style type="text/css">
@media screen {
:root {
--heading-bg-color:#e8c62e;
--heading-fg-color:#7a0019;
}
html {
font-family: serif;
text-align: justify;
}
pre.src, pre.example {
overflow-x: scroll;
}
/* Merge subtitle area with title area */
.subtitle {
text-align: center;
margin-top: -2em;
padding-top: 1em;
padding-bottom: 0.1em;
}
.title, .subtitle {
color: var(--heading-fg-color);
background-color: var(--heading-bg-color);
}
/* Section borders, left section header style */
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
blockquote {
font-style: italic;
}
td, th {
padding-top: 2px;
padding-bottom: 2px;
}
body {
background-color: #EEE;
}
pre {
}
#content, #preamble, #postamble {
margin-left:300px;
}
.tag {
background-color: inherit; font-family: inherit;
padding: inherit; font-size: 80%; font-weight: inherit;
text-transform: uppercase;
}

.figure p { text-align: inherit; }
figure-number { font-style: italic; }
#table-of-contents {
text-align: left;
position: fixed;
left: 0;
margin: 0 auto;
padding: 0;
width: 300px;
top: 0;
height: 100%;
border: 0;
display: block;
}
#text-table-of-contents {
overflow-y: scroll;
height: 100%;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
#table-of-contents > h2 {
padding: 0.1em;
margin: 0;
}
/* adjustments for small screen, toc at top only */
@media (max-width: 800px) { /* landscape for iphone */
html {
-webkit-text-size-adjust: none;  /* prevent scaling of text on mobile */
}
body {
background-color: #EEE;
width:100%;
margin:0 auto;
}
#content, #preamble, #postamble {
margin-left:0;
}
#table-of-contents {
position: static;
left: inherit;
width:inherit;
height: auto;
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
border: 0.75em solid #006633;
}
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
#text-table-of-contents {
overflow-y: visible;
height: inherit;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
}
.linenr { font-size: xx-small; }
}

@media print {
html {
font-family: serif;
font-size: 10pt;
text-align: justify;
.linenr { font-size: xx-small; }
}
}
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="preamble" class="status">
<i>Last Updated: 2021-12-14 Tue 11:36</i>
</div>
<div id="content">
<h1 class="title">CSCI 2021 Project 5: ELF File Symbol Modification</h1>
<ul class="org-ul">
<li><b>Due: 11:59pm Mon 12/15/2021</b></li>
<li><i>Approximately 3.0-4.0% of total grade</i></li>
<li>Submit to <a href="https://www.gradescope.com/"><b>Gradescope</b></a></li>
<li>Projects are <b>individual work</b>: no collaboration with other students
is allowed. Seek help from course staff if you get stuck for too long.</li>
</ul>

<div id="outline-container-org1cd9c76" class="outline-4">
<h4 id="org1cd9c76">CODE DISTRIBUTION: <a href="p5-code.zip">p5-code.zip</a></h4>
<div class="outline-text-4" id="text-org1cd9c76">
</div>
</div>

<div id="outline-container-org8f1669a" class="outline-4">
<h4 id="org8f1669a">CHANGELOG:</h4>
<div class="outline-text-4" id="text-org8f1669a">
<dl class="org-dl">
<dt>Tue Dec 14 11:17:47 AM CST 2021</dt><dd><p>
Minor typo corrections / diagram updates were made to the
spec. Submission is now open on Gradescope.
</p>

<p>
A small bug in the <code>Makefile</code> might lead to some spurious errors
being reported during automated testing. If you get messages like
<code>valgrind: globals permission denied</code> then make the following
modification to your <code>Makefile</code> (or download the codepack which has
the update).
</p>
<div class="org-src-container">
<pre class="src src-makefile">  # TESTING TARGETS
  test: test-prob1
  
  test-setup :
  	@chmod u+rx testy
  	@chmod u+rx -R test-input   # ADD THIS LINE

  test-prob1: patchsym test-setup 
  ...
</pre>
</div></dd>
</dl>


<dl class="org-dl">
<dt>Thu Dec  9 03:57:25 PM CST 2021</dt><dd><p>
As reported in <a href="https://piazza.com/class/ksuvqq1tdpo2jx?cid=411">Post 411</a> the template program was inadvertently named
<code>patchsymc.c</code> in the original codepack rather than just
<code>patchsym.c</code>. Rename the file or re-download the codepack as this
has been corrected.
</p>

<p>
The <code>PTR_PLUS_BYTES()</code> macro from lab 14 has also been copied into
the template and its use is <b>strongly</b> encouraged as it will help
avoid pointer arithmetic problems.
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-org7cd1353" class="outline-4">
<h4 id="org7cd1353"></h4>
<div class="outline-text-4" id="text-org7cd1353">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org4147512">1. Overview</a></li>
<li><a href="#orgb817cda">2. Download Code and Setup</a></li>
<li><a href="#org804729b">3. <b>Problem 1</b>: Changing ELF Symbol Values</a>
<ul>
<li><a href="#orgfd24867">3.1. ELF File References</a></li>
<li><a href="#org0b316d1">3.2. Overall Approach</a></li>
<li><a href="#org925bc67">3.3. ELF Header and Section Header Array</a></li>
<li><a href="#orgbc7ce49">3.4. String Tables, Names, Section Headers</a></li>
<li><a href="#org40ae619">3.5. The <code>.data</code> Section and its Address</a></li>
<li><a href="#org2e4442a">3.6. Symbol Table and <code>.strtab</code></a></li>
<li><a href="#org5483b4f">3.7. Altering a String Value</a></li>
<li><a href="#org4a035e0">3.8. Example Invocations</a></li>
<li><a href="#org902781c">3.9. Behavior in Error Cases</a></li>
<li><a href="#orgddccd5d">3.10. <code>patchsym</code> Template</a></li>
<li><a href="#orge713af1">3.11. Automated Tests for Problem 1</a></li>
<li><a href="#orge554c5c">3.12. Grading Criteria for <code>patchsym</code></a></li>
</ul>
</li>
<li><a href="#orge244952">4. Project Submission</a>
<ul>
<li><a href="#org767f99f">4.1. Submit to Gradescope</a></li>
<li><a href="#org6141ea6">4.2. Late Policies</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org4147512" class="outline-2">
<h2 id="org4147512"><span class="section-number-2">1</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<p>
This project features a single required problem pertaining to the
final topics discussed in lecture.
</p>

<p>
<code>patchsym</code> uses <code>mmap()</code> to parse a binary ELF file to make changes to
a global symbol.  Tools that work with object files like the linker
associated with the GCC and the program loader must perform similar
though more involved tasks involving ELF files. <code>mmap()</code> is very
useful for handling binary files and is demonstrated in Lab 14.
</p>
</div>
</div>

<div id="outline-container-orgb817cda" class="outline-2">
<h2 id="orgb817cda"><span class="section-number-2">2</span> <a id="org96762f4"></a> Download Code and Setup</h2>
<div class="outline-text-2" id="text-2">
<p>
Download the code pack linked at the top of the page. Unzip this which
will create a project folder. Create new files in this
folder. Ultimately you will re-zip this folder to submit it.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">File</th>
<th scope="col" class="org-left">State</th>
<th scope="col" class="org-left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>Makefile</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Build file to compile all programs</td>
</tr>

<tr>
<td class="org-left"><code>testy</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Test running script</td>
</tr>

<tr>
<td class="org-left"><code>test-input/*</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Problem 1 and 2: Directory with required data files</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>patchsym.c</code></td>
<td class="org-left">COMPLETE</td>
<td class="org-left">Problem 2 template to complete</td>
</tr>

<tr>
<td class="org-left"><code>test-input/globals</code></td>
<td class="org-left">Data</td>
<td class="org-left">Problem 2 ELF object file for input to patchsym</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Several other ELF and non-ELF files provided</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org804729b" class="outline-2">
<h2 id="org804729b"><span class="section-number-2">3</span> <b>Problem 1</b>: Changing ELF Symbol Values</h2>
<div class="outline-text-2" id="text-3">
<p>
The <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">Executable and Linkable (ELF) File Format</a> is the Unix standard for
binary files with runnable code in them.  By default, any executable
or <code>.o</code> file produced by Unix compilers such as GCC produce ELF
files as evidenced by the <code>file</code> command.
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; gcc -c code.c

&gt;&gt; file code.o
code.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped

&gt;&gt; gcc program.c

&gt;&gt; file a.out
a.out: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0
</pre>
</div>

<p>
This problem explores the file format of ELF in order to manipulate
<b>string symbols</b> present in the file.  ELF Symbols are associated with
either Global Variables or Functions in a program.  These are stored
in the <code>.symtab</code> ELF section short for "Symbol Table". The standard
utility <code>readelf</code> shows human readable versions of ELF files and the
<code>-s</code> option specifically prints out the symbol table section. Below is
a session which shows the source code for provided program <code>globals</code>
then uses <code>readelf</code> to show the symbol table associated with its
compiled version.
</p>

<div class="org-src-container">
<pre class="src src-text">a5-code&gt;&gt; cd test-input/

test-input&gt;&gt;  file globals*
globals:   ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=d01cc7cd0b9cb5cfac4d27b179d4e467d5e83014, for GNU/Linux 3.2.0, not stripped
globals.c: C source, ASCII text

test-input&gt;&gt;  cat globals.c
// globals.c: simple program which has several global variables in
// it. Used for testing programs which manipulate ELF symbol tables.

#include &lt;stdio.h&gt;

char string1[8]  = "Hello";
char string2[64] = "Goodbye cruel world";
char string3[16] = "All your bass";
int int1 = 0xAABBCCDD;
int int2 = 0xFFEEDDCC;
double a_doub = 1.234567;

int main(int argc, char *argv[]){
  printf("string1: %s\n",string1);
  printf("string2: %s\n",string2);
  printf("string3: %s\n",string3);
  printf("int1: %x\n",int1);
  printf("int2: %x\n",int2);
  printf("a_doub: %f\n",a_doub);
  return 0;
}

test-input&gt;&gt; readelf -s globals
...
Symbol table '.symtab' contains 70 entries:
   Num:    Value          Size Type    Bind   Vis      Ndx Name
   ...
    46: 00000000000040b4     4 OBJECT  GLOBAL DEFAULT   23 int2
    ...
    52: 00000000000040a0    16 OBJECT  GLOBAL DEFAULT   23 string3
    53: 0000000000004040     8 OBJECT  GLOBAL DEFAULT   23 string1
    ...
    59: 00000000000040b8     8 OBJECT  GLOBAL DEFAULT   23 a_doub
    ...
    61: 00000000000040b0     4 OBJECT  GLOBAL DEFAULT   23 int1
    65: 0000000000001139   173 FUNC    GLOBAL DEFAULT   13 main
    66: 0000000000004060    64 OBJECT  GLOBAL DEFAULT   23 string2
    ...
</pre>
</div>
<p>
A number of entries in the symbol table are omitted for clarity: only
those associated with data in the program are shown.
</p>

<p>
Note the following about the symbol table.
</p>
<ul class="org-ul">
<li>Global Variables are identified with Type <code>OBJECT</code>
<ul class="org-ul">
<li><code>Size</code> corresponds to how many bytes the global variable occupies.</li>
<li>String arrays have <code>Size</code> equal to their length, <code>int</code> globals
have <code>Size=4</code> and <code>double</code> globals have <code>Size=8</code></li>
<li><code>Ndx</code> is the ELF file section in which the global variable's value
is stored. In this case, all global variables are in Section 23
which is likely the <code>.data</code> section where initialized global data
is stored.</li>
<li><code>Value</code> is the (approximate) virtual address of the global variable when a
program is loaded into the memory; it relates to the (approximate)
virtual address of where the ELF <code>.data</code> section gets loaded when
a program starts running</li>
</ul></li>
<li>Functions are identified with Type <code>FUNC</code> and have the following
attributes:
<ul class="org-ul">
<li><code>Size</code> corresponds to how many bytes the function's binary Opcodes occupy</li>
<li><code>Ndx</code> is the ELF file section in which the function exists; in
this case it is Section 13 which is likely the <code>.text</code> section</li>
<li><code>Value</code> is the starting address of the function</li>
</ul></li>
</ul>


<p>
The goal of the problem is to construct a program called <code>patchsym</code>
which allows one to change the data associated with an ELF file string
symbol to a new value. This allows an Executable or Compiled Object
File to be altered and see that alteration in subsequent runs of a
program <b>without needing to recompile</b>. And example is below in which
</p>

<div class="org-src-container">
<pre class="src src-sh">a5-code&gt;&gt; make patchsym                             # build patchsym
gcc -Wall -g -Og -o patchsym patchsym.c

a5-code&gt;&gt; cp test-input/globals ./globals2          # make a copy of program to change

a5-code&gt;&gt; ./globals2                                # run the program to show its outpu
string1: Hello                                      # string1 is "Hello"
string2: Goodbye cruel world
string3: All your bass
int1: aabbccdd
int2: ffeeddcc
a_doub: 1.234567

a5-code&gt;&gt; patchsym globals2 string1 string 'Ciao'   # change string1 to 'Ciao' in executable
SET mode                                            # SET mode to change symbol
.data section                                       # info on the .data section where 'Hello' is stored
- 23 section index                                  # index of .data section in section header table
- 12320 bytes offset from start of file
- 0x4020 preferred virtual address for .data
.symtab section                                     # info on the Symbol Table where symbols are located
- 26 section index
- 12504 bytes offset from start of file
- 1680 bytes total size
- 24 bytes per entry
- 70 entries
Found Symbol 'string1'                              # info on symbol string1
- 53 symbol index
- 0x4040 value
- 8 size
- 23 section index                                  # index of the .data section where value is stored
- 32 offset in .data of value for symbol
string value: 'Hello'                               # old value for symbol
New val is: 'Ciao'                                  # new value for string

a5-code&gt;&gt; ./globals2                                # run executable, no re-compile
string1: Ciao                                       # string1 changed to 'Ciao'
string2: Goodbye cruel world
string3: All your bass
int1: aabbccdd
int2: ffeeddcc
a_doub: 1.234567
</pre>
</div>

<p>
Importantly, the executable initially printed <code>Hello</code> but after
changes mad by <code>patchsym</code> it prints <code>Ciao</code>. This is accomplished by
locating the symbol <code>string1</code> in the executable and modifying
associated ELF file data to alter its value.
</p>
</div>

<div id="outline-container-orgfd24867" class="outline-3">
<h3 id="orgfd24867"><span class="section-number-3">3.1</span> ELF File References</h3>
<div class="outline-text-3" id="text-3-1">
<p>
It is recommended to do some reading on the structure of the ELF
format as it will assist in coming to grips with this problem. As you
encounter parts of the below walk-through of how to find and print the
symbol table, refer to the following resources.
</p>
<ul class="org-ul">
<li>Diagrams shown below provide some information about the basics of
what is provided in each portion of the file and how some of the
records relate to each other.</li>
<li><a href="http://man7.org/linux/man-pages/man5/elf.5.html">Manual Pages</a>: The manual page on ELF (found online or by typing <code>man
  elf</code> in any terminal) gives <i>excellent</i> coverage of the structs and
values in the file format. Essentially the entire format is covered
here though there may be a few ambiguities.</li>
<li><a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">Wikipedia</a>: A good overview of the file format and has some
extensive tables on the structs/values that comprise it.</li>
<li><a href="https://docs.oracle.com/cd/E23824_01/html/819-0690/chapter6-43405.html#scrolltoc">Oracle Docs</a>: A somewhat more detailed and hyper-linked version of
the manual pages.</li>
</ul>

<p>
Note that we will use the <b>64-bit ELF format only</b> which means most of
the C types for variables should mention <code>ELF64_xxx</code> in them though
use of 32-bit integers may still apply via <code>uint32_t</code>.
</p>
</div>
</div>

<div id="outline-container-org0b316d1" class="outline-3">
<h3 id="org0b316d1"><span class="section-number-3">3.2</span> Overall Approach</h3>
<div class="outline-text-3" id="text-3-2">
<p>
ELF files are divided into sections. Our main interest is to identify
the <code>.symtab</code> (Symbol Table) and <code>.data</code> (Initialized Data)
sections. This is done in several steps.
</p>
<ol class="org-ol">
<li>Parse the File Header to identify the positions of the Section
Header Array and Section Header String Table</li>
<li>Search the Section Header Array and associated string table to find
the sections named <code>.symtab</code> which is the symbol table, <code>.strtab</code>
which contains the string names of the symbol table, and <code>.data</code>
which contains the values for global variables. Note the
position in the file of these three sections.</li>
<li>Iterate through the Symbol Table section which is an array of
structs. Use the fields present there along with the associated
string names in <code>.strtab</code> to check each symbol for the symbol of
interest.</li>
<li>Once the symbol is found in <code>.symtab</code>, its value from <code>.symtab</code> is
used to compute the offset within the <code>.data</code> section. This is
where the symbols string data is stored and it can be changed.</li>
</ol>

<p>
Since this is a binary file with a considerable amount of jumping and
casting to structs, it makes sense to use <code>mmap()</code> to map the entire
file into virtual memory. <b>It is a requirement to use mmap() for this
problem</b>. Refer to lecture notes, textbook, and lab materials for
details on how to set up a memory map and clean it up once
finished. In particular <b>Lab 13 uses mmap() to parse binary files</b> in
a way that is directly relevant to the present program.  
</p>

<p>
One change over the Lab is that <code>patchsym</code> changes the data in a file
so <code>mmap()</code> must be invoked with the correct options for <b>both Reading
and Writing</b>. Find the correct options for these permissions in the
manual page for <code>mmap()</code>.
</p>
</div>
</div>

<div id="outline-container-org925bc67" class="outline-3">
<h3 id="org925bc67"><span class="section-number-3">3.3</span> ELF Header and Section Header Array</h3>
<div class="outline-text-3" id="text-3-3">
<p>
The initial bytes in an ELF file always have a fixed structure which
is the <code>ELF64_Ehdr</code> type.  Of primary interest are the following
</p>
<ol class="org-ol">
<li>Identification bytes and types in the field <code>e_ident[]</code>. These
initial bytes identify the file as ELF format or not.  If they
match the expected values, proceed. If incorrect, consult the later
section on <a href="#org91f28e1">Error Conditions</a> on what error message to print.</li>
<li>The Section Header Array byte position in the field <code>e_shoff</code>.  The
Section Header Array is like a table of contents for a book giving
positions of most other sections in the file. It usually occurs near
the end of the file.</li>
<li>The index of the Section Header String Table in field
<code>e_shstrndx</code>. This integer gives an index into the Section Header
Array where a string table can be found containing the names of
headers.</li>
</ol>

<p>
The following diagram shows the layout of these first few important
parts of an ELF file. 
</p>

<div class="org-center">

<div id="org082941a" class="figure">
<p><img src="elf-data1.png" alt="elf-data1.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 1: </span>ELF File Header with Section Header Array and Section Header String Table.</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbc7ce49" class="outline-3">
<h3 id="orgbc7ce49"><span class="section-number-3">3.4</span> String Tables, Names, Section Headers</h3>
<div class="outline-text-3" id="text-3-4">
<p>
To keep the sizes of structures fixed while still allowing variable
length names for things, all the names that are stored in ELF files
are in <b>string tables</b>.  You can see one of these laid in the middle
purple section of the diagram above starting at byte offset 1000. It
is simply a sequence of multiple null-terminated strings laid out
adjacent to one another in the file.
</p>

<p>
When a name is required, a field will give an offset into a specific
string table.  For example, each entry of the Section Header Array has
an <code>sh_name</code> field which is an offset into the <code>.shstrtab</code> (the <code>sh</code>
is for "section header").. The offset indicates how far from the start
of the string table to find the require name.
</p>
<ul class="org-ul">
<li>The <code>.shstrtab</code> section begins at byte 1000 so all name positions
are <code>1000 + sh_name</code></li>
<li>The 0th <code>.text</code> section has <code>sh_name = 0</code>; the string <code>.text\0</code>
appears at position 1000.</li>
<li>The 1th <code>.symtab</code> section has <code>sh_name = 6</code>; the string <code>.symtab\0</code>
appears at byte position 1006.</li>
<li>The 4th <code>.data</code> section has <code>sh_name = 32</code>; the string <code>.bss\0</code>
appears at byte position 1032.</li>
</ul>

<p>
The Section Header Array is an array of <code>Elf64_Shdr</code> structs.  By
iterating over this array, fishing out the names from <code>.shstrtab</code>, and
examining names using <code>strcmp()</code>, the positions for the two desired
sections, <code>.symtab</code> and <code>.strtab</code> can be obtained via the associated
<code>sh_offset</code> field.
</p>

<p>
Note that one will need to also determine length of the Section Header
Array from the ELF File Header field <code>e_shnum</code>. 
</p>

<p>
Also, on finding the Symbol Table section, <b>note its size in bytes</b>
from the <code>sh_size</code> field. This will allow you to determine the number
of symbol table entries.
</p>
</div>
</div>

<div id="outline-container-org40ae619" class="outline-3">
<h3 id="org40ae619"><span class="section-number-3">3.5</span> <a id="org9398f3a"></a> The <code>.data</code> Section and its Address</h3>
<div class="outline-text-3" id="text-3-5">
<p>
In addition to identifying the <code>.symtab</code> and <code>.strtab</code> sections in the
section header, identify and track the location of the <code>.data</code> section
as this is where the values associated with initialized global variables in C
programs are stored.  The <code>.data</code> section is copied directly into
memory when a program is loaded. The section header struct field
<code>sh_addr</code> is the requested location for some sections to be
loaded. Record it in your program as this address is used to calculate
the location of variable values from the symbol table.
</p>

<p>
Once the location of the <code>.data</code> section is located, print out some
data about it in the following format.
</p>
<div class="org-src-container">
<pre class="src src-text">.data section
- 23 section index
- 12320 bytes offset from start of file
- 0x4020 preferred virtual address for .data
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e4442a" class="outline-3">
<h3 id="org2e4442a"><span class="section-number-3">3.6</span> Symbol Table and <code>.strtab</code></h3>
<div class="outline-text-3" id="text-3-6">
<p>
Similar to the Section Header Array, the Symbol Table is comprised of
an array of <code>Elf64_Sym</code> structs.  Each of these structs has a
<code>st_name</code> field giving an offset into the <code>.symtab</code> section where a
symbol's name resides. The following diagram shows this relationship.
</p>

<div class="org-center">

<div id="org96a8c97" class="figure">
<p><img src="elf-data2.png" alt="elf-data2.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 2: </span>ELF Symbol Table, associated String Table, and locations of symbol values in <code>.data</code> section. The entry location of symbol <code>string1</code> is bolded along with the location of its name "string1" and location of its value "Hello"</p>
</div>
</div>

<p>
Print out data on the symbol table in the format given below. Note
that this data does not correspond to the diagram which is much simpler.
</p>
<div class="org-src-container">
<pre class="src src-text">.symtab section
- 26 section index
- 12504 bytes offset from start of file
- 1680 bytes total size
- 24 bytes per entry
- 70 entries
</pre>
</div>

<p>
<code>patchsym</code> will change one of the values of the symbols in symbol
table. To that end, one must iterate through the array of Symbol Table
<code>Elf64_Sym</code> structs searching for the name of the symbol to be
changed. In the above diagram, <code>string1</code> is of interest and is found
midway through the table at index 11.  On finding the requested
symbol, print out data about it in the following format.
</p>
<div class="org-src-container">
<pre class="src src-text">Found Symbol 'string1'
- 53 symbol index
- 0x4040 value
- 8 size
- 23 section index
- 32 offset in .data of value for symbol
string value: 'Hello'
</pre>
</div>
<ul class="org-ul">
<li>The <code>st_size</code> in this case corresponds to the length of the <code>char</code>
array allocated for the string in global memory</li>
<li>The "value" in the <code>st_value</code> field is actually the address at which
the symbol's data is stored. This is with respect to the <code>.data</code>
section</li>
<li>The section index <code>st_shndx</code> field gives the ELF section in which this
symbol is stored. In this case, it is section 23 which is the index
of the <code>.data</code> section where initialized global variables are
stored.</li>
<li>The location of <code>string1</code>'s value in the <code>.data</code> section is computed
by calculating its address as an offset from the address of the
<code>.data</code> section:
<ul class="org-ul">
<li><code>.data</code> will load at <code>0x4020</code></li>
<li><code>string1</code> is at address <code>0x4040</code></li>
<li>The value of <code>string1</code> is therefore offset <code>0x4040 - 0x4020 = 0x0020 =
    32</code> from the start of the <code>.data</code> section</li>
</ul></li>
<li>Add 32 to the offset of <code>.data</code> from the beginning of the file
(found in earlier when <a href="#org9398f3a">locating the <code>.data</code> section</a>) to get the
address of the string.</li>
<li>Printing this address as a string should give string value <code>Hello</code></li>
</ul>

<p>
If the symbol that is requested is not found in the symbol table,
refer to the <a href="#org91f28e1">Error Conditions</a> section for the appropriate error
message to print.
</p>
</div>
</div>

<div id="outline-container-org5483b4f" class="outline-3">
<h3 id="org5483b4f"><span class="section-number-3">3.7</span> Altering a String Value</h3>
<div class="outline-text-3" id="text-3-7">
<p>
<code>patchsym</code> works in either <code>GET_MODE</code> or <code>SET_MODE</code>
</p>
<ul class="org-ul">
<li><p>
<code>GET_MODE</code> stops after printing out above information on the
<code>.data</code>, <code>.symtab</code>, and a specific symbol with its current value. It
is invoked by running with 3 command line arguments:
</p>
<pre class="example">
&gt; patchsym globals string1 string         # GET_MODE, show value of string1
</pre></li>
<li><p>
<code>SET_MODE</code> will print all the above information and then change the
symbol to a new value. It is run by passing a 4th command line
argument which is the new string.
</p>
<pre class="example">
&gt; patchsym globals string1 string 'Ciao'  # SET_MODE, change string1 to Ciao
</pre></li>
</ul>

<p>
When in <code>SET_MODE</code>, the last step is to use the address of a symbol
in the <code>.data</code> section to change the value there.  When using
<code>mmap()</code>, the memory-mapped ELF file will automatically save any
changes made to the bytes that are mapped. Therefore writing new data
to a <code>char *</code> pointing into the memory map will alter the file. One
can copy in the new string using several techniques.
</p>
<ul class="org-ul">
<li>A manual <code>for()</code> loop iterating over the characters of the new
string and copying them into the location of the symbol</li>
<li>Via a library function like <code>strcpy()</code></li>
</ul>

<p>
Importantly, before changing the value of a string symbol, check that
the new string's length is equal to or shorter than the old string.
</p>
<ul class="org-ul">
<li><code>string1</code> has a <code>st_size</code> of 8 meaning it can hold up to 7
characters plus a <code>\0</code> null terminator character</li>
<li>Copying <code>Ciao</code> is fine as this is 4+1=5 total characters</li>
<li>Copying <code>Farewell</code> 8+1=9 chars which is too long: it will overwrite
bytes associated with another variable in <code>.data</code> which is bad</li>
</ul>

<p>
On success, print the new value of the string symbol as in
</p>
<div class="org-src-container">
<pre class="src src-text">string value: 'Hello'                               # old value for symbol
New val is: 'Ciao'                                  # new value for string
</pre>
</div>

<p>
If a request is made to change a string to new value which is too
long, print an error message as indicated in the <a href="#org91f28e1">Error Conditions</a>
section.
</p>
</div>
</div>

<div id="outline-container-org4a035e0" class="outline-3">
<h3 id="org4a035e0"><span class="section-number-3">3.8</span> Example Invocations</h3>
<div class="outline-text-3" id="text-3-8">
<p>
The following are some example invocations of <code>patchsym</code> from the
provided tests.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; test-input/globals                                       # show output of running globals program 
string1: Hello
string2: Goodbye cruel world
string3: All your bass
int1: aabbccdd
int2: ffeeddcc
a_doub: 1.234567

&gt; ./patchsym test-input/globals string1 string             # get the value of the string1 symbol
GET mode
.data section
- 23 section index
- 12320 bytes offset from start of file
- 0x4020 preferred virtual address for .data
.symtab section
- 26 section index
- 12504 bytes offset from start of file
- 1680 bytes total size
- 24 bytes per entry
- 70 entries
Found Symbol 'string1'
- 53 symbol index
- 0x4040 value
- 8 size
- 23 section index
- 32 offset in .data of value for symbol
string value: 'Hello'

&gt; cp test-input/globals test-input/globals2                # make a copy to preserver the original for testing

&gt; ./patchsym test-input/globals2 string1 string 'ADIOS!'   # change string 1 to adios
SET mode
.data section
- 23 section index
- 12320 bytes offset from start of file
- 0x4020 preferred virtual address for .data
.symtab section
- 26 section index
- 12504 bytes offset from start of file
- 1680 bytes total size
- 24 bytes per entry
- 70 entries
Found Symbol 'string1'
- 53 symbol index
- 0x4040 value
- 8 size
- 23 section index
- 32 offset in .data of value for symbol
string value: 'Hello'
New val is: 'ADIOS!'

&gt; test-input/globals2                                      # run the executable
string1: ADIOS!                                            # string1 has changed
string2: Goodbye cruel world
string3: All your bass
int1: aabbccdd
int2: ffeeddcc
a_doub: 1.234567
</pre>
</div>
</div>
</div>


<div id="outline-container-org902781c" class="outline-3">
<h3 id="org902781c"><span class="section-number-3">3.9</span> <a id="org91f28e1"></a> Behavior in Error Cases</h3>
<div class="outline-text-3" id="text-3-9">
<p>
The following errors can occur during execution of <code>patchsym</code> and
should result in the given error messages being printed.
</p>
</div>

<div id="outline-container-org4967126" class="outline-4">
<h4 id="org4967126">Wrong Magic Bytes</h4>
<div class="outline-text-4" id="text-org4967126">
<p>
<code>patchsym</code> should check these "magic bytes" (first elements of
<code>e_ident[]</code> in header). If they match the expected values, proceed but
if they are incorrect, print the following example message
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; ./patchsym test-input/globals.c string1 string
GET mode
ERROR: Magic bytes wrong, this is not an ELF file
</pre>
</div>
</div>
</div>


<div id="outline-container-orgfad53f5" class="outline-4">
<h4 id="orgfad53f5">Missing Symbol Tables</h4>
<div class="outline-text-4" id="text-orgfad53f5">
<p>
During the search for the symbol table, it is possible that it is not
found. Such objects are usually executables that have been "stripped"
of a symbol table. After iterating through all sections in the Section
Header array and finding that no entry has the <code>.symtab</code> name print
the message in the example below.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; ./patchsym test-input/naked_globals string1 string
GET mode
ERROR: Couldn't find symbol table
</pre>
</div>
</div>
</div>


<div id="outline-container-orgf3ecf79" class="outline-4">
<h4 id="orgf3ecf79">Symbol Not Found</h4>
<div class="outline-text-4" id="text-orgf3ecf79">
<p>
Any name that is not found in the symbol table should result in the
following final error message.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; ./patchsym test-input/globals nada string
GET mode
.data section
- 23 section index
- 12320 bytes offset from start of file
- 0x4020 preferred virtual address for .data
.symtab section
- 26 section index
- 12504 bytes offset from start of file
- 1680 bytes total size
- 24 bytes per entry
- 70 entries
ERROR: Symbol 'nada' not found
</pre>
</div>
</div>
</div>

<div id="outline-container-org7aec163" class="outline-4">
<h4 id="org7aec163">Symbol Not in <code>.data</code> Section</h4>
<div class="outline-text-4" id="text-org7aec163">
<p>
Some symbols are not in the <code>.data</code> section; for example <code>FUNCTION</code>
symbols like <code>main</code> are in the <code>.text</code> section so cannot be changed as
global data. In these cases, print out the section they are in as per
the error message format below.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; ./patchsym test-input/globals main string
GET mode
.data section
- 23 section index
- 12320 bytes offset from start of file
- 0x4020 preferred virtual address for .data
.symtab section
- 26 section index
- 12504 bytes offset from start of file
- 1680 bytes total size
- 24 bytes per entry
- 70 entries
Found Symbol 'main'
- 65 symbol index
- 0x1139 value
- 173 size
- 13 section index
ERROR: 'main' in section 13, not in .data section 23

</pre>
</div>
</div>
</div>

<div id="outline-container-org419892b" class="outline-4">
<h4 id="org419892b">New String Too Long</h4>
<div class="outline-text-4" id="text-org419892b">
<p>
If the space allocated for a string is too short for a new value, it
is dangerous to alter the <code>.data</code> section as nearby values may be
clobbered. Instead, do not change anything and print the following
error message.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; ./patchsym test-input/globals2 string1 string 'Adios, muchachos. Lo siento.'
SET mode
.data section
- 23 section index
- 12320 bytes offset from start of file
- 0x4020 preferred virtual address for .data
.symtab section
- 26 section index
- 12504 bytes offset from start of file
- 1680 bytes total size
- 24 bytes per entry
- 70 entries
Found Symbol 'string1'
- 53 symbol index
- 0x4040 value
- 8 size
- 23 section index
- 32 offset in .data of value for symbol
string value: 'Hello'
ERROR: Cannot change symbol 'string1': existing size too small
Cur Size: 8 'Hello'
New Size: 29 'Adios, muchachos. Lo siento.'
</pre>
</div>
</div>
</div>

<div id="outline-container-org0f2f823" class="outline-4">
<h4 id="org0f2f823">Non-string Symbol Types</h4>
<div class="outline-text-4" id="text-org0f2f823">
<p>
When <code>patchsym</code> is run, the type of the Symbol to be changed is
provided. The required implementation of <code>patchsym</code> honors only string
variables as in
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; ./patchsym test-input/list_main2 PROMPT string
</pre>
</div>

<p>
Check this type before printing or changing a symbols value and if it
cannot be handled, print the following error message.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; ./patchsym test-input/globals string2 unknown
GET mode
.data section
- 23 section index
- 12320 bytes offset from start of file
- 0x4020 preferred virtual address for .data
.symtab section
- 26 section index
- 12504 bytes offset from start of file
- 1680 bytes total size
- 24 bytes per entry
- 70 entries
Found Symbol 'string2'
- 66 symbol index
- 0x4060 value
- 64 size
- 23 section index
- 64 offset in .data of value for symbol
ERROR: Unsupported data kind 'unknown'
</pre>
</div>

<p>
Note that this leaves open the possibility to support other data kinds
such as <code>int</code> and <code>double</code>.  It is not required but is good practice
to implement support for these so that one could run invocations like.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; ./patchsym test-input/globals a_doub double 4.56
...
&gt; ./patchsym test-input/globals int1 int 123
...
</pre>
</div>
<p>
Such additions would make good exam problems to test one's
understanding of the program.
</p>
</div>
</div>
</div>


<div id="outline-container-orgddccd5d" class="outline-3">
<h3 id="orgddccd5d"><span class="section-number-3">3.10</span> <code>patchsym</code> Template</h3>
<div class="outline-text-3" id="text-3-10">
<p>
A basic template for <code>patchsym.c</code> is provided in the code pack which
outlines the structure of the code along with some printing formats to
make the output match examples. Follow this outline closely to make
sure that your code complies with tests when the become available.
</p>
</div>
</div>

<div id="outline-container-orge713af1" class="outline-3">
<h3 id="orge713af1"><span class="section-number-3">3.11</span> Automated Tests for Problem 1</h3>
<div class="outline-text-3" id="text-3-11">
<p>
As in previous projects, automated tests are provided and can be run
via
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; make test-prob1              # run all tests
...
&gt;&gt; make test-prob1 testnum=4    # run a single test
</pre>
</div>

<p>
Correct execution looks like the following:
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; make test-prob1
./testy test_patchsym.org 
============================================================
== test_patchsym.org : patchsym tests
== Running 10 / 10 tests
1)  get globals string1        : ok
2)  get globals string2        : ok
3)  get globals notthere       : ok
4)  set globals string1        : ok
5)  set globals string3        : ok
6)  set globals string1-3      : ok
7)  set quote_main2 correct    : ok
8)  set greet_funcs.o greeting : ok
9)  Basic Error Conditions     : ok
10) String Too Long            : ok
============================================================
RESULTS: 10 / 10 tests passed
</pre>
</div>
</div>
</div>

<div id="outline-container-orge554c5c" class="outline-3 grading">
<h3 id="orge554c5c"><span class="section-number-3">3.12</span> Grading Criteria for <code>patchsym</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading">grading</span></span></h3>
<div class="outline-text-3" id="text-3-12">
<p>
Both binary and shell tests can be run with <code>make test-p2</code>
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Weight</th>
<th scope="col" class="org-left">Criteria</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><b>Automated Tests</b></td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">Passing automated tests in <code>test_patchsym.org</code> via <code>make test-prob1</code></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><b>Manual Inspection</b></td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Correctly sets up a memory map using <code>open(), fstat(), mmap()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Creates a memory map of the requested file in read + write mode</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Correct unmap and close of file description at end of execution</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">10</td>
<td class="org-left">Sets a pointer to the ELF File Header properly</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Checks identifying bytes for sequence <code>{0x7f,'E','L','F'}</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Properly extracts the Section Header Array offset, length, string table index</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">10</td>
<td class="org-left">Sets up pointers to Section Header Array and associate Section Header String Table</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Loops over Section Header Array for sections named <code>.symtab / .strtab / .data</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Properly uses SH String Table to look at names of each section while searching</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Extracts offsets and sizes of <code>.symtab / .strtab / .data</code> sections, location of the address for <code>.data</code></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">10</td>
<td class="org-left">Iterates over the symbol table to locate the named symbol</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear cases for finding the requested symbol or failure to find symbol in the table</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Calculation done to find the position of a symbol value in the <code>.data</code> section</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">In <code>SET_MODE</code>, changes symbol to the new string if it is appropriately sized</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">5</td>
<td class="org-left">Clean, readable code</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Good indentation</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Good selection of variable names</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">50</td>
<td class="org-left">Problem Total</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


<div id="outline-container-orge244952" class="outline-2">
<h2 id="orge244952"><span class="section-number-2">4</span> Project Submission</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org767f99f" class="outline-3">
<h3 id="org767f99f"><span class="section-number-3">4.1</span> <a id="org647d8d1"></a> Submit to Gradescope</h3>
<div class="outline-text-3" id="text-4-1">
<ol class="org-ol">
<li><p>
In a terminal, change to your project code directory and type
<b>make zip</b> which will create a zip file of your code. A session
should look like this:
</p>
<div class="org-src-container">
<pre class="src src-sh">   &gt; cd Desktop/2021/p5-code      # location of project code

   &gt; ls 
   Makefile    el_malloc.c    test-input/
   ...

   &gt; make zip                     # create a zip file using Makefile target
   rm -f p5-code.zip
   cd .. &amp;&amp; zip "p5-code/p5-code.zip" -r "p5-code"
     adding: p5-code/ (stored 0%)
     adding: p5-code/el_malloc.c (deflated 72%)
     adding: p5-code/Makefile (deflated 59%)
     ...
   Zip created in p5-code.zip

   &gt; ls p5-code.zip
   p5-code.zip
</pre>
</div></li>
<li>Log into <a href="https://www.gradescope.com/">Gradescope</a> and locate and click Project 5' which will
open up submission</li>
<li>Click on the 'Drag and Drop' text which will open a file selection
dialog; locate and choose your <code>p5-code.zip</code> file</li>
<li>This will show the contents of the Zip file and should include your
C source files along with testing files and directories.</li>
<li>Click 'Upload' which will show progress uploading files.  It may
take a few seconds before this dialog closes to indicate that the
upload is successful. Note: there is a limit of 256 files per
upload; normal submissions are not likely to have problems with
this but you may want to make sure that nothing has gone wrong such
as infinite loops creating many files or incredibly large files.</li>
<li>Once files have successfully uploaded, the Autograder will begin
running the command line tests and recording results.  These are
the same tests that are run via <code>make test</code>.</li>
<li>When the tests have completed, results will be displayed
summarizing scores along with output for each batch of tests.</li>
<li>Refer to the <a href="https://www-users.cs.umn.edu/~kauffman/2021/p1.html">Submission instructions for P1</a> for details and
pictures.</li>
</ol>
</div>
</div>

<div id="outline-container-org6141ea6" class="outline-3">
<h3 id="org6141ea6"><span class="section-number-3">4.2</span> Late Policies</h3>
<div class="outline-text-3" id="text-4-2">
<p>
You may wish to review the policy on late project submission which
will cost you late tokens to submit late or credit if you run out of
tokens. <b>No projects will be accepted more than 48 hours after the
deadline.</b>
</p>

<p>
<a href="https://www-users.cs.umn.edu/~kauffman/2021/syllabus.html">https://www-users.cs.umn.edu/~kauffman/2021/syllabus.html</a>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/> <i> Author: Chris Kauffman (<a href="mailto:kauffman@umn.edu">kauffman@umn.edu</a>) <br/> Date: 2021-12-14 Tue 11:36 <br/> </i>
</div>
</body>
</html>
