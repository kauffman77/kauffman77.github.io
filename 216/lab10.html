<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-04-07 Sun 23:03 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CMSC216 Lab10: Makefiles and I/O Redirection</title>
<meta name="author" content="Chris Kauffman" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1" />
<style type="text/css">
@media screen {
:root {
--heading-bg-color:#e21833;
--heading-fg-color:#ffd200;
}
html {
font-family: serif;
text-align: justify;
}
pre.src, pre.example {
overflow-x: scroll;
}
/* Merge subtitle area with title area */
.subtitle {
text-align: center;
margin-top: -2em;
padding-top: 1em;
padding-bottom: 0.1em;
}
.title, .subtitle {
color: var(--heading-fg-color);
background-color: var(--heading-bg-color);
}
/* Section borders, left section header style */
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
blockquote {
font-style: italic;
}
td, th {
padding-top: 2px;
padding-bottom: 2px;
}
body {
background-color: #EEE;
}
pre {
}
#content, #preamble, #postamble {
margin-left:300px;
max-width: 100%;
}
.tag {
background-color: inherit; font-family: inherit;
padding: inherit; font-size: 80%; font-weight: inherit;
text-transform: uppercase;
}

.figure p { text-align: inherit; }
figure-number { font-style: italic; }
#table-of-contents {
text-align: left;
position: fixed;
left: 0;
margin: 0 auto;
padding: 0;
width: 300px;
top: 0;
height: 100%;
border: 0;
display: block;
}
#text-table-of-contents {
overflow-y: scroll;
height: 100%;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
#table-of-contents > h2 {
padding: 0.1em;
margin: 0;
}
/* adjustments for small screen, toc at top only */
@media (max-width: 800px) { /* landscape for iphone */
html {
-webkit-text-size-adjust: none;  /* prevent scaling of text on mobile */
}
body {
background-color: #EEE;
width:100%;
margin:0 auto;
}
#content, #preamble, #postamble {
margin-left:0;
}
#table-of-contents {
position: static;
left: inherit;
width:inherit;
height: auto;
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
border: 0.75em solid #006633;
}
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
#text-table-of-contents {
overflow-y: visible;
height: inherit;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
}
.linenr { font-size: xx-small; }
}

@media print {
html {
font-family: serif;
font-size: 10pt;
text-align: justify;
.linenr { font-size: xx-small; }
}
}
</style>
</head>
<body>
<div id="preamble" class="status">
<i>Last Updated: 2024-04-07 Sun 23:03</i>
</div>
<div id="content" class="content">
<h1 class="title">CMSC216 Lab10: Makefiles and I/O Redirection</h1>
<ul class="org-ul">
<li><b>Due: 11:59pm Mon 15-Apr-2024</b> on <a href="https://www.gradescope.com/">Gradescope</a></li>
<li><i>Approximately 1.00% of total grade</i></li>
</ul>

<div id="outline-container-org1a76bbd" class="outline-4">
<h4 id="org1a76bbd">CODE DISTRIBUTION: <a href="lab10-code.zip">lab10-code.zip</a></h4>
<div class="outline-text-4" id="text-org1a76bbd">
<ul class="org-ul">
<li>Download the code distribution</li>
<li>See further setup instructions below</li>
</ul>
</div>
</div>

<div id="outline-container-orgc86faca" class="outline-4">
<h4 id="orgc86faca">CHANGELOG: Empty</h4>
<div class="outline-text-4" id="text-orgc86faca">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org75a5df1">1. Rationale</a></li>
<li><a href="#orgc38b6f4">2. Codepack</a></li>
<li><a href="#orgfb241d8">3. Problem 1: Makefiles</a>
<ul>
<li><a href="#orga84380c">3.1. Structure of Makefiles</a></li>
<li><a href="#org893b28c">3.2. Variables and Shortcuts in Makefiles</a></li>
<li><a href="#orge130a15">3.3. Dependency Detection</a></li>
</ul>
</li>
<li><a href="#org451a493">4. Problem 2: I/O Redirection</a></li>
<li><a href="#orgdd5f15c">5. QUESTIONS.txt File Contents</a></li>
<li><a href="#org9d2527f">6. Submission</a></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org75a5df1" class="outline-2">
<h2 id="org75a5df1"><span class="section-number-2">1</span> Rationale</h2>
<div class="outline-text-2" id="text-1">
<p>
This lab covers two independent but short concepts in separate
problems.
</p>

<p>
Build systems are essential to program development to automate
repetitive tasks such as compiling code, running tests, and tracking
changes which would necessitate running such tasks.  The <code>make</code> build
system is among the oldest build system and is ubiquitous across Unix
systems making it a useful to know a few basics about it.
</p>

<p>
Unix maintains a table of open File Descriptors for all processes.
Using the <code>dup()</code> and <code>dup2()</code> system calls, programs can manipulate
this table to achieve interesting effects, notably redirection of
output from standard locations to other places. This exercise
demonstrates some common techniques for doing so and will acquaint
students with the basics of how the file descriptor table works and
how it is inherited by child processes.
</p>
</div>

<div id="outline-container-org9917c44" class="outline-4">
<h4 id="org9917c44">Grading Policy</h4>
<div class="outline-text-4" id="text-org9917c44">
<p>
Credit for this exercise is earned by completing the code/asnwers here
and submitting a Zip of the work to Gradescope. Students are
responsible to check that the results produced locally via <code>make test</code>
are reflected on Gradescope after submitting their completed
Zip. Successful completion earns 1 Engagement Point.
</p>

<p>
Lab Exercises are open resource/open collaboration and <b>students are
encouraged to cooperate on labs.</b> Students may submit work as groups
of up to 5 to Gradescope: one person submits then adds the names of
their group members to the submission.
</p>

<p>
See the <a href="../syllabus.html">full policies in the course syllabus</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgc38b6f4" class="outline-2">
<h2 id="orgc38b6f4"><span class="section-number-2">2</span> Codepack</h2>
<div class="outline-text-2" id="text-2">
<p>
The codepack for this exercise is linked at the top of this
document. Always download it and unzip/unpack it.  It should contain
the following files which are briefly described.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">File</th>
<th scope="col" class="org-left">Use</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>QUESTIONS.txt</code></td>
<td class="org-left">EDIT</td>
<td class="org-left">Questions to answer: fill in the multiple choice selections in this file.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>demo-makefile-little</code></td>
<td class="org-left">Study</td>
<td class="org-left">Problem 1: Example Makefiles to study</td>
</tr>

<tr>
<td class="org-left"><code>demo-makefile-big</code></td>
<td class="org-left">Study</td>
<td class="org-left">Problem 1: Example Makefiles to study</td>
</tr>

<tr>
<td class="org-left"><code>prob1-makefile/Makefile</code></td>
<td class="org-left">EDIT</td>
<td class="org-left">Problem 1: Template Makefile to complete in</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>switch_stdout.c</code></td>
<td class="org-left">Study</td>
<td class="org-left">Problem 2: C file to study to answer QUIZ questions</td>
</tr>

<tr>
<td class="org-left"><code>redirect_child.c</code></td>
<td class="org-left">EDIT</td>
<td class="org-left">Problem 2: I/O redirection program to complete</td>
</tr>

<tr>
<td class="org-left"><code>nums.txt</code></td>
<td class="org-left">Data</td>
<td class="org-left">Problem 2: Data used in the tests</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>QUESTIONS.txt.bk</code></td>
<td class="org-left">Backup</td>
<td class="org-left">Backup copy of the original file to help revert if needed</td>
</tr>

<tr>
<td class="org-left"><code>Makefile</code></td>
<td class="org-left">Build</td>
<td class="org-left">Enables <code>make test</code> and <code>make zip</code></td>
</tr>

<tr>
<td class="org-left"><code>testy</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Test running scripts</td>
</tr>

<tr>
<td class="org-left"><code>test_dis10.org</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Tests for this exercise</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgfb241d8" class="outline-2">
<h2 id="orgfb241d8"><span class="section-number-2">3</span> Problem 1: Makefiles</h2>
<div class="outline-text-2" id="text-3">
<p>
Building programs often involves compiling separate source files and
eventually combining them through linking to create an executable.
There are often associated tasks such as running automated tests,
creating distribution files, and generating documentation that may be
supported by the build system as well.  Among the oldest build systems
still in use is <code>make</code> and its associated <code>Makefiles</code>.  This problem
covers the basics of how to create a <code>Makefile</code>.
</p>
</div>

<div id="outline-container-orga84380c" class="outline-3">
<h3 id="orga84380c"><span class="section-number-3">3.1</span> Structure of Makefiles</h3>
<div class="outline-text-3" id="text-3-1">
<p>
The basic structure of a <code>Makefile</code> involves <b>rules</b> which relate
<b>targets, dependencies, and commands</b>. Simple <code>Makefiles</code> comprise a
list of rules.
</p>
<div class="org-src-container">
<pre class="src src-makefile"># comment above Rule 1
target1 : dependency1A depency1B
	command1A
	command1B
	command1C

# comment above Rule 2
target2 : dependency2A
	command2A
	command2B

# comment above Rule 3
target3 : dependency3A dependency3B dependency3B
	command3A
	command3B
</pre>
</div>
<p>
When invoked, <code>make target3</code> will load the contents of the <code>Makefile</code>
and examine the relationship between <code>target3</code> and its
dependencies. If <code>make</code> determines it is necessary, it may run
<code>command3A, command3B</code> in sequence to "update" <code>target3</code>. In other
cases, <code>make</code> may determine that there is no need to run additional
commands as <code>target3</code> is already up to date.  Similarly, running <code>make
target1</code> will possibly run <code>command1A, command1B, command1C</code>.
</p>

<p>
NOTE: Commands associated with a rule <b>MUST BE INDENTED WITH A
TAB</b>. This is a notoriously bad "feature" of make which can
occasionally cause problems. Be aware: leading whitespace for commands
should be TAB characters.
</p>

<p>
The most common kind of target is a file that should be created such
as a <code>.o</code> file or an executable program. The directory
<code>demo-makefile-little</code> has an example <code>Makefile</code> showing this:
</p>
<div class="org-src-container">
<pre class="src src-makefile"><span class="linenr"> 1: </span># Simle Makefile to build program main_prog
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span># first rule in the file is the default: typing `make` is the same as
<span class="linenr"> 4: </span># typing `make main_prog`
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span># rule 1
<span class="linenr"> 7: </span>main_prog : main_func.o func_01.o
<span class="linenr"> 8: </span>	gcc -o main_prog main_func.o func_01.o
<span class="linenr"> 9: </span>
<span class="linenr">10: </span># rule 2
<span class="linenr">11: </span>main_func.o : main_func.c
<span class="linenr">12: </span>	gcc -c main_func.c
<span class="linenr">13: </span>
<span class="linenr">14: </span># rule 3
<span class="linenr">15: </span>func_01.o : func_01.c
<span class="linenr">16: </span>	gcc -c func_01.c
<span class="linenr">17: </span>
<span class="linenr">18: </span># rule 4
<span class="linenr">19: </span>clean : 
<span class="linenr">20: </span>	rm -f *.o
<span class="linenr">21: </span>	rm -f main_prog
</pre>
</div>

<p>
The rules that appear are
</p>
<ol class="org-ol">
<li><code>main_prog</code> depends on the <code>main_func.o</code> and <code>func_01.o</code>; the
program is created by invoking GCC on these files</li>
<li><code>main_func.o</code> depends on <code>main_func.c</code> which is created by running
GCC</li>
<li><code>func_01.o</code> depends on <code>func_01.c</code> and is created by running GCC</li>
<li><code>clean</code> is a "phony" target with no dependencies which will remove
compile artifacts by using the <code>rm</code> command</li>
</ol>

<p>
When one types <code>make</code> or <code>make main_prog</code> in that directory, the
following will appear:
</p>
<div class="org-src-container">
<pre class="src src-shell">&gt;&gt; cd demo-makefile-little/
&gt;&gt; make
gcc -c main_func.c
gcc -c func_01.c
gcc -o main_prog main_func.o func_01.o
</pre>
</div>
<p>
Observe that <code>make</code> detects that the two dependencies for Rule 1 are
incomplete: <code>main_func.o</code> and <code>func_01.o</code> are not present. To create
them, it will generate them as targets according to for the rules that
have them as targets, Rule 2 and Rule 3.  After running the commands
for these two rules, the commands for Rule 1 are executed to generate
the program.
</p>
</div>
</div>


<div id="outline-container-org893b28c" class="outline-3">
<h3 id="org893b28c"><span class="section-number-3">3.2</span> Variables and Shortcuts in Makefiles</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Makefiles support a large number of features such as explicit
variables, automatic variables, pattern-based rules, and many
others. A few of these are described in the sample file
<code>demo-makefile-little/Makefile-shortcuts</code>. It accomplishes the same
task as the <code>Makefile</code> but utilizes some features which are useful to
know about. The comments in this file describe some of these features.
</p>
<div class="org-src-container">
<pre class="src src-makefile"><span class="linenr"> 1: </span># Simle Makefile to build program main_prog
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span># first rule in the file is the default: typing `make` is the same as
<span class="linenr"> 4: </span># typing `make main_prog`
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span># rule 1
<span class="linenr"> 7: </span>main_prog : main_func.o func_01.o
<span class="linenr"> 8: </span>	gcc -o main_prog main_func.o func_01.o
<span class="linenr"> 9: </span>
<span class="linenr">10: </span># rule 2
<span class="linenr">11: </span>main_func.o : main_func.c
<span class="linenr">12: </span>	gcc -c main_func.c
<span class="linenr">13: </span>
<span class="linenr">14: </span># rule 3
<span class="linenr">15: </span>func_01.o : func_01.c
<span class="linenr">16: </span>	gcc -c func_01.c
<span class="linenr">17: </span>
<span class="linenr">18: </span># rule 4
<span class="linenr">19: </span>clean : 
<span class="linenr">20: </span>	rm -f *.o
<span class="linenr">21: </span>	rm -f main_prog
</pre>
</div>

<p>
By default, typing <code>make</code> will search for a file named <code>Makefile</code> but
the following invocation allows using a specific file other than that:
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; make -f Makefile-shortcuts
</pre>
</div>
</div>
</div>

<div id="outline-container-orge130a15" class="outline-3">
<h3 id="orge130a15"><span class="section-number-3">3.3</span> Dependency Detection</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Makefiles are useful for larger projects to automatically detect
dependencies which must be updated.  The example in
<code>demo-makefile-big/</code> shows a "larger" project with more files. Observe
the following:
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; make                # COMPILE 1
gcc -c main_func.c
gcc -c func_01.c
gcc -c func_02.c
gcc -c func_03.c
gcc -c func_04.c
gcc -c func_05.c
gcc -c func_06.c
gcc -c func_07.c
gcc -c func_08.c
gcc -c func_09.c
gcc -c func_10.c
gcc -c func_11.c
gcc -c func_12.c
gcc -c func_13.c
gcc -c func_14.c
gcc -c func_15.c
gcc -c func_16.c
gcc -c func_17.c
gcc -c func_18.c
gcc -c func_19.c
gcc -c func_20.c
gcc -o main_prog main_func.o func_01.o func_02.o func_03.o func_04.o func_05.o func_06.o func_07.o func_08.o func_09.o func_10.o func_11.o func_12.o func_13.o func_14.o func_15.o func_16.o func_17.o func_18.o func_19.o func_20.o

&gt;&gt; make                # COMPILE 2
make: Nothing to be done for 'all'.

&gt;&gt; rm func_12.o        # delete a .o
&gt;&gt; touch func_05.c     # make func_05.c look like it has been edited

&gt;&gt; make                # COMPILE 3
gcc -c func_05.c       # only out of sync or
gcc -c func_12.c       # missing targets are regenerated
gcc -o main_prog main_func.o func_01.o func_02.o func_03.o func_04.o func_05.o func_06.o func_07.o func_08.o func_09.o func_10.o func_11.o func_12.o func_13.o func_14.o func_15.o func_16.o func_17.o func_18.o func_19.o func_20.o
</pre>
</div>
<p>
The lesson above is in <code>COMPILE 3</code>: make detects that most of the <code>.o</code>
files are in sync with their source files. Only the missing / out of
sync targets have their rules applied to regenerated them and update
the exectuable program.
</p>
</div>
</div>
</div>


<div id="outline-container-org451a493" class="outline-2">
<h2 id="org451a493"><span class="section-number-2">4</span> Problem 2: I/O Redirection</h2>
<div class="outline-text-2" id="text-4">
<p>
Programs often need to deal with open files for reading and
writing. The UNIX Operating System (Linux included in this) maintains
a data structure called the <b>File Descriptor Table</b> for all open
files. Some entries in this table are automatically created like
Standard Input and Standard Output. Others are created via the
<code>open()</code> system call. The table is maintained in Kernel Space and can
only be altered via system calls like <code>open() / close() / ~dup() /
dup2()</code>.
</p>

<p>
It is useful to have some diagrams of how the <code>dup()</code> and <code>dup2()</code>
system calls manipulate the table of file descriptors.  The following
diagrams will be discussed in lecture and may be used by course staff
to assist students in understanding how programs like
<code>switch_stdout.c</code> work.
</p>
</div>

<div id="outline-container-org74b3844" class="outline-4">
<h4 id="org74b3844">Fork and Child File Descriptors</h4>
<div class="outline-text-4" id="text-org74b3844">
<div class="org-center">

<div id="org625a7ca" class="figure">
<p><img src="fork-fds.png" alt="fork-fds.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 1: </span>Effects of <code>open()</code>'ing a file then calling <code>fork()</code> : the child and parent both refer to the same open file.</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgcddd639" class="outline-4">
<h4 id="orgcddd639">dup() and dup2() System calls</h4>
<div class="outline-text-4" id="text-orgcddd639">
<div class="org-center">

<div id="orgcba92f4" class="figure">
<p><img src="fork-fds.png" alt="fork-fds.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 2: </span>LEFT: Effect of calling <code>dup()</code> to create a duplicate file descriptor table entry. RIGHT: Effect of calling <code>dup2()</code> to overwrite on file descriptor entry with another.</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdd5f15c" class="outline-2">
<h2 id="orgdd5f15c"><span class="section-number-2">5</span> QUESTIONS.txt File Contents</h2>
<div class="outline-text-2" id="text-5">
<p>
Below are the contents of the <code>QUESTIONS.txt</code> file for the exercise.
Follow the instructions in it to complete the QUIZ and CODE questions
for the exercise.
</p>

<div class="org-src-container">
<pre class="src src-text">                           _________________

                            LAB10 QUESTIONS
                           _________________





Exercise Instructions
=====================

  Follow the instructions below to experiment with topics related to
  this exercise.
  - For sections marked QUIZ, fill in an (X) for the appropriate
    response in this file. Use the command `make test-quiz' to see if
    all of your answers are correct.
  - For sections marked CODE, complete the code indicated. Use the
    command `make test-code' to check if your code is complete.
  - DO NOT CHANGE any parts of this file except the QUIZ sections as it
    may interfere with the tests otherwise.
  - If your `QUESTIONS.txt' file seems corrupted, restore it by copying
    over the `QUESTIONS.txt.bk' backup file.
  - When you complete the exercises, check your answers with `make test'
    and if all is well, create a zip file with `make zip' and upload it
    to Gradescope. Ensure that the Autograder there reflects your local
    results.
  - IF YOU WORK IN A GROUP only one member needs to submit and then add
    the names of their group.


QUIZ Problem 1: Questions on Makefiles
======================================

  Review the presentation of `Makefile' basics in the lab description
  and analyze the examples provided in the demo directories
  `demo-makefile-little' and `demo-makefile-big'. Then answer the
  following questions.


Command Execution
~~~~~~~~~~~~~~~~~

  Which of the following best describes when the commands for a rule are
  run?
  - ( ) The commands for all targets in the Makefile are all run every
    time make is used
  - ( ) Only the commands associated with the target named on the
    command line are run; e.g. `make targ5` will run commands associated
    with targ5
  - ( ) Commands for a given rule execute only if make detects a its
    target is needed and then only if the target is missing or older
    than its dependencies


Rule Syntax
~~~~~~~~~~~

  Which of the following Rules correctly lays out the syntax for target,
  dependencies, and commands in a Makefile.
  ,----
  | # RULE A
  | target : dependency1 dependency2
  | 	command1
  | 	command2
  | 	command3
  | 
  | # RULE B
  | target : dependency1 dependency2
  | command1
  | command2
  | command3
  | 
  | # RULE C
  | dependency1 dependency2 : target 
  | 	command1
  | 	command2
  | 	command3
  | 
  | # RULE D
  | target :
  | 	command1
  | 	command2
  | 	command3
  | : dependency1 dependency2
  `----
  - ( ) RULE A
  - ( ) RULE B
  - ( ) RULE C
  - ( ) RULE D


Variance in Makefiles
~~~~~~~~~~~~~~~~~~~~~

  Check ALL that are true about Makefile features
  - ( ) Rules may have 0 dependencies
  - ( ) Rules may have 0 commands
  - ( ) Rules have no more than 1 command
  - ( ) Rules have no more than 1 dependency
  - ( ) Makefiles can set up explicit variables for use in rules
  - ( ) Makefiles provide a variety of automatic variables for use in
    rules
  - ( ) A Makefile can have deeply nested decencies: targA depends on
    targB depends on targC depends on targD etc.


CODE Problem 2: prob1-makefile
==============================

  Complete the template in the subdirectory `prob1-makefile/Makefile'
  according to the comments there.  The essential idea is to build the
  linked list program from an earlier lab and add a few other targets.
  Once you add rules for certain targets, you can test them
  interactively via commands like `make' and `make clean' in that
  directory. You can also run the automated tests of this via a problem
  test:

  ,----
  | &gt;&gt; cd lab10-code
  | &gt;&gt; make test-prob1   # run tests for Makefile under prob1-makefile
  | ...
  `----


QUIZ Problem 2: Questions on switch_stdout.c
============================================

  Analyze the `switch_stdout.c' program. Compile and run it via
  ,----
  | &gt; make switch_stdout
  | ...
  | &gt; ./switch_stdout
  | ...
  `----

  Analyze the code and focus your attention on the use of `open() /
  dup() / dup2()' which this program demonstrates.

  Answer the following Questions about the techniques used in this
  program. You may need to consult the Manual Page / Documentation on
  some functions to answer confidently.


Program Output
~~~~~~~~~~~~~~

  Which of the following is the output for `switch_stdout' when run?
  (each of 1. 2. 3. appear on separate lines in the output)
  - ( ) 1. Now you see me. 2. Now you don't!  3. How mysterious...
  - ( ) 1. Now you see me. 2. Now you don't!
  - ( ) 1. Now you see me. 3. How mysterious...
  - ( ) 1. Now you see me.


open() system call
~~~~~~~~~~~~~~~~~~

  The `open()' system call is used to open a file for writing in the
  example.  What is returned by this system call?
  - ( ) A `FILE *' which is passed to subsequent I/O operations or
    `NULL' for failure
  - ( ) An integer file descriptor which is &gt;= 0 for success and -1 for
    failure
  - ( ) An integer return code that is 1 for success and 0 for failure
  - ( ) A `char *' which is the name of the opened file or `NULL' for
    failure


Use of dup()
~~~~~~~~~~~~

  Which of the following best describes how the `dup()' system call is
  used in `switch_stdout.c'?
  - ( ) It creates a duplicate of a file descriptor allowing standard
    output to be restored to the screen late in the program.
  - ( ) It manipulates the file descriptor table so output that would go
    to the screen goes into a file instead.
  - ( ) It duplicates an existing file creating an efficient copy of it
    on disk.
  - ( ) It creates a child process that prints to a file instead of the
    screen.


Use of dup2()
~~~~~~~~~~~~~

  Which of the following best describes how the `dup2()' system call is
  used in `switch_stdout.c'?
  - ( ) It creates a duplicate of a file descriptor allowing standard
    output to be restored to the screen late in the program.
  - ( ) It manipulates the file descriptor table so output that would go
    to the screen goes into a file instead.
  - ( ) It duplicates an existing file creating an efficient copy of it
    on disk.
  - ( ) It creates a child process that prints to a file instead of the
    screen.


printf() changes in behavior
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  Good old `printf()' is used in `switch_stdout.c' in several places but
  seems to change its behavior in some of these spots. Which of the
  following best describes this variation in behavior?
  - ( ) `printf()' is called with different arguments that cause it to
    print to different destinations, sometimes standard output,
    sometimes a file
  - ( ) `printf()' is called the same way in each case but automatically
    begins printing to a file that is `open()''d and when it is
    `close()''d, `printf()' reverts to printing to the screen
  - ( ) `printf()' is called the same in each case and always prints to
    standard output but by changing what is in the file descriptor table
    at that position, output goes to the screen or to a file.


CODE Problem 2: Complete redirect_child.c
=========================================

  An incomplete file called `redirect_child.c' is present in the code
  pack which is intended to preform the following operations.
  1. Create a child process
  2. The child process redirects its output into a file
  3. The child process then exec()'s a new process image which will
     place output in the file specified
  4. The parent process blocks until the child is complete and then
     shows the output file.

  A skeleton is provided but a number of TODO/??? items must be filled
  into to complete the program.  A number of the techniques are required
  to complete the code
  - Process manipulation from previous labs
  - I/O redirection demonstrated in this lab in `switch_stdout.c'

  Employ these to complete the program and pass the tests available in
  `make test-code'.

  A correct run looks like the following.
  ,----
  | &gt; make
  | gcc -Wall -Werror -g  -o switch_stdout switch_stdout.c
  | gcc -Wall -Werror -g  -o redirect_child redirect_child.c
  | 
  | &gt; ./redirect_child 
  | usage: ./redirect_child &lt;childfile&gt;
  | 
  | &gt; ./redirect_child childout.txt
  | Removing file 'childout.txt' prior to run via a subshell
  | Creating a child to do 'wc'
  | Parent waiting for child to complete
  | Child redirecting output to 'childout.txt', then exec()'ing
  | Child complete, return code 0
  | Showing output of 'childout.txt' via 'cat' command
  | 25 25 66 nums.txt
  | 
  | &gt; cat childout.txt 
  | 25 25 66 nums.txt
  `----
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d2527f" class="outline-2">
<h2 id="org9d2527f"><span class="section-number-2">6</span> Submission</h2>
<div class="outline-text-2" id="text-6">
<p>
Follow the instructions at the end of <a href="lab01.html">Lab01</a> if you need a refresher on
how to upload your completed exercise zip to Gradescope.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/> <i> Author: Chris Kauffman (<a href="mailto:profk@umd.edu">profk@umd.edu</a>) <br/> Date: 2024-04-07 Sun 23:03 <br/> </i>
</div>
</body>
</html>
