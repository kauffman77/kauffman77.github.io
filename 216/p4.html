<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-04-25 Fri 19:15 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CMSC216 Project 4: Going Commando</title>
<meta name="author" content="Chris Kauffman" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1" />
<style type="text/css">
@media screen {
:root {
--heading-bg-color:#e21833;
--heading-fg-color:#ffd200;
}
html {
font-family: serif;
text-align: justify;
}
pre.src, pre.example {
overflow-x: scroll;
}
/* Merge subtitle area with title area */
.subtitle {
text-align: center;
margin-top: -2em;
padding-top: 1em;
padding-bottom: 0.1em;
}
.title, .subtitle {
color: var(--heading-fg-color);
background-color: var(--heading-bg-color);
}
/* Section borders, left section header style */
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
blockquote {
font-style: italic;
}
td, th {
padding-top: 2px;
padding-bottom: 2px;
}
body {
background-color: #EEE;
}
pre {
}
#content, #preamble, #postamble {
margin-left:300px;
max-width: 100%;
}
.tag {
background-color: inherit; font-family: inherit;
padding: inherit; font-size: 80%; font-weight: inherit;
text-transform: uppercase;
}

.figure p { text-align: inherit; }
figure-number { font-style: italic; }
#table-of-contents {
text-align: left;
position: fixed;
left: 0;
margin: 0 auto;
padding: 0;
width: 300px;
top: 0;
height: 100%;
border: 0;
display: block;
}
#text-table-of-contents {
overflow-y: scroll;
height: 100%;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
#table-of-contents > h2 {
padding: 0.1em;
margin: 0;
}
/* adjustments for small screen, toc at top only */
@media (max-width: 800px) { /* landscape for iphone */
html {
-webkit-text-size-adjust: none;  /* prevent scaling of text on mobile */
}
body {
background-color: #EEE;
width:100%;
margin:0 auto;
}
#content, #preamble, #postamble {
margin-left:0;
}
#table-of-contents {
position: static;
left: inherit;
width:inherit;
height: auto;
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
border: 0.75em solid #006633;
}
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
#text-table-of-contents {
overflow-y: visible;
height: inherit;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
}
.linenr { font-size: xx-small; }
th.org-left   { text-align: left;   }
}

@media print {
html {
font-family: serif;
font-size: 10pt;
text-align: justify;
.linenr { font-size: xx-small; }
}
}
</style>
<style>
/* Theme: Srcery
Description: Srcery dark color scheme for highlight.js
Author: Chen Bin <chen.bin@gmail.com>
Maintainer: @redguardtoo
Website: https://srcery-colors.github.io/
Date: 2021-04-13
https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/srcery.css

Tailored by: Chris Kauffman <profk@umd.edu>
Date: Sat Nov 25 06:16:20 PM EST 2023
*/
pre code.hljs {
display: block;
overflow-x: auto;
padding: 1em
}
code.hljs {
padding: 3px 5px
}
.hljs {
background: #1C1B19;
/* Black */
color: #FFFFFF/* Bright White */

}
/* Bright White */
.hljs-subst,
.hljs-quote,
.hljs-literal {
color: #FCE8C3
}
/* Bright Blue */
.hljs-type,
.hljs-symbol {
color: #68A8E4
}
/* Red */
.hljs-keyword,
.hljs-deletion {
color: #EF2F27
}
/* Yellow */
.hljs-name,
.hljs-function,
.hljs-attribute,
.hljs-selector-attr,
.hljs-selector-id,
.hljs-selector-class,
.hljs-selector-pseudo,
.hljs-section,
.hljs-title {
color: #FBB829
}
/* Cyan */
.hljs-code,
.hljs-variable,
.hljs-property,
.hljs-template-variable,
.hljs-class {
color: #0AAEB3
}
/* Bright Green */
.hljs-string,
.hljs-regexp,
.hljs-bullet,
.hljs-addition {
color: #98BC37
}
/* Bright Magenta */
.hljs-built_in,
.hljs-params {
color: #FF5C8F
}
/* Blue */
.hljs-template-tag,
.hljs-selector-tag {
color: #2C78BF
}
/* Bright Black */
.hljs-link,
.hljs-number,
.hljs-comment,
.hljs-meta {
color: #B1B195
/* color: #918175 */
}
.hljs-emphasis {
font-style: italic
}
.hljs-strong {
font-weight: bold
}
/* @see https://github.com/srcery-colors/srcery-emacs for reference */
</style>

<link rel="stylesheet" href="./srcery-ck.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
function interactive_lang() {      // define a custom "interactive" language
return {
name: 'interactive',           // language name
keywords: {
$pattern: /[^ \t\n]+/,       // lex based on non-whitespace
keyword: [">>","(shellac)","[COMMANDO]>>","HM>","TM>","HS>","homeputer>","grace3:","grace4:","grace5:","grace6:","grace7:","grace8:","grace9:","grace10:","grace3>>","grace4>>","grace5>>","grace6>>","grace7>>","grace8>>","grace9>>","grace10>>"], // allowed interactive prompts
},
contains: [
// hljs.HASH_COMMENT_MODE,   // use standard hash comments, any # is a comment
// hljs.COMMENT(/#+ /, /$/),    // use custom comment of # w/ whitespace
hljs.COMMENT(/## /, /$/),     // hash-hash-ws for comment
hljs.COMMENT(/##+/, /$/),     // or a sequence of hashes
]
};
};
hljs.registerLanguage('interactive', interactive_lang);     // register custom language

// Add highlighjs CSS classes to elemens marked with relevant org classes
lang_map = new Map();              // map of org to hljs languages
lang_map.set("src-c"     , "language-c");
lang_map.set("src-python", "language-python");
lang_map.set("src-text"  , "language-plaintext");
lang_map.set("src-sh"    , "language-interactive");
function add_class(el) {           // applied to each pre.src element
for (let [org_lang, hljs_lang] of lang_map) {
if(el.classList.contains(org_lang)){
el.classList.add(hljs_lang);
}
}
}
// visit all pre.src elements and apply function to add language class
document.querySelectorAll('pre.src').forEach(add_class);
hljs.configure({cssSelector: 'pre'}); // select pre blocks only to highligh
hljs.highlightAll();                  // perform highlighting on all pre blocks
});
</script>
</head>
<body>
<div id="preamble" class="status">
<i>Last Updated: 2025-04-25 Fri 19:15</i>
</div>
<div id="content" class="content">
<h1 class="title">CMSC216 Project 4: Going Commando</h1>
<ul class="org-ul">
<li><b>Due: 11:59pm Sat 03-May-2025</b> on <a href="https://www.gradescope.com/">Gradescope</a></li>
<li><i>Approximately 4.0% of total grade</i></li>
<li>Projects are <b>individual work</b>: no collaboration with other students
is allowed. Seek help from course staff if you get stuck for too long.</li>
</ul>
<div id="outline-container-org62a2833" class="outline-4">
<h4 id="org62a2833">CODE DISTRIBUTION: <a href="p4-code.zip">p4-code.zip</a></h4>
</div>

<div id="outline-container-org8f38cb6" class="outline-4">
<h4 id="org8f38cb6">VIDEO OVERVIEW: <i>Not Yet Available</i></h4>
</div>
<div id="outline-container-org4e2879f" class="outline-4">
<h4 id="org4e2879f">CHANGELOG: Empty</h4>
</div>
<div id="outline-container-orgaf720c4" class="outline-4">
<h4 id="orgaf720c4"></h4>
<div class="outline-text-4" id="text-orgaf720c4">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org7ac6168">1. Introduction: A Simple Shell</a></li>
<li><a href="#orgef73cc4">2. Download Code and Setup</a></li>
<li><a href="#org069c211">3. Opening Demo</a></li>
<li><a href="#org06789b4">4. Overall Architecture</a>
<ul>
<li><a href="#orga2dbbf4">4.1. <code>cmd_t</code> struct</a></li>
<li><a href="#org155ad44">4.2. <code>cmdctl_t</code> struct</a></li>
<li><a href="#orge985c28">4.3. <code>main()</code> function ::</a></li>
<li><a href="#org68ed629">4.4. Outline of Code</a></li>
</ul>
</li>
<li><a href="#orgee79a72">5. <b>Problem 1</b>: Basic Functionality</a>
<ul>
<li><a href="#org8cd70fc">5.1. Implementation Notes</a></li>
<li><a href="#org41e6f39">5.2. Grading Criteria for Problem 1</a></li>
</ul>
</li>
<li><a href="#orgd416b44">6. <b>Problem 2</b>: Starting and Finishing Commands</a>
<ul>
<li><a href="#org282225f">6.1. Implementation Notes</a></li>
<li><a href="#org179b42f">6.2. Grading Criteria for Problem 2</a></li>
</ul>
</li>
<li><a href="#org53d0951">7. <b>Problem 3</b>: Commando <code>main()</code></a>
<ul>
<li><a href="#org204dad3">7.1. Interactive Loop</a></li>
<li><a href="#org9cbcdb3">7.2. Startup, Basic Help, Exiting</a></li>
<li><a href="#org577252f">7.3. Command Line Forms and Usage</a></li>
<li><a href="#org90fd5b0">7.4. Command Echoing</a></li>
<li><a href="#org14bd0ee">7.5. Output Directory</a></li>
<li><a href="#org1375467">7.6. Built-ins</a></li>
<li><a href="#orgb80b951">7.7. Running Commands</a></li>
<li><a href="#org00e38d2">7.8. Grading Criteria for Problem 2</a></li>
</ul>
</li>
<li><a href="#orgdcc2028">8. <b>MAKEUP Problem</b></a></li>
<li><a href="#org2c878be">9. Project Submission</a>
<ul>
<li><a href="#orgddfe246">9.1. Submit to Gradescope</a></li>
<li><a href="#orgef7b55a">9.2. Late Policies</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-org7ac6168" class="outline-2">
<h2 id="org7ac6168"><span class="section-number-2">1</span> Introduction: A Simple Shell</h2>
<div class="outline-text-2" id="text-1">
<p>
Command line shells allow one to access the capabilities of a computer
using simple, interactive means.  Type the name of a program and the
shell will bring it into being, run it, and show output.  The name
"shell" is indicative of the program providing a thin convenience
"layer" around more core facilities of a computing and operating
system: run programs easily and see what they do. Familiarizing
yourself with a basic shell implementation teaches about this
interface layer and will make working in full-blown shells more
palatable. 
</p>

<p>
The goal of this project is to write a simple, quasi-command line
shell called <code>commando</code>.  The shell will be less functional in many
ways from standard shells like <code>bash</code> (default on most Linux
machines), <code>zsh</code> (default on MacOS) and <code>tcsh</code> (default on GRACE), but
will have some properties that distinguish it such as maintaining a
history of all programs run and their output.  Like most interesting
projects, <code>commando</code> uses a variety of system calls together to
accomplish its overall purpose.  Most of these will be individually
discussed in lecture but the interactions between them is what
inspires real danger and romance.
</p>

<p>
Completing <code>commando</code> will educate an implementer on the following
systems programming topics.
</p>
<ul class="org-ul">
<li><b>Basic C Memory Discipline</b>: A variety of strings and structs are
allocated and de-allocated during execution which will require
attention to detail and judicious use of memory tools like Valgrind.</li>
<li><b>fork() and exec()</b>: Text entered that is not recognized as a
built-in is treated as an command (external program) to be
executed. This spawns a child process which executes the new
program.</li>
<li><b>open(), dup2(), mkdir(), read():</b> Rather than immediately print child output
to the screen, child output is redirected into files and then
retrieved on request by commando.</li>
<li><b>wait() and waitpid(), blocking and nonblocking:</b> Child processes
usually take a while to finish so the shell will check on their
status every so often</li>
</ul>
</div>
</div>
<div id="outline-container-orgef73cc4" class="outline-2">
<h2 id="orgef73cc4"><span class="section-number-2">2</span> Download Code and Setup</h2>
<div class="outline-text-2" id="text-2">
<p>
As in labs, download the code pack linked at the top of the
page. Unzip this which will create a folder and create your files in
that folder.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">File</th>
<th scope="col" class="org-left">State</th>
<th scope="col" class="org-left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>Makefile</code></td>
<td class="org-left">CREATE</td>
<td class="org-left">Build project, run tests</td>
</tr>

<tr>
<td class="org-left"><code>commando_funcs.c</code></td>
<td class="org-left">CREATE</td>
<td class="org-left">Functions to deal with the <code>cmd_t</code> and <code>cmdctl_t</code> structs (Problems 1/2)</td>
</tr>

<tr>
<td class="org-left"><code>commando_main.c</code></td>
<td class="org-left">CREATE</td>
<td class="org-left">main() function for commando interactive shell (Problem 3)</td>
</tr>

<tr>
<td class="org-left"><code>commando.h</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Header file which contains required structs, defines, and prototypes</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>test_commando.org</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Test definitions for all commando</td>
</tr>

<tr>
<td class="org-left"><code>test_commando.c</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Low-level function tests for Problems 1/2</td>
</tr>

<tr>
<td class="org-left"><code>testy</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Test running script</td>
</tr>

<tr>
<td class="org-left"><code>test_standardize_pids</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Filter to standardize PID printing during testing</td>
</tr>

<tr>
<td class="org-left"><code>test_standardize_all</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Filter to standardize other output during testing</td>
</tr>

<tr>
<td class="org-left"><code>data/</code></td>
<td class="org-left">Data</td>
<td class="org-left">Directory containing below files used in testing</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org069c211" class="outline-2">
<h2 id="org069c211"><span class="section-number-2">3</span> Opening Demo</h2>
<div class="outline-text-2" id="text-3">
<p>
The best way to get a sense of any program is to see how it
behaves. In the below demonstration, <code>commando</code> is first built then
started. Input is entered in <code>commando</code> after its prompt on lines that
look like this:
</p>
<div class="org-src-container">
<pre class="src src-sh">[COMMANDO]&gt;&gt; commands here
</pre>
</div>
<p>
Other lines contain output from the program. To the right of the demo
after the <code>#</code> symbol are comments on what is happening.
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; make commando                                            ## compile commando
gcc -Wall -Werror -g -c commando_main.c
gcc -Wall -Werror -g -c commando_funcs.c
gcc -Wall -Werror -g -o commando commando_main.o commando_funcs.o

&gt;&gt; ./commando                                               ## run commando
=== COMMANDO ver 2 ===
Type 'help' for supported commands
[COMMANDO]&gt;&gt; help                                           ## print help on builtins
help                       : show this message
exit                       : exit the program
directory                  : show the directory used for command output
history                    : list all jobs that have been started giving information on each
pause &lt;secs&gt;               : pause for the given number of seconds which may be fractional
info &lt;cmdid&gt;               : show detailed information on a command
show-output &lt;cmdid&gt;        : print the output for given command number
finish &lt;cmdid&gt;             : wait until the given command finishes running
finish-all                 : wait for all running commands to finish
source &lt;filename&gt;          : (MAKEUP) open and read input from the given file as though it were typed
command &lt;arg1&gt; &lt;arg2&gt; ...  : non-built-in is run as a command and logged in history

[COMMANDO]&gt;&gt; directory                                      ## print the directory used for command output
Output directory is 'commando-dir'                          ## this is the default value

[COMMANDO]&gt;&gt; history                                        ## show the history of commands; none so far
CMDID PID       BYTES STATE           COMMAND

[COMMANDO]&gt;&gt; cat data/quote.txt                             ## run a command as a child process

[COMMANDO]&gt;&gt; history                                        ## show the history of entered commands, one currently running
CMDID PID       BYTES STATE           COMMAND
    0 #222616       - RUNNING         cat
---&gt; COMPLETE:     0 #222616     125 EXIT(0)         cat    
1 commands finished                                         ## an alert that a previously started command ended

[COMMANDO]&gt;&gt; history                                        ## after the above command finishes, state has changed
CMDID PID       BYTES STATE           COMMAND
    0 #222616     125 EXIT(0)         cat

[COMMANDO]&gt;&gt; info 0                                         ## detailed information on the command
CMD 0 INFORMATION
command: cat data/quote.txt 
argv[]:
  [ 0]: cat
  [ 1]: data/quote.txt
cmdstate: EXIT(0)
input: &lt;NONE&gt;
output: commando-dir/0000-cat.out
output size: 125 bytes

[COMMANDO]&gt;&gt; show-output 0                                  ## output for the completed command
Object-oriented programming is an exceptionally bad idea which could
only have originated in California.

-- Edsger Dijkstra

[COMMANDO]&gt;&gt; ls -l data                                     ## start another command

[COMMANDO]&gt;&gt;                                                ## after a momement, press enter
---&gt; COMPLETE:     1 #222643    1097 EXIT(0)         ls
1 commands finished                                         ## to see the command has finished

[COMMANDO]&gt;&gt; history                                        ## show history
CMDID PID       BYTES STATE           COMMAND
    0 #222616     125 EXIT(0)         cat
    1 #222643    1097 EXIT(0)         ls

[COMMANDO]&gt;&gt; show-output 1                                  ## print output for last command
total 96
-rw-r--r-- 1 kauffman users 13893 Feb  5  2019 3K.txt
-rwxr--r-- 1 kauffman users    43 Apr 23 23:41 delay.sh
-rw-r--r-- 1 kauffman users  1511 Feb  5  2019 gettysburg.txt
-rwxr--r-- 1 kauffman users   326 Apr 24 15:17 make_unwriteable.sh
-rwxr-xr-x 1 kauffman users 15424 Apr 24 15:12 print_args
-rw-r--r-- 1 kauffman users   218 Feb  5  2019 print_args.c
-rw-r--r-- 1 kauffman users   125 Feb  5  2019 quote.txt
-rw-r--r-- 1 kauffman users   184 Feb  6  2020 README
-rw-r--r-- 1 kauffman users    72 Apr 21 14:02 script.txt
-rwxr--r-- 1 kauffman users   185 Apr 23 23:35 self_signal.sh
-rwxr--r-- 1 kauffman users    36 Apr 18 16:17 sleep_print.sh
drwxr-xr-x 2 kauffman users  4096 Apr 25 10:22 subdir
-rwxr--r-- 1 kauffman users   427 Feb  5  2019 table.sh

[COMMANDO]&gt;&gt; data/sleep_print 25.0 Long running             ## start command but mistype its name

[COMMANDO]&gt;&gt; history                                        ## show current history
CMDID PID       BYTES STATE           COMMAND
    0 #222616     125 EXIT(0)         cat
    1 #222643    1097 EXIT(0)         ls
    2 #222659       - RUNNING         data/sleep_print
---&gt; COMPLETE:     2 #222659      95 FAIL_EXEC       data/sleep_print
1 commands finished                                         ## note the FAILE_EXEC - didn't run right

[COMMANDO]&gt;&gt; data/sleep_print.sh 25.0 Long running          ## try again with the correct name

[COMMANDO]&gt;&gt; history                                        ## command running now
CMDID PID       BYTES STATE           COMMAND
    0 #222616     125 EXIT(0)         cat
    1 #222643    1097 EXIT(0)         ls
    2 #222659      95 FAIL_EXEC       data/sleep_print
    3 #222666       - RUNNING         data/sleep_print.sh

[COMMANDO]&gt;&gt; info 3                                         ## show detailed information
CMD 3 INFORMATION
command: data/sleep_print.sh 25.0 Long running              ## full command line
argv[]:                                                     ## command line args
  [ 0]: data/sleep_print.sh
  [ 1]: 25.0
  [ 2]: Long
  [ 3]: running
cmdstate: RUNNING                                           ## current state: still running
input: &lt;NONE&gt;
output: commando-dir/0003-data_sleep_print.sh.out
output size: &lt;CMD NOT FINISHED&gt;                             ## no output as it is still running

[COMMANDO]&gt;&gt; wc -l data/gettysburg.txt                      ## launch another command

[COMMANDO]&gt;&gt; 
---&gt; COMPLETE:     4 #222677      23 EXIT(0)         wc     ## it finishes quickly
1 commands finished

[COMMANDO]&gt;&gt; history                                        ## check history
CMDID PID       BYTES STATE           COMMAND
    0 #222616     125 EXIT(0)         cat
    1 #222643    1097 EXIT(0)         ls
    2 #222659      95 FAIL_EXEC       data/sleep_print
    3 #222666       - RUNNING         data/sleep_print.sh   ## still running
    4 #222677      23 EXIT(0)         wc

[COMMANDO]&gt;&gt; data/table.sh 10 3                             ## run another command
---&gt; COMPLETE:     3 #222666      13 EXIT(0)         data/sleep_print.sh
1 commands finished                                         ## past command finishes

[COMMANDO]&gt;&gt;                                                ## wait a tick and press enter
---&gt; COMPLETE:     5 #222688     380 EXIT(0)         data/table.sh
1 commands finished                                         ## most recent command finishes

[COMMANDO]&gt;&gt; info 4                                         ## information on 4th command
CMD 4 INFORMATION
command: wc -l data/gettysburg.txt 
argv[]:
  [ 0]: wc
  [ 1]: -l
  [ 2]: data/gettysburg.txt
cmdstate: EXIT(0)
input: &lt;NONE&gt;
output: commando-dir/0004-wc.out
output size: 23 bytes

[COMMANDO]&gt;&gt; show-output 4                                  ## output for 4th command
28 data/gettysburg.txt

[COMMANDO]&gt;&gt; info 5                                         ## infor for 5th command
CMD 5 INFORMATION
command: data/table.sh 10 3
argv[]:
  [ 0]: data/table.sh
  [ 1]: 10
  [ 2]: 3
cmdstate: EXIT(0)
input: &lt;NONE&gt;
output: commando-dir/0005-data_table.sh.out
output size: 380 bytes

[COMMANDO]&gt;&gt; show-output 5                                  ## output for command
i^1=      1  i^2=      1  i^3=      1
i^1=      2  i^2=      4  i^3=      8
i^1=      3  i^2=      9  i^3=     27
i^1=      4  i^2=     16  i^3=     64
i^1=      5  i^2=     25  i^3=    125
i^1=      6  i^2=     36  i^3=    216
i^1=      7  i^2=     49  i^3=    343
i^1=      8  i^2=     64  i^3=    512
i^1=      9  i^2=     81  i^3=    729
i^1=     10  i^2=    100  i^3=   1000

[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 A                      ## launch several commands that
                                                            ## will take 5 seconds to run
[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 B

[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 C

[COMMANDO]&gt;&gt; pause 5.5                                      ## pause commando for 5.5 seconds
Pausing for 5.500000 seconds
---&gt; COMPLETE:     6 #222705       2 EXIT(0)         data/sleep_print.sh
---&gt; COMPLETE:     7 #222710       2 EXIT(0)         data/sleep_print.sh
---&gt; COMPLETE:     8 #222716       2 EXIT(0)         data/sleep_print.sh
3 commands finished                                         ## an coming back from pause, all commands finished

[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 D                      ## 9th command runs a long time

[COMMANDO]&gt;&gt; data/sleep_print.sh 1.0 D                      ## short run

[COMMANDO]&gt;&gt; data/sleep_print.sh 1.0 D                      ## short run

[COMMANDO]&gt;&gt; finish 9                                       ## block until 9th command finishes
---&gt; COMPLETE:     9 #222765       2 EXIT(0)         data/sleep_print.sh   ## 9th command done
---&gt; COMPLETE:    10 #222770       2 EXIT(0)         data/sleep_print.sh   ## top-of-loop update shows
---&gt; COMPLETE:    11 #222777       2 EXIT(0)         data/sleep_print.sh   ## short run command also done
2 commands finished                                                        ## only 2 as 1st is an explicit finish

[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 X                      ## start several long-running commands

[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 X

[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 X

[COMMANDO]&gt;&gt; finish-all                                     ## wait for all to fininsh
---&gt; COMPLETE:    12 #222793       2 EXIT(0)         data/sleep_print.sh
---&gt; COMPLETE:    13 #222798       2 EXIT(0)         data/sleep_print.sh
---&gt; COMPLETE:    14 #222801       2 EXIT(0)         data/sleep_print.sh
3 commands finished

[COMMANDO]&gt;&gt; exit                                           ## all done for now

&gt;&gt;                                                          ## back to a "real" shell
</pre>
</div>
</div>
<div id="outline-container-orgdc69870" class="outline-4">
<h4 id="orgdc69870">Things to Note</h4>
<div class="outline-text-4" id="text-orgdc69870">
<ul class="org-ul">
<li>The child processes (commands) that <code>commando</code> starts do not show
any output by default and run concurrently with the main process
which gives back the <code>[COMMANDO]&gt;&gt;</code> prompt immediately.  This is
different from a normal shell such as <code>bash</code> which starts commands
in the foreground, shows their output immediately, and will block
the shell until a job finishes before showing the command prompt for
additional input.</li>
<li>The output for all jobs is saved by <code>commando</code> and can be recalled
at any time using the <code>show-output &lt;jobid&gt;</code> built-in.</li>
<li>Not all of the built-ins are shown in the demo but each will be
discussed in later sections.</li>
<li>It should be clear that <code>commando</code> is not a full shell (no signals,
built-in scripting, or pipes), but it is a mid-sized project which
will take some organization. Luckily, this document prescribes a
simple architecture to make the coding manageable.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org06789b4" class="outline-2">
<h2 id="org06789b4"><span class="section-number-2">4</span> Overall Architecture</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orga2dbbf4" class="outline-3">
<h3 id="orga2dbbf4"><span class="section-number-3">4.1</span> <code>cmd_t</code> struct</h3>
<div class="outline-text-3" id="text-4-1">
<p>
The <code>cmd_t</code> type is defined in the <code>commando.h</code> header file. It is
intended to encapsulate the state of a <b>command</b>, a running or
completed child process.  Fields within it describe aspects such as
the name of the command being run, arguments to it, its exit status,
and a file with the command output in it.
</p>

<div class="org-src-container">
<pre class="src src-c">// states in which a cmd might be
typedef enum  {
  CMDSTATE_NOTSET = 0,                // hasn't been set
  CMDSTATE_INIT,                      // cmd struct just initialized but no child process
  CMDSTATE_RUNNING,                   // child process fork()/exec()'d and running
  CMDSTATE_EXIT,                      // child process exited normally
  CMDSTATE_SIGNALLED,                 // child process exited abnormally due to a signal
  CMDSTATE_UNKNOWN_END,               // cmd finished but for unknown reasons
  CMDSTATE_FAIL_INPUT=97,             // couldn't find input file for redirection
  CMDSTATE_FAIL_OUTPUT=98,            // couldn't find input file for redirection
  CMDSTATE_FAIL_EXEC=99,              // exec() failed after fork()
} cmdstate_t;

// struct that represents a command and its output 
typedef struct cmd {
  char cmdline[MAX_LINE];             // original command line entered by users, copied from input
  char *argv[MAX_ARGS];               // argv[] for running child, NULL terminated, malloc()'d and must be free()'d
  int argc;                           // length of the argv[] array, used for sanity checks
  cmdstate_t cmdstate;                // indicates phase of cmd in life cycle (running, exited, etc.)
  pid_t pid;                          // PID of running child proces for the cmd; -1 otherwise
  int exit_code;                      // value returned on exit from child process or negative signal number
  char input_filename[MAX_NAME];      // name of file containing input
  char output_filename[MAX_NAME];     // name of file containing output
  ssize_t output_bytes;               // number of bytes of output
} cmd_t;
</pre>
</div>
</div>
</div>
<div id="outline-container-org155ad44" class="outline-3">
<h3 id="org155ad44"><span class="section-number-3">4.2</span> <code>cmdctl_t</code> struct</h3>
<div class="outline-text-3" id="text-4-2">
<p>
The demo illustrates that <code>commando</code> tracks multiple commands and
their child processes.  This multiplicity is simplified somewhat with
a data structure to add and iterate through all child jobs. This is
the role of <code>cmdctl_t</code>: it's most important field is the array <code>cmd_t
*cmds</code> which maintains all commands that are running or are
complete. As the number of commands run increases, this array may
"expand" which will require reallocation and copying of its contents
to new memory. The struct also maintains some global information such
as the directory that is used to store output for commands.
</p>

<p>
Most functions in <code>commando_funcs.c</code> pertain to operating on a
<code>cmdctl_t</code> struct often taking an index of a individual command to
operate on. Function including adding a command, starting a command
running, updating a command to see if it has finished, and printing
information and output for a command.
</p>

<div class="org-src-container">
<pre class="src src-c">// control structure to track cmd history, output location, etc.
typedef struct {                
  char cmddir[MAX_NAME];              // name of the directory where cmd output files will be placed
  int cmds_count;                     // number of elements in the cmds array
  int cmds_capacity;                  // capacity of the cmds array
  cmd_t *cmds;                        // array of all cmds that have run / are running
} cmdctl_t;
</pre>
</div>
</div>
</div>
<div id="outline-container-orge985c28" class="outline-3">
<h3 id="orge985c28"><span class="section-number-3">4.3</span> <code>main()</code> function ::</h3>
<div class="outline-text-3" id="text-4-3">
<p>
The file <code>commando_main.c</code> will contain a <code>main()</code> function which
loops over input provided by the user either interactively or via
standard input as is done in the automated tests.  After setup, the
program executes an infinite loop until no more input is available or
an exit/quit built-in is used. The <code>main()</code> understand certain
<b>built-ins</b> that allow checking on running commands or reporting
output. Anything that doesn't match a built-in is <code>fork()'d/exec()'d</code>
as a child process and encapsulated as a "command".
</p>

<p>
Several command line options are supported by <code>main()</code> to enable
echoing and change the default output directory. These are described
later. 
</p>
</div>
</div>
<div id="outline-container-org68ed629" class="outline-3">
<h3 id="org68ed629"><span class="section-number-3">4.4</span> Outline of Code</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Below is an outline of the required functions. Additional functions
may be added but were not needed in the instructor solution.
</p>

<p>
<b>Several utility functions are provided</b> at the beginning of the code
outline which students can and should be used in the implementation.
</p>

<div class="org-src-container">
<pre class="src src-c">#include "commando.h"

////////////////////////////////////////////////////////////////////////////////
// PROVIDED DATA / FUNCTIONS
//
// The data and functions below should not be altered as they should
// be used as-is in the project.
///////////////////////////////////////////////////////////////////////////////

// Prints out a message if the environment variable DEBUG is set;
// Running as `DEBUG=1 ./some_program` or `DEBUG=1 make test-prob1`
// will cause all Dprintf() messages to show while running without the
// DEBUG variable will not print those messages. An example:
// 
// &gt;&gt; DEBUG=1 ./commando              // enable debug messages
// === COMMANDO ver 2 ===
// Re-using existing output directory 'commando-dir'
// Type 'help' for supported commands
// [COMMANDO]&gt;&gt; ls
// |DEBUG| sscanf ret is 1 for line `ls`
// |DEBUG| pid 237205 still running
// [COMMANDO]&gt;&gt; exit
// |DEBUG| sscanf ret is 1 for line `exit`
// |DEBUG| end main loop
// |DEBUG| freeing memory
// 
// &gt;&gt; ./commando                      // no debug messages
// === COMMANDO ver 2 ===
// Re-using existing output directory 'commando-dir'
// Type 'help' for supported commands
// [COMMANDO]&gt;&gt; ls
// [COMMANDO]&gt;&gt; exit
void Dprintf(const char* format, ...) {
  if(getenv("DEBUG") != NULL){
    va_list args;
    va_start (args, format);
    char fmt_buf[2048];
    snprintf(fmt_buf, 2048, "|DEBUG| %s", format);
    vfprintf(stderr, fmt_buf, args);
    va_end(args);
  }
}

// Sleep the running program for the given number of seconds allowing
// fractional values.
void pause_for(double secs){
  int isecs = (int) secs;
  double frac = secs - ((double) isecs);
  long inanos = (long) (frac * 1.0e9);

  struct timespec tm = {
    .tv_nsec = inanos,
    .tv_sec  = isecs,
  };
  nanosleep(&amp;tm,NULL);
}

// Splits `line` into tokens with pointers to each token stored in
// argv[] and argc_ptr set to the number of tokens found. This
// function is in the style of strtok() and destructively modifies
// `line`. A limited amount of "quoting" is supported to allow single-
// or double-quoted strings to be present. The function is useful for
// splitting lines into an argv[] / argc pair in preparation for an
// exec() call.  0 is returned on success while an error message is
// printed and 1 is returned if splitting fails due to problems with
// the string.
//
// EXAMPLES:
// char line[128] = "Hello world 'I feel good' today";
// char *set_argv[32];
// int set_argc;
// int ret = split_into_argv(line, set_argv, &amp;set_argc);
// // set_argc: 4
// // set_argv[0]: Hello
// // set_argv[1]: world
// // set_argv[2]: I feel good
// // set_argv[3]: today
// // set_argv[4]: &lt;NULL&gt;
int split_into_argv(char *line, char *argv[], int *argc_ptr){
  int argc = 0;
  int in_token = 0;
  for(int i=0; line[i]!='\0'; i++){
    if(!in_token &amp;&amp; isspace(line[i])){                 // skip spaces between tokens
      continue;
    }
    else if(in_token &amp;&amp; (line[i]=='\'' || line[i]=='\"')){
      printf("ERROR: No support for mid-token quote at index %d\n",i);
      return 1;
    }
    else if(line[i]=='\'' || line[i]=='\"'){           // begin quoted token
      char start_quote_char = line[i];
      i++;                                             // skip first quote char
      argv[argc++] = line+i;                           // start of token
      for(;line[i] != start_quote_char;i++){
        if(line[i] == '\0'){
          printf("ERROR: unterminated quote in &lt;%s&gt;\n",line);
          return 1;
        }
      }
      line[i] = '\0';                                  // end quoted token
    }
    else if(in_token &amp;&amp; !isspace(line[i])){            // still in a token, move ahead
      continue;
    }
    else if(!in_token &amp;&amp; !isspace(line[i])){           // begin unquoted token 
      in_token = 1;
      argv[argc++] = line+i;
    }
    else if(in_token &amp;&amp; isspace(line[i])){             // end unquoted token
      in_token = 0;
      line[i] = '\0';
    }
    else{
      printf("ERROR: internal parsing problem at string index %d\n",i);
      return 1;
    }
  }
  *argc_ptr = argc;
  argv[argc] = NULL;                                   // ensure NULL termination required by exec()
  return 0;
}

////////////////////////////////////////////////////////////////////////////////
// PROBLEM 1 Functions
////////////////////////////////////////////////////////////////////////////////

cmdctl_t *cmdctl_new(char *cmddir, int cmds_capacity);
// PROBLEM 1: Allocate a new cmdctl structure with the output
// directory `cmddir` and intitial `cmds_capacity` for its cmds[]
// array field.

void cmdctl_free(cmdctl_t *cmdctl);
// PROBLEM 1: De-allocate the given given cmdctl struct. Free all
// argv[] elements in each of the cmds[], free that array, then free
// the cmdctl struct itself.

int cmdctl_create_cmddir(cmdctl_t *cmdctl);
// PROBLEM 1: Creates the output directory names in cmdctl-&gt;cmddir. If
// cmddir does not exist, it is created as directory with permissions
// of User=read/write/execute then returns 1. If cmddir already exists
// and is a directory, prints the following message and returns 0:
//
//   Re-using existing output directory 'XXX'
//
// If a non-directory file named cmddir already exists, print an error
// message and return -1 to indicate the program cannot proceed. The
// error message is:
//
// ERROR: Could not create cmddir directory 'XXX'
//        Non-directory file with that name already exists
//
// with XXX substituted with the value of cmddir. 
//
// CONSTRAINT: This function must be implemented using low-level
// system calls. Use of high-level calls like system("cmd") will be
// reduced to 0 credit. Review system calls like stat() and mkdir()
// for use here. The access() system call may be used but keep in mind
// it does not distinguish between regular files and directories.

int cmdctl_add_cmd(cmdctl_t *cmdctl, char *cmdline);
// PROBLEM 1: Add a command to the cmdctl. If the capacity of the
// cmds[] array is insufficient, is size is doubled before adding
// using the realloc() function. 
//
//
// SETTING ARGV[] OF THE CMD 
//
// `cmdline` is the string typed in as a command. `cmdline` is
// separated into an argv[] array using the split_into_argv()
// function. All strings are duplicated into the argv[] array of the
// cmd_t and are later free()'d on memory de-allocation.  
//
// Example:
// cmdline: "data/sleep_print.sh 1 hello world"
// argv[]:
//   [ 0]: data/sleep_print.sh
//   [ 1]: 1
//   [ 2]: hello
//   [ 3]: world
//   [ 4]: NULL
//
// HANDLING INPUT REDIRECTION
//
// If the last two elements of the command line indicate input
// redirection via "&lt; infile.txt" then the argv[] and input_filename
// fields are set accordingly.  An example:
//
// cmdline: "wc -l -c &lt; Makefile"
// argv[]:
//   [ 0]: wc
//   [ 1]: -l
//   [ 2]: -c
//   [ 3]: NULL      NOTE "&lt;" and "Makefile" removed
// input_filename: Makefile
//
// SETTING OUTPUT FILENAME
//
// The output_filename field is set to a pattern like the following:
//
//     0017-data_sleep_print.sh.out
//     |     |                   +-&gt; suffix .out
//     |     +-&gt; argv[0] with any / characters replaced by _
//     +-&gt; 4 digit cmdid (index into cmds[] array), 0-padded
//
// A copy of the argv[0] string is modified to replace slashes with
// underscores and the sprintf() family of functions is used for
// formatting. (NOTE: not all
//
// SETTING OTHER FIELDS
//
// Other fields are set as follows:
// - argc to the length of the argv[] array
// - cmdstate to the CMDSTATE_INIT 
// - pid, exit_code, output bytes to -1
//
// The function returns 1 if the added command caused the internal
// array of commands to expand and 0 otherwise. 
// 
// CONSTRAINT: Do not use snprintf(), just plain sprintf(). Aim for
// simplicity and add safety at a later time.

void cmdctl_print_oneline(cmdctl_t *cmdctl, int cmdid);
// PROBLEM 1: Prints a oneline summary of the indicated command's
// current state. The format is:
//
// EXAMPLES:
//  A:5 B:1 C:-6    D:7     E:-15         F:remaining
// ------------------------------------------------------------
//    24 #007575       - RUNNING         data/sleep_print.sh
//   123 #007570      54 EXIT(0)         seq         
//     2 #007566      73 EXIT(1)         gcc         
//  2961 #007562      23 SIGNALLED(-15)  data/self_signal.sh
// ------------------------------------------------------------
// 123456789012345678901234567890123456789012345678901234567890
//
// - A: cmdid (index into the cmds[] array), 5 places, right aligned
// - B: # symbol
// - C: PID of command, 6 places 0 padded, left aligned
// - D: number of output bytes if not running, otherwise a "-", 7 places
//      right aligned
// - E: printed state with exit code/signal, 15 places, left aligned
// - F: argv[0] (command name), left aligned, printed for remainder of
//   line
//
// For E, the possible outputs are based on cmdstate_t values:
// - NOTSET
// - INIT
// - RUNNING
// - EXIT(&lt;num&gt;)      : positive number of normal exit
// - SIGNALLED(&lt;num&gt;) : negative number of signal
// - UNKNOWN_END
// - FAIL_INPUT
// - FAIL_OUTPUT
// - FAIL_EXEC
//
// NOTE: Most implementations will use a combination of printf() and
// possibly sprintf() to get the required widths. The trickiest part
// is getting the states EXIT() / SIGNALLED() aligned correctly for
// which an individual call to sprintf() to first format the numbers
// followed by a printf() with a width specifier is helpful.
//
// CONSTRAINT: Do not use snprintf(), just plain sprintf(). Aim for
// simplicity and add safety at a later time.

void cmdctl_print_all(cmdctl_t *cmdctl);
// PROBLEM 1: Prints a header and then iterates through all commands
// printing one-line summaries of them information on them. Prints a
// table header then repeatedly calls cmdctl_print_oneline(). Example:
//
// CMDID PID       BYTES STATE           COMMAND
//     0 #107561      22 SIGNALLED(-9)   data/self_signal.sh
//     1 #107562      23 SIGNALLED(-15)  data/self_signal.sh
//     2 #107566      73 EXIT(1)         gcc         
//     3 #107570      54 EXIT(0)         seq         
//     4 #107575       - RUNNING         data/sleep_print.sh

void cmdctl_print_info(cmdctl_t *cmdctl, int cmdid);
// PROBLEM 1: Prints detailed information about the given
// command. Example output is as follows.
//
// EXAMPLE 1: Exited command
// Call: cmdctl_print_info(cmdctl, 2);
// -------OUTPUT-------------
// CMD 2 INFORMATION
// command: seq 25
// argv[]:
//   [ 0]: seq
//   [ 1]: 25
// cmdstate: EXIT(0)
// input: &lt;NONE&gt;
// output: commando-dir/0002-seq.out
// output size: 66 bytes
// -------------------------
// 
// EXAMPLE 2: Running command
// Call: cmdctl_print_info(cmdctl, 4);
// -------OUTPUT-------------
// CMD 4 INFORMATION
// command: data/sleep_print.sh 25 hello world
// argv[]:
//   [ 0]: data/sleep_print.sh
//   [ 1]: 25
//   [ 2]: hello
//   [ 3]: world
// cmdstate: RUNNING
// input: &lt;NONE&gt;
// output: commando-dir/0004-data_sleep_print.sh.out
// output size: &lt;CMD NOT FINISHED&gt;
// -------------------------
//
// May have be some duplicate code in this function to that present in
// cmd_print_oneline() for handling the different cmdstate values.

void cmdctl_show_output(cmdctl_t *cmdctl, int cmdid);
// PROBLEM 1: If the given command is not finished (e.g. still
// RUNNING), prints the message
//
//   NO OUTPUT AVAILABLE: command has not finished running
//
// If the command is finished, opens the output file for the command
// and prints it to the screen using low-level UNIX I/O.
//
// CONSTRAINT: This routine must use low-level open() and read() calls
// and must allocate no more memory for the file contents than
// MAX_LINE bytes in a buffer. Use of fscanf(), fgetc(), and other C
// standard library functions is not permitted and scanning the
// entirety of the file into memory is also not permitted.

////////////////////////////////////////////////////////////////////////////////
// PROBLEM 2 Functions
////////////////////////////////////////////////////////////////////////////////

int cmdctl_start_cmd(cmdctl_t *cmdctl, int cmdid);
// PROBLEM 2: Start a child process that will run the indicated
// cmd. After creating the child process, the parent sets sets the
// `pid` field, changes the state to RUNNING and returns 0.
//
// The child sets up output redirection so that the standard out AND
// standard error streams for the child process is channeled into the
// file named in field `output_filename`. Note that standard out and
// standard error are "merged" so that they both go to the same
// `outfile_name`. This file should use the standard file
// creation/truncation options (O_WRONLY|O_CREAT|O_TRUNC) and be
// readable/writable by the user (S_IRUSR|S_IWUSR).
//
// If input_filename is not empty, input redirection is also set up
// with input coming from the file named in that field. Output
// redirection is set up first to allow any errors associated with
// input redirection to be captured in the output file for the
// command. 
//
// IMPORTANT: Any errors in the child during I/O redirection or
// exec()'ing print error messages and cause an immediate exit() with
// an associated error code. These are as follows:
//
// | CONDITION            | EXIT WITH CODE              | Message                                                                         |
// |----------------------+-----------------------------+---------------------------------------------------------------------------------|
// | Output redirect fail | exit(CMDSTATE_FAIL_OUTPUT); | No message printed                                                              |
// | Input redirect fail  | exit(CMDSTATE_FAIL_INPUT);  | ERROR: can't open file 'no-such-file.txt' for input : No such file or directory |
// | Exec failure         | exit(CMDSTATE_FAIL_EXEC);   | ERROR: program 'no-such-cmd' failed to exec : No such file or directory         |
//
// The "No such file..." message is obtained and printed via
// strerror(errno) which creates a string based on what caused a
// system call to fail.
//
// NOTE: When correctly implemented, this function should never return
// in the child process though the compiler may require a `return ??`
// at the end to match the int return type. NOT returning from this
// function in the child is important: if a child manages to return,
// there will now be two instances of main() running with the child
// starting its own series of grandchildren which will not end well...

int cmdctl_update_one(cmdctl_t *cmdctl, int cmdid, int finish);
// PROBLEM 2: Updates a single cmd to check for its completion. If the
// cmd is not RUNNING, returns 0 immediately.
//
// If the parameter `finish` is 0, uses wait()-family system calls to
// determine if the child process associated with the command is
// complete. If not returns 0 immediately - a NON-BLOCKING WAIT() is
// required to accomplish this.
//
// If the parameter `finish` is 1, uses a BLOCKING-style call to wait
// until the child process is actually finished before moving on.
//
// If the child process is finished, then diagnosis its exit status to
// determine a normal exit vs abnormal termination due to a
// signal. the W-MACROS() are used to determine this. The
// cmd-&gt;exit_code field is set to positive for a regular exit code or th
// negative signal number for an abnormal exit.
//
// The output_bytes is set by using a stat()-family call to determine
// the number of bytes in the associated output file.
//
// When the command finishes, an "ALERT" message is printed like the
// following which primarily uses the cmd_print_oneline() function.
//
// ---&gt; COMPLETE:     2 #108624    2617 EXIT(0)         ls
// ---&gt; COMPLETE:   129 #108725      22 SIGNALLED(-2)   data/self_signal.sh
// &lt;string shown&gt; &lt;----------output from cmd_print_oneline()----------------&gt;
//
// Returns 1 when the child process changes from RUNNING to a
// completed state.

int cmdctl_update_all(cmdctl_t *cmdctl, int finish);
// PROBLEM 2: Iterates through all commands and calls update on
// them. Passes the the `finish` parameter on to each call. Counts
// then number of commands that change state (from RUNNING to a
// finished state) and if 1 or more finish, prints a message like
//
//   4 commands finished
//
// after completing the loop. Returns the number of commands the that
// finished.

////////////////////////////////////////////////////////////////////////////////
// PROBLEM 3: Implement main() in commando_main.c
////////////////////////////////////////////////////////////////////////////////

int main(int argc, char *argv[]);
// Problem 3: main in command_main.c.
//
// * COMMAND LINE FORMS 
//
// The program must support four command line forms.
// | ./commando                        | argc=1 | No echo, default cmddir          |
// | ./commando --echo                 | argc=2 | Echoing on                       |
// | ./commando --dir &lt;dirname&gt;        | argc=3 | Set cmddir to argument           |
// | ./commando --echo --dir &lt;dirname&gt; | argc=4 | Echoing on and non-defaut cmddir |
//
// When the --echo option is provided, each line of input that is read
// in is first printed to the screen. This is makes testing easier.
//
// When the --dir &lt;dirname&gt; option is present, it sets the output
// directory used to store command output. If it is not present, the
// default cmddir name DEFAULT_CMDDIR is used; commando.h sets this to
// "command-dir".
//
// If a command line form above is not matched (arg 1 is not --echo,
// no &lt;dirname&gt; provided, 5 or more args given, etc.), then the
// following usage message should be printed:
//
//   usage: ./commando
//          ./commando --echo
//          ./commando --dir &lt;dirname&gt;
//          ./commando --echo --dir &lt;dirname&gt;
//   Incorrect command line invocation, use one of the above
//
//
// * INTERACTIVE LOOP
//
// After setting up a cmdctl struct, main() enters an interactive loop
// that allows users to use built-in and external commands.  Each
// iteration of the interactive loop prints a prompt then reads a line
// of text from users using the fgets() function. If echoing is
// enabled, the line read is immediately printed.
//
// A full line is read as it may contain many tokens that will become
// part of an external command to run.  The first "token" (word) on
// the line is extracted using a call to sscanf() and checked against
// the built-in commands below. If the word matches a known built-in,
// then the program honors it and iterates.
//
// If no built-in functionality matches, then the line is treated as
// an external command and run via a fork() / exec() regime from
// functions like cmdctl_add_cmd() and cmdctl_start_cmd().
//
// At the top of each interactive loop, all commands are updated via a
// call to cmdctl_update_all(...,0) which which will check to see if
// any commands have finished and print a message indicating as much
// before the prompt.
//
// Cautions on using fgets(): While useful, fgets() is a little tricky
// and implementer should look for a brief explanation of how it
// works. Keep in mind the following
// - It requires a buffer to read into; use one of size MAX_LINE
// - It will return NULL if the end of input has been reached
// - Any newlines in the input will appear in the buffer; use strlen()
//   to manually "chop" lines to replace the trailing \n with \0 when
//   processing the command
// - A handy invocation is something like
//     char firstok[...];
//     sscanf(inline, "%s", firstok);
//   which allows the first token (word) to be extracted from the
//   input line.  Other tokens can be similarly extracted using
//   sscanf(). 
//
// * STARTUP MESSAGES AND ERRORS
//
// When beginning, commando will print out the following:
//
//   === COMMANDO ver 2 ===
//   Re-using existing output directory 'commando-dir'
//   Type 'help' for supported commands
//   COMMANDO&gt;&gt;
//
// The last line is the prompt for input form the user.
//
// The first line indicates that there is already a directory present
// with output so old command output may get overwritten.  It is
// printed during cmdctl_create_cmddir().
//
// * BUILT-IN FUNCTIONALITY
//
// Typing 'help' will show a message about the built-in functionality.
//
// COMMANDO&gt;&gt; help
// help                       : show this message
// exit                       : exit the program
// directory                  : show the directory used for command output
// history                    : list all jobs that have been started giving information on each
// pause &lt;secs&gt;               : pause for the given number of seconds which may be fractional
// info &lt;cmdid&gt;               : show detailed information on a command
// show-output &lt;cmdid&gt;        : print the output for given command number
// finish &lt;cmdid&gt;             : wait until the given command finishes running
// finish-all                 : wait for all running commands to finish
// source &lt;filename&gt;          : (MAKEUP) open and read input from the given file as though it were typed
// command &lt;arg1&gt; &lt;arg2&gt; ...  : non-built-in is run as a command and logged in history
//
// These are all demonstrated in the project specification and
// generally encompass either an associated service function. The
// `source` built-in is optional for MAKEUP credit.

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgee79a72" class="outline-2">
<h2 id="orgee79a72"><span class="section-number-2">5</span> <b>Problem 1</b>: Basic Functionality</h2>
<div class="outline-text-2" id="text-5">
<p>
Functions in this problem are all in <code>commando_funcs.c</code> and are
designed to acquaint implementers with the basic data types in the
project along with providing some printing functionality.
</p>
</div>
<div id="outline-container-org8cd70fc" class="outline-3">
<h3 id="org8cd70fc"><span class="section-number-3">5.1</span> Implementation Notes</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Most Implementation Notes are provided in the <a href="#org68ed629">Outline of Code</a>. Here
are a few additional items to consider
</p>
</div>
<div id="outline-container-org0ed66a3" class="outline-4">
<h4 id="org0ed66a3">Use of <code>realloc()</code></h4>
<div class="outline-text-4" id="text-org0ed66a3">
<p>
Aside from <code>malloc() / calloc()</code>, the C standard library provides one
more useful memory allocation function called <code>realloc()</code>. A call to
it looks like the following.
</p>

<div class="org-src-container">
<pre class="src src-c">{
  int count = 10;
  data_t *ptr = malloc(sizeof(data_t)*count); // malloc()'d at some size
  ...;                                        // after a short time...
  count = count * 2;                          // need more space in the array
  data_t *old = ptr;                          // optionall save location
  ptr = realloc(ptr, sizeof(data_t)*count);   // allocate more space
  // ptr now refers to a larger area

  if(ptr == old){
    printf("Same location\n");  // expansion in place by extending a heap block
  }
  else{
    printf("New location!\n");  // data copied to new larger location and old
  }                             // now refers to a free()'d region
}  
</pre>
</div>
<p>
<code>realloc()</code> gets a larger heap area for heap-allocated data as
efficiently as possible.
</p>
<ul class="org-ul">
<li>It may be able to expand the data in place to the new size</li>
<li>It may have to move the data to a new location in which case the old
area will be de-allocated</li>
</ul>
<p>
The reasons for the two cases will be easier to understand once heap
implementation is discussed.
</p>
</div>
</div>
<div id="outline-container-orgc20d407" class="outline-4">
<h4 id="orgc20d407">Use of <code>sprintf()</code></h4>
<div class="outline-text-4" id="text-orgc20d407">
<p>
There are situations in which one wants to craft a string using
<code>printf()</code>-like formatting. For this <code>sprintf()</code> is useful: rather
than printing to the screen, it arranges characters in a string
(character array). A simple usage is:
</p>

<div class="org-src-container">
<pre class="src src-c">{
  int meaning = 42;
  char *speaker = "Deep Thought";
  char strbuf[128];
  sprintf(strbuf,"%s: The meaning of life is %d",speaker,meaning);
  // strbuf: "Deep Thought: The meaning of life is 42"
}
</pre>
</div>

<p>
<code>sprintf()</code> is a bit "dodgy" as it has the potential to overflow
buffers but in our beginner setting we are not overly concerned with
this. In the wild, opt for <code>snprintf()</code> which can prevent buffer
overflow but for this project *use <code>sprintf() and NOT snprintf()</code>.
</p>
</div>
</div>
</div>
<div id="outline-container-org41e6f39" class="outline-3 grading 30">
<h3 id="org41e6f39"><span class="section-number-3">5.2</span> Grading Criteria for Problem 1&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading">grading</span>&#xa0;<span class="30">30</span></span></h3>
<div class="outline-text-3" id="text-5-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Weight</th>
<th scope="col" class="org-left">Criteria</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">AUTOMATED TESTS via <code>make test-prob1</code></td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-left">Tests provide via <code>test_prob1.org</code> and <code>test_commando.c</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Runs all code under Valgrind to ensure that no memory errors are present.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">1 point per test passed</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">15</td>
<td class="org-left">MANUAL INSPECTION</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left"><a href="https://docs.google.com/document/d/1V6W1GBcL2cgOoiIeaz5V83U3BUbfK7wqYia71i0AeXQ/edit?usp=sharing">Code Style</a>: Functions adhere to <a href="https://docs.google.com/document/d/1V6W1GBcL2cgOoiIeaz5V83U3BUbfK7wqYia71i0AeXQ/edit?usp=sharing">CMSC 216 C Coding Style Guide</a> which dictates</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">reasonable indentation, commenting, consistency of curly usage, etc.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left"><code>cmdctl_new() / cmdctl_free()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Effort to initialize fields to default values when allocating</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear traversal of <code>cmds[]</code> array and all <code>argv[]</code> elements to free them</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left"><code>cmdctl_create_cmddir()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of the system call <code>mkdir()</code> to create the directory</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Checks for presence of an existing directory which is re-used</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Checks for existing non-directory file which is reported</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left"><code>cmdctl_add_cmd()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Code to detect the need to expand the <code>cmds[]</code> array and use of <code>realloc()</code> to do so</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of the <code>split_into_argv()</code> function to split up the provided command line</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Processing of the <code>argv[0]</code> element to replace all <code>/</code> characters with <code>_</code> characters</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Detection and processing of input redirection via <code>... &lt; file.txt</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">May use <code>sprintf()</code> but NOT <code>snprintf()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left"><code>cmdctl_print_oneline()</code> <code>cmdctl_print_all()</code> <code>cmdctl_print_info()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Handles cases for each of the <code>cmdsate</code> values like <code>RUNNING / EXIT / etc.</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">May use <code>sprintf()</code> but NOT <code>snprintf()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left"><code>cmdctl_show_output()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Uses low-level <code>open() / read()</code> calls for reading files</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Utilizes a buffer no larger than <code>MAX_LINE</code> bytes for input</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Demonstrates a clear input loop to read parts of the file, process it, then repeat</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-orgd416b44" class="outline-2">
<h2 id="orgd416b44"><span class="section-number-2">6</span> <b>Problem 2</b>: Starting and Finishing Commands</h2>
<div class="outline-text-2" id="text-6">
<p>
This problem implements functions to start, update, and finish
commands. There are only two but they are interesting in that they
utilize system calls we have studied.
</p>
</div>
<div id="outline-container-org282225f" class="outline-3">
<h3 id="org282225f"><span class="section-number-3">6.1</span> Implementation Notes</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-org3ecf92a" class="outline-4">
<h4 id="org3ecf92a">Printing System Call Errors</h4>
<div class="outline-text-4" id="text-org3ecf92a">
<p>
When system calls like <code>open() / fork() / etc.</code> fail, they set a
global variable which indicates the cause of an error. This can be
reported in several ways shown in the following examples.
</p>

<div class="org-src-container">
<pre class="src src-c">{
  char *filename = "myfile.txt";
  int ret = open(filename, O_RDONLY);
  if(ret == -1){
    printf("open() failed");
    // (A) fixed message, little information

    perror("open failed because"); 
    // (B) perror() appends a cause for the failure automatically

    fprintf(stderr, "open() on the file %s failed : %s\n",
            filename, strerror(errno));
    // (C) sterror(errno) returns a string which can be inserted into
    // a format string which conveys more information about the context
}
</pre>
</div>

<p>
Each of these is appropriate to some contexts but (C) is the most
flexible as it allows a string error message to be inserted at an
arbitrary location in other output.
</p>
</div>
</div>
<div id="outline-container-org6284d8e" class="outline-4">
<h4 id="org6284d8e">Starting Commands</h4>
<div class="outline-text-4" id="text-org6284d8e">
<p>
Starting child processes via <code>fork()</code> has been discussed and should be
used in <code>cmdctl_start_cmd()</code> function. Be cautious with this as errors
in such code can have strange effects.
</p>
<ul class="org-ul">
<li>Ensure there are cases where the parent and child process execute
differing code by checking the return value of <code>fork()</code></li>
<li>If the child encounters errors, make sure to <code>exit(code)</code> from it:
that is a standard C function that ends a process. This avoids the
child potentially returning from the function and creating a second
instance of <code>commando</code> running.</li>
<li>Utilize code patterns that have been studied in lecture and lab to
have the child process redirect output and exec() a new program to
change its identity</li>
</ul>
</div>
</div>
<div id="outline-container-orgd4b7bfe" class="outline-4">
<h4 id="orgd4b7bfe">Finish Commands</h4>
<div class="outline-text-4" id="text-orgd4b7bfe">
<p>
Commands are started "asynchronously" and checked for completion on
occasion.  Calls to the <code>cmdctl_update_one()</code> function allow for
flexible checking on the running command.
</p>
<ul class="org-ul">
<li>If called with <code>finish=0</code>, the command in question will simply be
"checked" and if it is not finished, the function returns
immediately</li>
<li>If called with <code>finish=1</code>, the calling process (parent) will block
until the command (child process) completes.</li>
</ul>
<p>
To get these effects, utilize options to the <code>waitpid()</code> system call
that adjust between Blocking/Nonblocking versions.
</p>

<p>
When a child finishes, its exit status is captured and used to
diagnose several special cases and update the main processes
<code>cmdctl_t</code> struct for the command.
</p>
</div>
</div>
</div>
<div id="outline-container-org179b42f" class="outline-3 grading 30">
<h3 id="org179b42f"><span class="section-number-3">6.2</span> Grading Criteria for Problem 2&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading">grading</span>&#xa0;<span class="30">30</span></span></h3>
<div class="outline-text-3" id="text-6-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Weight</th>
<th scope="col" class="org-left">Criteria</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">AUTOMATED TESTS via <code>make test-prob1</code></td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-left">Tests provide via <code>test_prob1.org</code> and <code>test_commando.c</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Runs all code under Valgrind to ensure that no memory errors are present.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">1 point per test passed</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">15</td>
<td class="org-left">MANUAL INSPECTION</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left"><a href="https://docs.google.com/document/d/1V6W1GBcL2cgOoiIeaz5V83U3BUbfK7wqYia71i0AeXQ/edit?usp=sharing">Code Style</a>: Functions adhere to <a href="https://docs.google.com/document/d/1V6W1GBcL2cgOoiIeaz5V83U3BUbfK7wqYia71i0AeXQ/edit?usp=sharing">CMSC 216 C Coding Style Guide</a> which dictates</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">reasonable indentation, commenting, consistency of curly usage, etc.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left"><code>cmdctl_start_cmd()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear cases for parent and child code that are distinguished by the return value of <code>fork()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Parent code returns quickly updating the command to RUNNING</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Child proceeds to set up the command to run</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Code to open an output file with the indicated options / permissions</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Code handle output redirection and optionally input redirection in indicated</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of an <code>exec()</code>-family function to alter the child process to run the command</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Error checking and exit on problems with I/O redirection or exec()-ing</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left"><code>cmdctl_update_one()</code> / <code>cmdctl_update_all()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Early checks of whether the command is still RUNNING with immediate return if not</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of <code>waitpid()</code> with appropriate options to affect either Blocking / Non-blocking updates</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Code to capture exit status of child process and inspect it for various cases</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of the <code>stat()</code> system call to obtain the size in bytes of the command output</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Alert message printed when the command is <code>--&gt; COMPLETE</code></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-org53d0951" class="outline-2">
<h2 id="org53d0951"><span class="section-number-2">7</span> <b>Problem 3</b>: Commando <code>main()</code></h2>
<div class="outline-text-2" id="text-7">
<p>
The <code>commando_main.c</code> file wraps a simple text user interface around
the functions from the previous problems. Implementers may add
utility/helper functions in <code>commando_mainc.c</code> or <code>commando_funcs.c</code>
if desired but these will not be directly tested and were not needed
in the reference implementation.
</p>

<p>
<b>NOTE ON PREVIOUS WORK:</b> The interactive loop that <code>main()</code> implements
is similar to that used in past assignments for this course (Lab02 and
Project 2 in particular). It will require input and command echoing so
a good starting point might be to start with those past solutions.
</p>
</div>
<div id="outline-container-org204dad3" class="outline-3">
<h3 id="org204dad3"><span class="section-number-3">7.1</span> Interactive Loop</h3>
<div class="outline-text-3" id="text-7-1">
<p>
After setup, the main input loop will likely have the following basic
structure.
</p>
<ol class="org-ol">
<li>At the beginning of each loop, update the state of all commands via
a call to <code>cmdctl_update_all()</code>. A single <code>cmdctl_t</code> struct is used
to track the history and status of all past and present commands.</li>
<li>Print the prompt <code>[COMMANDO]&gt;&gt;</code></li>
<li>Use a call to <code>fgets()</code> to read a whole line of text from the
user. The header has a <code>#define MAX_LINE ...</code> which specifies the
maximum length of lines what are supported and a character buffer
of that size should be used.</li>
<li>If no input remains (e.g. reach end of input), print <code>End of input</code>
and break out of the reading loop.</li>
<li>If echoing is enabled, Echo (print) the given input to the
screen. This is required to be compatible with the Automated Tests.</li>
<li>Use the <code>sscanf()</code> function to extract the 0th "token" from the
line (e.g. the first word on the line).  Study examples of how
<code>sscanf()</code> works to read input from a string rather than a file or
input but is otherwise similar to other <code>scanf()</code>-style functions.</li>
<li>Examine the 0th token for supported built-ins like <code>help</code>,
<code>history</code>, and so forth.  Use <code>strcmp()</code> to determine if any match
and make appropriate calls. This will be a long if/else-if chain of
statements similar to other interactive programs covered in the
course.</li>
<li>If a built-in is matched, potentially use additional <code>sscanf()</code>
calls to read more tokens from the string then execute behavior
associated with the built-in.</li>
<li>If no built-ins match, treat the line as a new command to run. Add
a new <code>cmd_t</code> to the <code>cmdctl_t</code> and start it running.</li>
</ol>
</div>
<div id="outline-container-orgb60e894" class="outline-4">
<h4 id="orgb60e894">Beginning of Loop Updates and Alerts</h4>
<div class="outline-text-4" id="text-orgb60e894">
<p>
At the end of each iteration of the main loop of <code>commando</code>, each
command should be checked for updates to its status.  This is done via
a calls to <code>cmdctl_update_all()</code>.  This call <b>should not block</b>: if
processes have not finished, <code>commando</code> should not wait for them. That
means the underlying calls to <code>waitpid()</code> should use the <code>WNOHANG</code>
option which causes <code>waitpid()</code> to return immediately if nothing has
happened with the child process.
</p>

<p>
If the call to <code>cmdctl_update_all()</code> detects a change it should print
an <b>Alert</b> message indicating the it has finished. If correctly
implemented, underlying calls like <code>cmdctl_update_one()</code> will already
print this message. If one or more commands finish, a message is also
printed about how many commands finished due to the call to
<code>cmdctl_update_all()</code> (also part of the specified behavior for this
function). This gives the effect that commands that take a while to
complete are reported as finished together. An example is below.
</p>

<div class="org-src-container">
<pre class="src src-sh">[COMMANDO]&gt;&gt; data/sleep_print.sh 2.5 Last     ## runs for a while
[COMMANDO]&gt;&gt; data/sleep_print.sh 1.0 First    ## runs a shorter time
[COMMANDO]&gt;&gt;                                  ## what a second then press enter
---&gt; COMPLETE:     2 #222530       5 EXIT(0)         data/sleep_print.sh
---&gt; COMPLETE:     3 #222535       6 EXIT(0)         data/sleep_print.sh
2 commands finished
[COMMANDO]&gt;&gt; ls data                          ## run a short command
[COMMANDO]&gt;&gt;                                  ## wait a second then press enter
---&gt; COMPLETE:     4 #222542     242 EXIT(0)         ls
1 commands finished
[COMMANDO]&gt;&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org6199a96" class="outline-4">
<h4 id="org6199a96"><code>fgets()</code> Usage</h4>
<div class="outline-text-4" id="text-org6199a96">
<p>
The basic usage of <code>fgets()</code> allows a whole line of text to be
retrieved. A simple invocation looks like this.
</p>
<div class="org-src-container">
<pre class="src src-c">#define CHAR_LIM
{
  FILE *infile = ...;           // might be stdin
  char inbuf[CHAR_LIM];

  char *ret = fgets(inbuf, CHAR_LIM, infile);

  if(ret == NULL){
    printf("Apparently no more input...\n");
  }
  else{
    // ret will point to inbuf so use either
    printf("inbuf is: '%s'\n", inbuf);
    int len = strlen(inbuf);
    printf("inbuf has %d chars\n",len);
    if(inbuf[len-1] == '\n'){
      inbuf[len-1] == '\0';        // "chop" the included newline
    }
    printf("inbuf without newline: '%s'\n",inbuf);
  }
}
</pre>
</div>
<p>
This resource has additional information and examples:
<a href="https://www.tutorialspoint.com/c_standard_library/c_function_fgets.htm">https://www.tutorialspoint.com/c_standard_library/c_function_fgets.htm</a>
</p>
</div>
</div>
<div id="outline-container-orge9d647b" class="outline-4">
<h4 id="orge9d647b"><code>sscanf()</code> Usage</h4>
<div class="outline-text-4" id="text-orge9d647b">
<p>
<code>sscanf()</code> is useful to parse off parts of a string into individual
tokens. Here is a simple invocation.
</p>

<div class="org-src-container">
<pre class="src src-c">{
  char input_string = "Two is 2 and Four is 4.0";
  char tok1[32];
  int tok3;
  int ret = sscanf(input_string, "%s %*s %d", tok1, &amp;tok3);
  // The * in %*s parses a token but does not store it so only 2
  // memory addresses are needed

  printf("tok1: %s\n",tok1);    // Two
  printf("tok3: %d\n",tok3);    // 2
}
</pre>
</div>
<p>
Additional examples and information are here:
<a href="https://www.tutorialspoint.com/c_standard_library/c_function_sscanf.htm">https://www.tutorialspoint.com/c_standard_library/c_function_sscanf.htm</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org9cbcdb3" class="outline-3">
<h3 id="org9cbcdb3"><span class="section-number-3">7.2</span> Startup, Basic Help, Exiting</h3>
<div class="outline-text-3" id="text-7-2">
<p>
On startup, a "heading" is printed to indicate that Commando is
running and a brief line is printed to indicate the presence of the
<code>help</code> built-in.  Users can exit by typing the <code>exit</code> command. Below
is a demo of these feature.
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; ./commando
=== COMMANDO ver 2 ===
Re-using existing output directory 'commando-dir'
Type 'help' for supported commands
[COMMANDO]&gt;&gt; help
help                       : show this message
exit                       : exit the program
directory                  : show the directory used for command output
history                    : list all jobs that have been started giving information on each
pause &lt;secs&gt;               : pause for the given number of seconds which may be fractional
info &lt;cmdid&gt;               : show detailed information on a command
show-output &lt;cmdid&gt;        : print the output for given command number
finish &lt;cmdid&gt;             : wait until the given command finishes running
finish-all                 : wait for all running commands to finish
source &lt;filename&gt;          : (MAKEUP) open and read input from the given file as though it were typed
command &lt;arg1&gt; &lt;arg2&gt; ...  : non-built-in is run as a command and logged in history
[COMMANDO]&gt;&gt; exit

&gt;&gt; 
</pre>
</div>

<p>
<b>Remember</b> on exiting to de-allocate memory, primarily the <code>cmdctl_t</code>
struct. 
</p>
</div>
</div>
<div id="outline-container-org577252f" class="outline-3">
<h3 id="org577252f"><span class="section-number-3">7.3</span> Command Line Forms and Usage</h3>
<div class="outline-text-3" id="text-7-3">
<p>
Commando supports 4 command line forms and if a user invokes the
program in any other way, the program should print a usage message
like below and <b>exit with code 1</b> to indicate the program did not run
correctly. 
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; ./commando abc               ## no option 'abc'
usage: ./commando
       ./commando --echo
       ./commando --dir &lt;dirname&gt;
       ./commando --echo --dir &lt;dirname&gt;
Incorrect command line invocation, use one of the above

&gt;&gt; ./commando --dir             ## missing &lt;dirname&gt; for option
usage: ./commando
       ./commando --echo
       ./commando --dir &lt;dirname&gt;
       ./commando --echo --dir &lt;dirname&gt;
Incorrect command line invocation, use one of the above

&gt;&gt; echo $?                      ## exit code 1 when usage is printed
1
</pre>
</div>
</div>
</div>
<div id="outline-container-org90fd5b0" class="outline-3">
<h3 id="org90fd5b0"><span class="section-number-3">7.4</span> Command Echoing</h3>
<div class="outline-text-3" id="text-7-4">
<p>
To make testing and scripting easier to understand, <code>commando</code> should
support <i>command echoing</i> which means to print back to the screen what
a user has typed in.  If the input source is coming from somewhere
else as is the case in testing, this allows the entered commands to be
seen in output.
</p>

<p>
On startup, <code>commando</code> should check for the <code>--echo</code> option and enable
echoing if present.  This is usually done by setting a variable
somewhere to 1 and then printing lines of input each time they are
read (or NOT printing them if the variable is 0). Refer to past
assignments that demonstrated models for how to do this.
</p>

<p>
Examples of echoing vs NOT echoing.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; ./commando                   ## NO echoing 
=== COMMANDO ver 2 ===
Type 'help' for supported commands
[COMMANDO]&gt;&gt; history            ## built-in entered
CMDID PID       BYTES STATE           COMMAND
[COMMANDO]&gt;&gt; directory          ## built-in entered
Output directory is 'commando-dir'
[COMMANDO]&gt;&gt; exit               ## built-in entered

&gt;&gt; ./commando --echo            ## ENABLE echoing
=== COMMANDO ver 2 ===
Type 'help' for supported commands
[COMMANDO]&gt;&gt; history            ## built-in entered
history                         ## and echoed
CMDID PID       BYTES STATE           COMMAND
[COMMANDO]&gt;&gt; directory          ## built-in entered
directory                       ## and echoed
Output directory is 'commando-dir'
[COMMANDO]&gt;&gt; exit               ## built-in entered
exit                            ## and echoed

&gt;&gt; 
</pre>
</div>
</div>
</div>
<div id="outline-container-org14bd0ee" class="outline-3">
<h3 id="org14bd0ee"><span class="section-number-3">7.5</span> Output Directory</h3>
<div class="outline-text-3" id="text-7-5">
<p>
Commando stores output from its commands in a directory. By default
this is <code>commando-dir</code> as defined in <code>commando.h</code>
</p>
<div class="org-src-container">
<pre class="src src-c">#define DEFAULT_CMDDIR "commando-dir" // default output directory for commands
</pre>
</div>
<p>
However, the directory can be changed at startup via the <code>--dir
&lt;dirname&gt;</code> option which will need to be taken from the command line
arguments to <code>commando</code>. A typical strategy is to have a local
variable set initially to the default but if <code>--dir</code> is present,
change the variable to the specified value.
</p>

<p>
Whatever the output directory is, it is used to initialize a
<code>cmdctl_t</code> which in turn uses it in <code>cmdctl_create_cmddir()</code>. That
function may create the directory, re-use it if existing, or report
and error which should cause commando to quit.
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; ./commando --dir special-dir        ## start with non-default directory 
=== COMMANDO ver 2 ===
Type 'help' for supported commands
[COMMANDO]&gt;&gt; exit

&gt;&gt; ./commando --dir special-dir        ## directory already exists
=== COMMANDO ver 2 ===
Re-using existing output directory 'special-dir'
Type 'help' for supported commands
[COMMANDO]&gt;&gt; exit

&gt;&gt; echo Dont overwrite me &gt; other-dir  ## create a file 

&gt;&gt; ./commando --dir other-dir          ## won't overwrite the existing file so quit
=== COMMANDO ver 2 ===
ERROR: Could not create cmd directory 'other-dir'
       Non-directory file with that name already exists
Unable to run without an output directory, exiting

&gt;&gt; 
</pre>
</div>
</div>
</div>
<div id="outline-container-org1375467" class="outline-3">
<h3 id="org1375467"><span class="section-number-3">7.6</span> Built-ins</h3>
<div class="outline-text-3" id="text-7-6">
<p>
Within the interactive loop for commando there are a number of
built-in commands. These are demonstrated here.
</p>
</div>
<div id="outline-container-org66dfd5b" class="outline-4">
<h4 id="org66dfd5b">Help, History, Directory, Exit</h4>
<div class="outline-text-4" id="text-org66dfd5b">
<p>
These are all fairly self-explanatory based on the output of the
<code>help</code> built-in and are shown below.
</p>

<div class="org-src-container">
<pre class="src src-sh">[COMMANDO]&gt;&gt; help                                           ## print help on builtins
help                       : show this message
exit                       : exit the program
directory                  : show the directory used for command output
history                    : list all jobs that have been started giving information on each
pause &lt;secs&gt;               : pause for the given number of seconds which may be fractional
info &lt;cmdid&gt;               : show detailed information on a command
show-output &lt;cmdid&gt;        : print the output for given command number
finish &lt;cmdid&gt;             : wait until the given command finishes running
finish-all                 : wait for all running commands to finish
source &lt;filename&gt;          : (MAKEUP) open and read input from the given file as though it were typed
command &lt;arg1&gt; &lt;arg2&gt; ...  : non-built-in is run as a command and logged in history

[COMMANDO]&gt;&gt; directory                                      ## print the directory used for command output
Output directory is 'commando-dir'                          ## this is the default value

[COMMANDO]&gt;&gt; exit                                           ## all done for now

&gt;&gt;                                                          ## back to a "real" shell
</pre>
</div>
</div>
</div>
<div id="outline-container-org7950218" class="outline-4">
<h4 id="org7950218">History, Info, Output</h4>
<div class="outline-text-4" id="text-org7950218">
<p>
The history of all past and present commands is tracked and can be
reported via <code>history</code> which relies on <code>cmdctl_print_all()</code>.
</p>

<p>
The <code>info</code> built-in utilizes <code>cmdctl_print_info()</code>. Note that a
command index must be provided and using <code>sscanf()</code> to get the index
from the input line is recommended.
</p>

<p>
The <code>show-output</code> built-in retrieves output from the file associated
with the command and displays it on screen using the
<code>cmdctl_show_output()</code> function.
</p>

<div class="org-src-container">
<pre class="src src-sh">[COMMANDO]&gt;&gt; history            ## show current history
CMDID PID       BYTES STATE           COMMAND
    0 #222616     125 EXIT(0)         cat
    1 #222643    1097 EXIT(0)         ls
    2 #222659      95 FAIL_EXEC       data/sleep_print
    3 #222666       - RUNNING         data/sleep_print.sh   
    4 #222677      23 EXIT(0)         wc

[COMMANDO]&gt;&gt; info 4             ## information on 4th command
CMD 4 INFORMATION
command: wc -l data/gettysburg.txt 
argv[]:
  [ 0]: wc
  [ 1]: -l
  [ 2]: data/gettysburg.txt
cmdstate: EXIT(0)
input: &lt;NONE&gt;
output: commando-dir/0004-wc.out
output size: 23 bytes

[COMMANDO]&gt;&gt; show-output 4      ## output for 4th command
28 data/gettysburg.txt
</pre>
</div>
</div>
</div>
<div id="outline-container-org8ada2ae" class="outline-4">
<h4 id="org8ada2ae">Finishing Commands</h4>
<div class="outline-text-4" id="text-org8ada2ae">
<p>
All commands are launched asynchronously (background / child process /
non-blocking / various other jargon).  The <code>finish &lt;cmdid&gt;</code> built-in
allows a user to block Commando until a command completes. It
utilizes <code>cmdctl_update_one()</code> with appropriate options to accomplish
this. Likewise, the built-in <code>finish-all</code> will use
<code>cmdctl_update_all()</code> with appropriate options to complete all
unfinished commands.
</p>

<div class="org-src-container">
<pre class="src src-sh">[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 D                      ## 9th command runs a long time

[COMMANDO]&gt;&gt; data/sleep_print.sh 1.0 D                      ## short run

[COMMANDO]&gt;&gt; data/sleep_print.sh 1.0 D                      ## short run

[COMMANDO]&gt;&gt; finish 9                                       ## block until 9th command finishes
---&gt; COMPLETE:     9 #222765       2 EXIT(0)         data/sleep_print.sh   ## 9th command done
---&gt; COMPLETE:    10 #222770       2 EXIT(0)         data/sleep_print.sh   ## top-of-loop update shows
---&gt; COMPLETE:    11 #222777       2 EXIT(0)         data/sleep_print.sh   ## short run command also done
2 commands finished                                                        ## only 2 as 1st is an explicit finish

[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 X                      ## start several long-running commands

[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 X

[COMMANDO]&gt;&gt; data/sleep_print.sh 5.0 X

[COMMANDO]&gt;&gt; finish-all                                     ## wait for all to fininsh
---&gt; COMPLETE:    12 #222793       2 EXIT(0)         data/sleep_print.sh
---&gt; COMPLETE:    13 #222798       2 EXIT(0)         data/sleep_print.sh
---&gt; COMPLETE:    14 #222801       2 EXIT(0)         data/sleep_print.sh
3 commands finished
</pre>
</div>
</div>
</div>
<div id="outline-container-org9380bf4" class="outline-4">
<h4 id="org9380bf4">Pausing</h4>
<div class="outline-text-4" id="text-org9380bf4">
<p>
It is useful in testing to be able to have <code>commando</code> simply do
nothing for a short time, accomplished with the <code>pause &lt;secs&gt;</code>
built-in which utilizes the provided <code>pause_for()</code> function. 
</p>

<p>
<b>Note that the &lt;secs&gt; token is a floating point number</b> so may be
fractional (see examples below). Use a call to <code>sscanf()</code> to easily
parse this parameter.
</p>

<p>
After the pause, the standard check of all child processes for state
changes should occur which can cause some processes to print that they
are done as shown in the following example.
</p>

<div class="org-src-container">
<pre class="src src-sh">[COMMANDO]&gt;&gt; pause 0.25         ## pause a quarter second
Pausing for 0.250000 seconds

[COMMANDO]&gt;&gt; pause 5.5          ## pause commando for 5.5 seconds
Pausing for 5.500000 seconds
---&gt; COMPLETE:     6 #222705       2 EXIT(0)         data/sleep_print.sh
---&gt; COMPLETE:     7 #222710       2 EXIT(0)         data/sleep_print.sh
---&gt; COMPLETE:     8 #222716       2 EXIT(0)         data/sleep_print.sh
3 commands finished             ## after the pause, several commands finished and are reported

[COMMANDO]&gt;&gt; 
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb80b951" class="outline-3">
<h3 id="orgb80b951"><span class="section-number-3">7.7</span> Running Commands</h3>
<div class="outline-text-3" id="text-7-7">
<p>
On inspecting the 0th token of an input line and finding that it does
not match any of the built-ins for Commando, the line is interpreted
as a Command: an external program to be run as a child process. The
command is added to the history via <code>cmdctl_add_cmd()</code> and then
started running.
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; ./commando
=== COMMANDO ver 2 ===
Re-using existing output directory 'commando-dir'
Type 'help' for supported commands

[COMMANDO]&gt;&gt; ls data

[COMMANDO]&gt;&gt; gcc --version
---&gt; COMPLETE:     0 #237938     242 EXIT(0)         ls
1 commands finished

[COMMANDO]&gt;&gt; data/table.sh
---&gt; COMPLETE:     1 #237941     228 EXIT(0)         gcc
1 commands finished

[COMMANDO]&gt;&gt; 
---&gt; COMPLETE:     2 #237947    1140 EXIT(0)         data/table.sh
1 commands finished

[COMMANDO]&gt;&gt; data/self_signal.sh 9

[COMMANDO]&gt;&gt; 
---&gt; COMPLETE:     3 #237957      22 SIGNALLED(-9)   data/self_signal.sh
1 commands finished
[COMMANDO]&gt;&gt; history
CMDID PID       BYTES STATE           COMMAND
    0 #237938     242 EXIT(0)         ls
    1 #237941     228 EXIT(0)         gcc
    2 #237947    1140 EXIT(0)         data/table.sh
    3 #237957      22 SIGNALLED(-9)   data/self_signal.sh

[COMMANDO]&gt;&gt; 
</pre>
</div>
</div>
</div>
<div id="outline-container-org00e38d2" class="outline-3 grading 40">
<h3 id="org00e38d2"><span class="section-number-3">7.8</span> Grading Criteria for Problem 2&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading">grading</span>&#xa0;<span class="40">40</span></span></h3>
<div class="outline-text-3" id="text-7-8">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Weight</th>
<th scope="col" class="org-left">Criteria</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">AUTOMATED TESTS via <code>make test-prob1</code></td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-left">Tests provide via <code>test_prob1.org</code> and <code>test_commando.c</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Runs all code under Valgrind to ensure that no memory errors are present.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">1 point per test passed</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">25</td>
<td class="org-left">MANUAL INSPECTION</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left"><a href="https://docs.google.com/document/d/1V6W1GBcL2cgOoiIeaz5V83U3BUbfK7wqYia71i0AeXQ/edit?usp=sharing">Code Style</a>: Functions adhere to <a href="https://docs.google.com/document/d/1V6W1GBcL2cgOoiIeaz5V83U3BUbfK7wqYia71i0AeXQ/edit?usp=sharing">CMSC 216 C Coding Style Guide</a> which dictates</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">reasonable indentation, commenting, consistency of curly usage, etc.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Handling of command line arguments to enable echoing, change output directory</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Use of <code>fgets() / sscanf()</code> to get input process the 0th token, obtain additional tokens for some built-ins</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Clear conditional structure to check for built-ins like <code>help, pause, finish, ...</code></td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Compact handling of built-in cases that leverage functions from <code>commando_funcs.c</code>; no duplicate code</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Handling of end of input (not just <code>exit</code>) to break from the interactive loop</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Cases and code to address each of the 10 built-in / command forms</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-orgdcc2028" class="outline-2">
<h2 id="orgdcc2028"><span class="section-number-2">8</span> <b>MAKEUP Problem</b></h2>
<div class="outline-text-2" id="text-8">
<p>
For MAKEUP Credit, students may implement some optional
functionality. Information on this will be added after the initial
release of the project. 
</p>
</div>
</div>
<div id="outline-container-org2c878be" class="outline-2">
<h2 id="org2c878be"><span class="section-number-2">9</span> Project Submission</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-orgddfe246" class="outline-3">
<h3 id="orgddfe246"><span class="section-number-3">9.1</span> <a id="orga047229"></a> Submit to Gradescope</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Refer to the Project 1 instructions and adapt them for details of how
to submit to Gradescope. In summary they are
</p>

<ol class="org-ol">
<li>Type <code>make zip</code> in the project directory to create <code>p4-complete.zip</code></li>
<li>Log into <a href="https://www.gradescope.com/">Gradescope</a>, select Project 4, and upload <code>p4-complete.zip</code></li>
</ol>
</div>
</div>
<div id="outline-container-orgef7b55a" class="outline-3">
<h3 id="orgef7b55a"><span class="section-number-3">9.2</span> Late Policies</h3>
<div class="outline-text-3" id="text-9-2">
<p>
You may wish to review the policy on late project submission which
will cost 1 Engagement Point per day late. <b>No projects will be
accepted more than 48 hours after the deadline.</b>
</p>

<p>
<a href="https://www.cs.umd.edu/~profk/216/syllabus.html#late-submission">https://www.cs.umd.edu/~profk/216/syllabus.html#late-submission</a>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/> <i> <a href="https://www.umd.edu/web-accessibility" title="UMD Web Accessibility">Web Accessibility</a> <br/> Author: Chris Kauffman (<a href="mailto:profk@umd.edu">profk@umd.edu</a>) <br/> Date: 2025-04-25 Fri 19:15 <br/> </i>
</div>
</body>
</html>
