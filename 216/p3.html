<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-03-24 Mon 16:10 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CMSC216 Project 3: Assembly Coding and Debugging</title>
<meta name="author" content="Chris Kauffman" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1" />
<style type="text/css">
@media screen {
:root {
--heading-bg-color:#e21833;
--heading-fg-color:#ffd200;
}
html {
font-family: serif;
text-align: justify;
}
pre.src, pre.example {
overflow-x: scroll;
}
/* Merge subtitle area with title area */
.subtitle {
text-align: center;
margin-top: -2em;
padding-top: 1em;
padding-bottom: 0.1em;
}
.title, .subtitle {
color: var(--heading-fg-color);
background-color: var(--heading-bg-color);
}
/* Section borders, left section header style */
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
blockquote {
font-style: italic;
}
td, th {
padding-top: 2px;
padding-bottom: 2px;
}
body {
background-color: #EEE;
}
pre {
}
#content, #preamble, #postamble {
margin-left:300px;
max-width: 100%;
}
.tag {
background-color: inherit; font-family: inherit;
padding: inherit; font-size: 80%; font-weight: inherit;
text-transform: uppercase;
}

.figure p { text-align: inherit; }
figure-number { font-style: italic; }
#table-of-contents {
text-align: left;
position: fixed;
left: 0;
margin: 0 auto;
padding: 0;
width: 300px;
top: 0;
height: 100%;
border: 0;
display: block;
}
#text-table-of-contents {
overflow-y: scroll;
height: 100%;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
#table-of-contents > h2 {
padding: 0.1em;
margin: 0;
}
/* adjustments for small screen, toc at top only */
@media (max-width: 800px) { /* landscape for iphone */
html {
-webkit-text-size-adjust: none;  /* prevent scaling of text on mobile */
}
body {
background-color: #EEE;
width:100%;
margin:0 auto;
}
#content, #preamble, #postamble {
margin-left:0;
}
#table-of-contents {
position: static;
left: inherit;
width:inherit;
height: auto;
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
border: 0.75em solid #006633;
}
div.outline-2, #table-of-contents {
background-color: rgb(250,250,250);
border: 0.75em solid var(--heading-bg-color);
border-top: 0em;
padding: 0em .5em .5em .5em; /* top right bottom left */
margin: 1em 0em 1em 0em; /* top right bottom left */
}
div.outline-2 > h2, #table-of-contents > h2 {
background-color: var(--heading-bg-color);
color: var(--heading-fg-color);
font-variant: small-caps;
padding: 0em 0em 0em .5em; /* top right bottom left */
margin: 0em -.5em 0em -.75em; /* top right bottom left */
text-align: left;
}
#text-table-of-contents {
overflow-y: visible;
height: inherit;
}
#text-table-of-contents ul {
padding-left: 1em;
margin-left: 0.5em;
}
}
.linenr { font-size: xx-small; }
th.org-left   { text-align: left;   }
}

@media print {
html {
font-family: serif;
font-size: 10pt;
text-align: justify;
.linenr { font-size: xx-small; }
}
}
</style>
<style>
/* Theme: Srcery
Description: Srcery dark color scheme for highlight.js
Author: Chen Bin <chen.bin@gmail.com>
Maintainer: @redguardtoo
Website: https://srcery-colors.github.io/
Date: 2021-04-13
https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/srcery.css

Tailored by: Chris Kauffman <profk@umd.edu>
Date: Sat Nov 25 06:16:20 PM EST 2023
*/
pre code.hljs {
display: block;
overflow-x: auto;
padding: 1em
}
code.hljs {
padding: 3px 5px
}
.hljs {
background: #1C1B19;
/* Black */
color: #FFFFFF/* Bright White */

}
/* Bright White */
.hljs-subst,
.hljs-quote,
.hljs-literal {
color: #FCE8C3
}
/* Bright Blue */
.hljs-type,
.hljs-symbol {
color: #68A8E4
}
/* Red */
.hljs-keyword,
.hljs-deletion {
color: #EF2F27
}
/* Yellow */
.hljs-name,
.hljs-function,
.hljs-attribute,
.hljs-selector-attr,
.hljs-selector-id,
.hljs-selector-class,
.hljs-selector-pseudo,
.hljs-section,
.hljs-title {
color: #FBB829
}
/* Cyan */
.hljs-code,
.hljs-variable,
.hljs-property,
.hljs-template-variable,
.hljs-class {
color: #0AAEB3
}
/* Bright Green */
.hljs-string,
.hljs-regexp,
.hljs-bullet,
.hljs-addition {
color: #98BC37
}
/* Bright Magenta */
.hljs-built_in,
.hljs-params {
color: #FF5C8F
}
/* Blue */
.hljs-template-tag,
.hljs-selector-tag {
color: #2C78BF
}
/* Bright Black */
.hljs-link,
.hljs-number,
.hljs-comment,
.hljs-meta {
color: #B1B195
/* color: #918175 */
}
.hljs-emphasis {
font-style: italic
}
.hljs-strong {
font-weight: bold
}
/* @see https://github.com/srcery-colors/srcery-emacs for reference */
</style>

<link rel="stylesheet" href="./srcery-ck.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
function interactive_lang() {      // define a custom "interactive" language
return {
name: 'interactive',           // language name
keywords: {
$pattern: /[^ \t\n]+/,       // lex based on non-whitespace
keyword: [">>","(shellac)","HM>","TM>","HS>","homeputer>","grace3:","grace4:","grace5:","grace6:","grace7:","grace8:","grace9:","grace10:","grace3>>","grace4>>","grace5>>","grace6>>","grace7>>","grace8>>","grace9>>","grace10>>"], // allowed interactive prompts
},
contains: [
// hljs.HASH_COMMENT_MODE,   // use standard hash comments, any # is a comment
hljs.COMMENT(/#+ /, /$/),    // use custom comment of # w/ whitespace
hljs.COMMENT(/#+/, /$/),     // and a sequence of hashes
]
};
};
hljs.registerLanguage('interactive', interactive_lang);     // register custom language

// Add highlighjs CSS classes to elemens marked with relevant org classes
lang_map = new Map();              // map of org to hljs languages
lang_map.set("src-c"     , "language-c");
lang_map.set("src-python", "language-python");
lang_map.set("src-text"  , "language-plaintext");
lang_map.set("src-sh"    , "language-interactive");
function add_class(el) {           // applied to each pre.src element
for (let [org_lang, hljs_lang] of lang_map) {
if(el.classList.contains(org_lang)){
el.classList.add(hljs_lang);
}
}
}
// visit all pre.src elements and apply function to add language class
document.querySelectorAll('pre.src').forEach(add_class);
hljs.configure({cssSelector: 'pre'}); // select pre blocks only to highligh
hljs.highlightAll();                  // perform highlighting on all pre blocks
});
</script>
</head>
<body>
<div id="preamble" class="status">
<i>Last Updated: 2025-03-24 Mon 16:10</i>
</div>
<div id="content" class="content">
<h1 class="title">CMSC216 Project 3: Assembly Coding and Debugging</h1>
<ul class="org-ul">
<li><b>Due: 11:59pm Mon 07-Apr-2025</b> on <a href="https://www.gradescope.com/">Gradescope</a></li>
<li><i>Approximately 4.0% of total grade</i></li>
<li>Projects are <b>individual work</b>: no collaboration with other students
is allowed. Seek help from course staff if you get stuck for too long.</li>
</ul>
<div id="outline-container-org4c80e30" class="outline-4">
<h4 id="org4c80e30">CODE/TEST DISTRIBUTION: <a href="p3-code.zip">p3-code.zip</a></h4>
</div>
<div id="outline-container-org8911159" class="outline-4">
<h4 id="org8911159">VIDEO OVERVIEW: <i>Note Yet Available</i></h4>
</div>
<div id="outline-container-org1271c5a" class="outline-4">
<h4 id="org1271c5a">CHANGELOG:</h4>
<div class="outline-text-4" id="text-org1271c5a">
<dl class="org-dl">
<dt>Mon Mar 24 12:07:57 PM EDT 2025</dt><dd><p>
An overview video of P3 is posted
here: <a href="https://youtu.be/hYfNlBWObt0">https://youtu.be/hYfNlBWObt0</a>
</p>

<p>
Several typos have been corrected in the project spec and associated
data in the current code pack.  If you've already downloaded the
codepack, running <code>make update</code> will get corrected versions of
these.
</p></dd>

<dt>Mon Mar 24 08:23:16 AM EDT 2025</dt><dd><a href="https://piazza.com/class/m69s0i6labk3eb/post/612">Post 612</a> reported typos in the
template for <code>scale_update_asm.s</code> which might lead to the error
<code>undefined reference to ...</code> when compiling. The typo in the
template has been corrected.</dd>
</dl>
</div>
</div>
<div id="outline-container-orgcfeed9f" class="outline-4">
<h4 id="orgcfeed9f"></h4>
<div class="outline-text-4" id="text-orgcfeed9f">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org6e8b74c">1. Introduction</a></li>
<li><a href="#org4c72ab3">2. Download Code and Setup</a></li>
<li><a href="#org12a6552">3. <b>Problem 1</b>: Scale Assembly Functions</a>
<ul>
<li><a href="#org6010e66">3.1. Hand-Code Your Assembly</a></li>
<li><a href="#org9b82341">3.2. General Cautions and Assembly Hints</a></li>
<li><a href="#org780d2a3">3.3. Register Summary Diagram</a></li>
<li><a href="#org19db8b4">3.4. Structure of <code>scale_update_asm.s</code></a></li>
<li><a href="#orgedb0b5a">3.5. Documentation Of Functions</a></li>
<li><a href="#org95b055b">3.6. Accessing Struct Fields in Assembly</a></li>
<li><a href="#org41033ff">3.7. Grading Criteria for Problem 1</a></li>
</ul>
</li>
<li><a href="#org1c4949b">4. <b>Problem 2</b>: Puzzlebin</a>
<ul>
<li><a href="#org23b152b">4.1. Overview</a></li>
<li><a href="#orgea6b1fe">4.2. Permission Denied Errors</a></li>
<li><a href="#org611779c">4.3. Puzzlebin Scoring</a></li>
<li><a href="#orgf8465cc">4.4. Advice and Hints</a></li>
<li><a href="#org58be2c0">4.5. Compatibility</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-org6e8b74c" class="outline-2">
<h2 id="org6e8b74c"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This project will feel somewhat familiar in that it is nearly
identical to the preceding project: there is a coding problem and a
puzzle-solving problem.  The major change is that everything is at the
assembly level:
</p>
<ul class="org-ul">
<li>Problem 1 re-works the Scale functions from the previous project in
x86-64 Assembly rather than C</li>
<li>Problem 2 involves analyzing a binary executable to provide it with
the correct input to "defuse" the executable much like the previous
project's Puzzlebox problem</li>
</ul>

<p>
Working with assembly will get you a much more acquainted with the
low-level details of the x86-64 platform and give you a greater
appreciation for "high-level" languages (like C).
</p>
</div>
</div>
<div id="outline-container-org4c72ab3" class="outline-2">
<h2 id="org4c72ab3"><span class="section-number-2">2</span> <a id="org2338006"></a> Download Code and Setup</h2>
<div class="outline-text-2" id="text-2">
<p>
Download the code pack linked at the top of the page. Unzip this which
will create a project folder. Create new files in this
folder. Ultimately you will re-zip this folder to submit it.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">File</th>
<th scope="col" class="org-left">State</th>
<th scope="col" class="org-left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>scale.h</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 header file</td>
</tr>

<tr>
<td class="org-left"><code>scale_main.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 main() function</td>
</tr>

<tr>
<td class="org-left"><code>scale_sim.c</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 1 scale simulator functions</td>
</tr>

<tr>
<td class="org-left"><code>scale_update_asm.s</code></td>
<td class="org-left">CREATE</td>
<td class="org-left">Problem 1 Assembly functions, re-code C in x86-64, <b>main source file for Problem 1</b></td>
</tr>

<tr>
<td class="org-left"><code>scale_update.c</code></td>
<td class="org-left">OPTIONAL</td>
<td class="org-left">Problem 1 C functions, COPY from Project 2 or see a staff member to discuss</td>
</tr>

<tr>
<td class="org-left"><code>test_scale_update.c</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Problem 1 testing program for <code>scale_update_asm.c</code></td>
</tr>

<tr>
<td class="org-left"><code>test_scale_update_asm.s</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Problem 1 testing program for <code>scale_update_asm.c</code></td>
</tr>

<tr>
<td class="org-left"><code>test_scale.org</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Problem 1 testing data file</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>puzzlebin</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Problem 2 Executable for debugging</td>
</tr>

<tr>
<td class="org-left"><code>input.txt</code></td>
<td class="org-left">EDIT</td>
<td class="org-left">Problem 2 Input for <code>puzzlebox</code>, fill this in</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>Makefile</code></td>
<td class="org-left">Provided</td>
<td class="org-left">Build file</td>
</tr>

<tr>
<td class="org-left"><code>testy</code></td>
<td class="org-left">Testing</td>
<td class="org-left">Test running script</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org12a6552" class="outline-2">
<h2 id="org12a6552"><span class="section-number-2">3</span> <b>Problem 1</b>: Scale Assembly Functions</h2>
<div class="outline-text-2" id="text-3">
<p>
The functions in this problem are identical to a previous project
in which code to support an LCD clock display was written. These
functions are:
</p>
<dl class="org-dl">
<dt><code>int scale_from_ports(scale_t *scale)</code></dt><dd>Retrieves values from ports (global variables) and fills the fields
of a <code>scale</code> with values indicating a weight to display along with
a mode and indicators for the display</dd>
<dt><code>int scale_display_special(scale_t scale, int *display)</code></dt><dd>Create a "special" pattern in the LCD display indicating an error or
storing the tare value.  The <code>mode</code> field of parameter <code>scale</code>
indicates which case to do.</dd>
<dt><code>int scale_display_weight(scale_t scale, int *display)</code></dt><dd>Show a "normal"  weight in the LCD display according to the data in
<code>scale</code>. Construct a bit pattern <code>display</code> that shows the weight
along with other indicators for unit / non-zero tare.</dd>
<dt><code>int scale_update()</code></dt><dd>Update global <code>SCALE_DISPLAY_PORT</code> using the
previous functions.</dd>
</dl>

<p>
The big change in this iteration will be that <b>the functions must be
written in x86-64 assembly code</b>. As C functions each of these is
short, 40 lines long in most cases and usually shorter. The assembly
versions will be somewhat longer as each C line typically needs 1-4
lines of assembly code to implement fully. Coding these functions in
assembly give you real experience writing working assembly code and
working with it in combination with C.
</p>

<p>
<b>The code setup and tests are mostly identical</b> for this problem as
for the previous C version of the problem.  <a href="p2.html">Refer to original Scale
Problem description</a> for a broad overview of the simulator and files
associated with it.
</p>
</div>
<div id="outline-container-org6010e66" class="outline-3">
<h3 id="org6010e66"><span class="section-number-3">3.1</span> Hand-Code Your Assembly</h3>
<div class="outline-text-3" id="text-3-1">
<p>
As discussed in class, one can generate assembly code from C code with
appropriate compiler flags. This can be useful for getting oriented
and as a beginning to the code your assembly versions of the
functions.  However, this exercise is about writing assembly yourself
to gain a deeper understanding of it.
</p>

<p>
<b>Code that is clearly compiler-generated with no hand coding will
receive 0 credit</b>.
</p>
<ul class="org-ul">
<li>No credit will be given on manual inspection</li>
<li>Penalties will be assessed for Automated Tests which lower credit to 0</li>
</ul>
<p>
Do not let that dissuade you from looking at compiler-generated
assembly code from you C solution to the functions.  Make sure that
you take the following steps which are part of the manual inspection
criteria.
</p>
</div>
<div id="outline-container-orgc1ba9e6" class="outline-4">
<h4 id="orgc1ba9e6">Base your Assembly code on your C code</h4>
<div class="outline-text-4" id="text-orgc1ba9e6">
<p>
The files to be submitted for this problem include
</p>
<ul class="org-ul">
<li><code>scale_update.c</code>: C version of the functions</li>
<li><code>scale_update_asm.s</code>: Assembly version of the functions</li>
</ul>
<p>
Graders may examine these for a correspondence between to the
algorithm used in the C version to the Assembly version.  This is not
a "hard" requirement in that folks who decide on a different approach
in their assembly compared to their C version will not be
penalized. However, it is an excellent idea to have a tight roadmap in
C before attempting the assembly version.  Compiler generated assembly
often does significant re-arrangements of assembly code with many
intermediate labels that hand-written code will not have which makes
it easy to spot folks who are cutting corners.
</p>

<p>
<b>If you were not able to complete the C functions for the Project 2 or
were not confident in your solutions,</b> <b>see a course staff member who
will help you get them up and running quickly.</b>
</p>
</div>
</div>
<div id="outline-container-orgdb00559" class="outline-4">
<h4 id="orgdb00559">Annotate your Assembly Thoroughly</h4>
<div class="outline-text-4" id="text-orgdb00559">
<p>
Comment your assembly code A LOT. While good C code can be quite
self-explanatory with descriptive variable names and clear control
structures, assembly is rarely so easy to understand. Include clear
commentary on your assembly. This should include:
</p>
<ul class="org-ul">
<li>Subdividing functions into smaller blocks with comments describing
what the blocks accomplish.</li>
<li>Descriptions of which "variables" or data are held in which
registers.</li>
<li>Descriptions of most assembly lines and their effect on the data
held in the registers.</li>
<li>Descriptions of any data such as bitmasks stored in the assembly
code.</li>
<li>Using informative label names like <code>.ROUNDING_UP</code> to convey further
meaning about what goals certain positions in code are
accomplishing.</li>
</ul>
</div>
</div>
<div id="outline-container-org5a6577e" class="outline-4">
<h4 id="org5a6577e">Use Division</h4>
<div class="outline-text-4" id="text-org5a6577e">
<p>
While it is a slow instruction that is cumbersome to set up, using
<code>idivX</code> division instruction is the most human-readable means to
compute several results needed in the required functions. Compiler
generated code uses many tricks to avoid integer division so a lack of
<code>idivX</code> instructions along this line will be a clear sign little
effort has been put into the assembly code.
</p>
</div>
</div>
</div>
<div id="outline-container-org9b82341" class="outline-3">
<h3 id="org9b82341"><span class="section-number-3">3.2</span> General Cautions and Assembly Hints</h3>
<div class="outline-text-3" id="text-3-2">
<ol class="org-ol">
<li>Get your editor set up to make coding assembly easier. If you are
using VS Code, the following video will show you how to install an
extension to do syntax highlighting and block comment/uncomment
operations in assembly: <a href="https://youtu.be/AgmXUFOEgIw">https://youtu.be/AgmXUFOEgIw</a></li>
<li>Be disciplined about your register use: comment what "variables" are
in which registers as it is up to you to keep track. The #1 advice
from past students to future students is "<b>Comment the Crap out of
your assembly code</b>" on this project.</li>
<li><p>
Be Careful with constants: forgetting a <code>$</code> in constants will lead
to a bare, absolute memory address which will likely segfault your
program.  Contrast:
</p>
<div class="org-src-container">
<pre class="src src-asm">   movq    $0,%rax                 # rax = 0
   movq    0, %rax                 # rax = *(0): segfault
                                   # bare 0 is memory address 0 - out of bounds
</pre>
</div>
<p>
Running your programs, assembly code included, in Valgrind can help
to identify these problems. In Valgrind output, look for a line
number in the assembly code which has absolute memory addresses or a
register that has an invalid address.
</p></li>
<li><p>
Recognize that in x86-64 function parameters are passed in registers
for up to 6 arguments. These are arranged as follows
</p>
<ol class="org-ol">
<li><code>rdi / edi / di</code> (arg 1)</li>
<li><code>rsi / esi / si</code> (arg 2)</li>
<li><code>rdx / edx / dx</code> (arg 3)</li>
<li><code>rcx / ecx / cx</code> (arg 4)</li>
<li><code>r8 / r8d / r8w</code> (arg 5)</li>
<li><code>r9 / r9d / r9w</code> (arg 6)</li>
</ol>
<p>
and the specific register corresponds to how argument sizes (64 bit
args in <code>rdi</code>, 32 bit in <code>edi</code>, etc). The functions you will write
have few arguments so they will all be in registers.
</p></li>
<li><p>
Use registers sparingly.  The following registers (64-bit names) are
"scratch" registers or "caller save." Functions may alter them
freely (though some may contain function arguments).
</p>
<pre class="example">
rax rcx rdx rdi rsi r8 r9 r10 r11  # Caller save registers
</pre>

<p>
No special actions need to be taken at the end of the function
regarding these registers except that <code>rax</code> should contain the
function return value.
</p>

<p>
Remaining registers are "callee save": if used, their original
values must be restored before returning from the function.
</p>
<pre class="example">
rbx rbp r12 r13 r14 r15            # Callee save registers
</pre>

<p>
This is typically done by pushing the callee registers to be used on
the stack, using them, them popping them off the stack in reverse
order. Avoid this if you can (and you probably can in our case).
</p></li>
<li>Be careful to adjust the stack pointer using <code>pushX/popX</code> or
<code>subq/addq</code> . Keep in mind the stack must be aligned to 16-byte
boundaries for function calls to work correctly.  Above all, don't
treat <code>rsp</code> as a general purpose register.</li>
<li>Note carefully which function use which conventions for struct
arguments; e.g. pointers to structs VERSUS actual structs. Use
appropriate assembly techniques to access fields each (they are not
the same).</li>
<li><p>
To access a global variable and copy it into a register, use the
following assembly syntax
</p>
<div class="org-src-container">
<pre class="src src-asm">   movw GLOB_VAR_NAME(%rip), %cx    # copy global var to reg cx
</pre>
</div>
<p>
Many functions access the global PORT variables but only a few
change those variables.
</p></li>
<li>Use comparisons and jumps a separate sections of code that are
clearly marked as "error" or "out of bounds" if you detect bad
arguments to functions.</li>
<li>When required, used bit shifting and masking to efficiently perform
division by powers of two and check for remainders if rounding is
required.</li>
<li>Make use of division to extract digits in base 10 if the situation
requires it. Keep in mind that the <code>idivX</code> instruction must have
<code>rax/eax/ax</code> as the dividend, <code>rdx</code> sign-extended out via <code>cwtl /
    cltq / cqto</code> instructions. Any register can contain the <code>divisor</code>.
After the instruction, <code>rax/eax/ax</code> will hold the <code>quotient</code> and
<code>rdx/edx/dx</code> the remainder.  With cleverness, you'll only need to
do a couple divisions.</li>
<li>Use shifts and ORs to combine the digit bit patterns to create the
final display bit pattern.</li>
<li><p>
The final function in the problem requires the previous functions
to be called to to create the struct and manipulate the bits of
the display.  Calling a function requires that the stack be
aligned to 16-bytes; there is always an 8-byte quantity on the
stack (previous value of the <code>rsp</code> stack pointer).  This means the
stack must be extended with a <code>subq</code> instruction before any
calls. A typical sequence is
</p>
<div class="org-src-container">
<pre class="src src-asm">    subq $&lt;NUM&gt;,%rsp    # adjust the stack pointer to make space for local      
                        # values AND align to a 16-byte boundary

    call    some_func   # stack aligned, call function
    ## return val from func in rax or eax

    call    other_func  # stack still aligned, call other function
    ## return val from func in rax or eax

    addq $&lt;NUM&gt;,%rsp    # restore the stack pointer to its original value
</pre>
</div>
<p>
NOTE: the specific value for <code>&lt;NUM&gt;</code> is dependent on the
situation. Common total adjustments are 8 bytes, 24 bytes, and 40
bytes. Pick one that fits the situation here: how much space for
local variables is needed in the function. Most implementations
will need space for a local struct so knowing the total size
required for it is a good start.
</p></li>
<li>Structs that are stored in the stack can be "packed" into
registers by moving their fields into those registers. For small
structs, a single <code>movq / movl / movw</code> may be enough to move the
entire struct into an argument register. For larger structs,
several moves may be required.</li>
</ol>
</div>
</div>
<div id="outline-container-org780d2a3" class="outline-3">
<h3 id="org780d2a3"><span class="section-number-3">3.3</span> Register Summary Diagram</h3>
<div class="outline-text-3" id="text-3-3">
<p>
For reference, here is a picture that appears in the lecture slides
that summarizes the names and special uses for the registers in
x86-64.
</p>

<div class="org-center">

<div id="orgaecea4f" class="figure">
<p><img src="registers.png" alt="registers.png" style="max-width:100%;" />
</p>
<p><span class="figure-number">Figure 1: </span>Summary of general purpose register usages in x86-64.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org19db8b4" class="outline-3">
<h3 id="org19db8b4"><span class="section-number-3">3.4</span> Structure of <code>scale_update_asm.s</code></h3>
<div class="outline-text-3" id="text-3-4">
<p>
Below is a rough outline of the structure of required assmebly file.
Consider copying this file as you get started and commenting parts of
it out as needed.
</p>

<div class="org-src-container">
<pre class="src src-asm">.text                           # IMPORTANT: subsequent stuff is executable
.global scale_from_ports
        
## ENTRY POINT FOR REQUIRED FUNCTION
scale_from_ports:
        ## assembly instructions here

        ## a useful technique for this problem
        movX    SOME_GLOBAL_VAR(%rip), %reg
        # load global variable into register
        # Check the C type of the variable
        #    char / short / int / long
        # and use one of
        #    movb / movw / movl / movq 
        # and appropriately sized destination register                                            

        ## DON'T FORGET TO RETURN FROM FUNCTIONS

### Change to definint semi-global variables used with the next function 
### via the '.data' directive
.data                           # IMPORTANT: use .data directive for data section
	
my_int:                         # declare location an single int
        .int 1234               # value 1234

other_int:                      # declare another accessible via name 'other_int'
        .int 0b0101             # binary value as per C '0b' convention

my_array:                       # declare multiple ints sequentially starting at location
        .int 20                 # 'my_array' for an array. Each are spaced 4 bytes from the
        .int 0x00014            # next and can be given values using the same prefixes as 
        .int 0b11110            # are understood by gcc.


## WARNING: Don't forget to switch back to .text as below
## Otherwise you may get weird permission errors when executing 

.text
.global  scale_display_special

## ENTRY POINT FOR REQUIRED FUNCTION
scale_display_special:
        ## assembly instructions here

	## two useful techniques for this problem
        movl    my_int(%rip),%eax    # load my_int into register eax
        leaq    my_array(%rip),%rdx  # load pointer to beginning of my_array into rdx
        ## DON'T FORGET TO RETURN FROM FUNCTIONS


.global  scale_display_weight

## ENTRY POINT FOR REQUIRED FUNCTION
scale_display_weight:

        ## DON'T FORGET TO RETURN FROM FUNCTIONS



.global scale_update
        
## ENTRY POINT FOR REQUIRED FUNCTION
scale_update:
	## assembly instructions here
        ## DON'T FORGET TO RETURN FROM FUNCTIONS
</pre>
</div>
</div>
</div>
<div id="outline-container-orgedb0b5a" class="outline-3">
<h3 id="orgedb0b5a"><span class="section-number-3">3.5</span> Documentation Of Functions</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Below is a repeat of the documentation from project 2 on the expected
behavior of the required functions.
</p>

<div class="org-src-container">
<pre class="src src-c">// scale_update.c: functions that read scale hardware, convert its
// encode its state in a struct, and adjusts the display to show the
// user information.

#include "scale.h"

int scale_from_ports(scale_t *scale);
// Uses the values in SCALE_SENSOR_PORT, SCALE_TARE_PORT, and
// SCALE_STATUS_PORT to set the fields of the `scale` struct to
// appropriate values. 
//
// Does bound checking so that if the SCALE_SENSOR_PORT or
// SCALE_TARE_PORT is out of range (see their docs) sets the fields of
// scale to be 0's, sets the scale-&gt;mode to be MODE_ERROR, and
// returns 1. 
//
// If SCALE_STATUS_PORT indicates the Tare button is being pressed
// (see that variable's docs), sets fields of `scale` to be 0, sets
// the mode to be MODE_TARE, and returns 2.
//
// Otherwise sets the fields of scale as follows.
//
// - mode :: set to MODE_SHOW to show the display weight as normal
//
// - weight :: set to (SCALE_SENSOR_PORT - SCALE_TARE_PORT).  Converts
//   to pounds if SCALE_STATUS_PORT indicates that is the desired
//   unit. Conversion is done using bit shifting / masking and rounds
//   pounds up if the ounces are halfway to the next pound.
//
// - indicators :: sets a bit to turn on either the Ounce or Pound
//   Indicator light. If the SCALE_TARE_PORT is not zero, sets a bit
//   to turn on the Tare indicator light. See documentation for the
//   scale_t struct for which bits control which indicator lights.
//
// Returns 0 when `scale` has its field set as above.
// 
// CONSTRAINTS: Uses only integer operations. No floating point
// operations are used as the target machine does not have a FPU. Does
// not use any math functions such as abs().
//
// CONSTRAINTS: Does not use integer division; uses bit shifting and
// masking to compute division by powers of two and perform rounding.

int scale_display_special(scale_t scale, int *display);
// Sets the bits pointed at by `display to indicate one of two
// "special" cases.
//
// If scale.mode is MODE_ERROR, sets the display to "ERR" to indicate
// that the weight is out of range or some other hardware error has
// occurred.
//
// If scale.mode is MODE_TARE, sets the display to "STOR" to indicate
// that the Tare button is being pressed and the current weight will be
// stored in the internal saved weight space.
//
// In both the above cases, only changes the bits pointed at by
// `display` and returns 0. Does not make any other changes to the
// machine state.
//
// If scale.mode is a different value that one of the above two cases,
// this function has been called in error and returns 1.
//
// CONSTRAINT: This function should not access or change any global
// PORT variables.

int scale_display_weight(scale_t scale, int *display);
// Called when scale.mode is MODE_SHOW. If it is not, this function
// returns 1 immediately and makes no other changes.
//
// For scale.mode of MODE_SHOW, sets `display` bits to indicate the
// weight in scale.weight. Uses integer division to determine digits
// to be shown in `display` and whether a negative sign should be
// present. Sets bits of `display` according to the bits in
// scale.indicators to show ounces / pounds as the unit and indicate a
// non-zero tare. Returns 0 on completion.
//
// CONSTRAINT: This function should not access or change any global
// PORT variables. It may use a global array of bit patterns if deemed
// useful.

int scale_update();
// Updates the state of scale using previously defined functions. Uses
// stack space for a scale_t struct which is set from the ports and
// then used to alter the display. If the MODE_TARE is indicated, then
// copies SCALE_SENSOR_PORT to SCALE_TARE_PORT. Returns 0 if the
// display is set properly and 1 if an error occurs while setting the
// display. 
//
// CONSTRAINT: Does not allocate any heap memory as malloc() is NOT
// available on the target microcontroller.  Uses only stack memory
// for local variables.

</pre>
</div>
</div>
</div>
<div id="outline-container-org95b055b" class="outline-3">
<h3 id="org95b055b"><span class="section-number-3">3.6</span> Accessing Struct Fields in Assembly</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Accessing struct fields in C involves use of either the dot (<code>.</code>) or
arrow (<code>-&gt;</code>) field access operators depending on whether the struct is
locally stored (an "actual struct") or is available via its memory
location (a "pointer to a struct"). In assembly, different techniques
are also required. These are <b>demonstrated in a recent Lab and
students wanting a quick overview should review that lab</b>. The
provided header file has tables of where the struct fields for the
required data types are stored. These are show below for quick
reference:
</p>


<div class="org-src-container">
<pre class="src src-c">
////////////////////////////////////////////////////////////////////////////////
// scale data and structs

#define UNIT_KG 1               // show kilograms
#define UNIT_LB 2               // show pounds (2.2 pounds per kg)

#define MODE_SHOW      1        // show measured weight as sensor_val - tare_val 
#define MODE_TARE      2        // store the sensor_val into tare_val, Tare Indicator on
#define MODE_ERROR     4        // error of some kind

// store state of the scale in a struct for easier access
typedef struct{
  short weight;            // calculated weight for use elsewhere
  char mode;               // one of the MODE_XX values indicating what to do/show
  char indicators;         // Bit field with 1's for different indicators
  // Bit 0: Ounce Indicator On/Off
  // Bit 1: Pound Indicator On/Off
  // Bit 2: Tare Indicator On/Off, on when stored Tare value is non-zero
} scale_t;

// Accessing fields via a scale_t * pointer
// |-------------------+----------+-------------+-------------------|
// |                   |          | Destination | Assembly          |
// | C Field Access    | Offset   | Size        | Assign 5 to field |
// |-------------------+----------+-------------+-------------------|
// | scale-&gt;weight     | 0 bytes  | 2 bytes     | movw $5, 0(%reg)  |
// | scale-&gt;mode       | 2 bytes  | 1 bytes     | movb $5, 2(%reg)  |
// | scale-&gt;indicators | 3 bytes  | 1 bytes     | movb $5, 3(%reg)  |
// |-------------------+----------+-------------+-------------------|
//
// Accessing fields via a scale_t packed struct
// |------------------+--------+-------------+---------|
// |                  |   Bits | Shift       |         |
// | C Field Access   | in reg | Required    | Size    |
// |------------------+--------+-------------+---------|
// | scale.weight     |   0-15 | None        | 2 bytes |
// | scale.mode       |  16-23 | Right by 16 | 1 byte  |
// | scale.indicators |  24-31 | Right by 24 | 1 byte  |
// |------------------+--------+-------------+---------|
//
</pre>
</div>
</div>
</div>
<div id="outline-container-org41033ff" class="outline-3 grading 60">
<h3 id="org41033ff"><span class="section-number-3">3.7</span> Grading Criteria for Problem 1&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading">grading</span>&#xa0;<span class="60">60</span></span></h3>
<div class="outline-text-3" id="text-3-7">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Weight</th>
<th scope="col" class="org-left">Criteria</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">AUTOMATED TESTS</td>
</tr>

<tr>
<td class="org-right">20</td>
<td class="org-left"><code>make test-prob1</code> which uses programs <code>test_scale_update</code> and <code>scale_main</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Provides 40 tests for functions in <code>scale_update_asm.c</code> and their use in <code>main()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">0.5 point per test passed</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">MANUAL INSPECTION CRITERIA</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">General Criteria for all Functions</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear signs of hand-crafted assembly are present.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Reasonable indentation for assembly file which is mostly "flat": instructions line up, labels are offset from instructions</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Detailed documentation/comments are provided helping describe the algorithm used in the assembly</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of good label names to indicate jump targets: <code>.NEG_PORT_VALUE</code> is good, <code>.L32</code> is bad</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">High-level variables and registers they occupy are documented in comments</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Error checking on the input values is done with a clear "Error" section/label for each function</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Any callee save registers used (<code>rbx rbp r12 r13 r14 r15</code>) are pushed at the top of functions and popped at the end to restore their previous values</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left"><code>scale_from_ports()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear section or lines which perform special case analysis for <code>MODE_ERROR</code> and <code>MODE_TARE</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of correct syntax and technique to access global PORT variables</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Clear use of shift / mask instructions to convert weight form ounces to pounds; shifting and masking are both required for full credit</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Rounding performed during the conversion of ounces to pounds</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Correct syntax used to write values to the pointer to the <code>scale_t</code> struct</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left"><code>scale_display_special()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Correct syntax to access the fields of the packed struc to determine mode</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Error case analysis: if the mode is neither of <code>MODE_ERROR</code> nor <code>MODE_TARE</code>, does nothing and returns an error</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Correct syntax used to set the argument pointer to a "special" display pattern</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left"><code>scale_display_weight()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Correct syntax to access the fields of the packed struc to determine mode</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Error case analysis: if the mode is not <code>MODE_SHOW</code>, does nothing and returns an error</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of division via <code>idivX</code> to determine digits to display</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Use of an array of bit patterns established in a <code>.data</code> section to simplify display creation</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Analysis to determine whether to show leading digits (e.g. no leading 0) and where to place a "negative sign" in the display if needed</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left"><code>scale_update()</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">The stack is extended to make space available for local variables / local structs; no use of global variables for this purpose</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">The stack is properly aligned at a 16-byte boundary for function calls, likely through a <code>subq</code></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Changes to the stack for local variables / alignment are undone via a complementary <code>addq</code> instruction</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Function calls to the earlier two functions are made with appropriate arguments passed</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">There is a clear sequence of instructions that load a memory address for the first function call</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">There is a clear sequence of instructions that load a packed struct into registers for the second function call</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">There is case analysis based on the return value of functions to behave differently if needed</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Global variables such as PORTS are adjusted if needed.</td>
</tr>
</tbody>
</table>

<p>
<b>NOTE</b>: Passing all tests and earning all manual inspection criteria
will earn up to <b>5 Points of Project Makeup Credit</b> which will offset
past and future loss of credit on projects.
</p>
</div>
<div id="outline-container-org7452283" class="outline-4">
<h4 id="org7452283">Notes on Partial Credit</h4>
<div class="outline-text-4" id="text-org7452283">
<p>
Partial credit will be awarded in Manual Inspection for code that
looks functional but did not pass tests.  However, keep in mind that
tests for some functions rely on previous functions working correctly
and the provided <code>main()</code> requires all functions to work correctly in
conjunction.  There is no partial credit available for Automated Tests
even if later functions fail tests due to early functions behaving
incorrectly.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org1c4949b" class="outline-2">
<h2 id="org1c4949b"><span class="section-number-2">4</span> <b>Problem 2</b>: Puzzlebin</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org23b152b" class="outline-3">
<h3 id="org23b152b"><span class="section-number-3">4.1</span> Overview</h3>
<div class="outline-text-3" id="text-4-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">GDB Quick Guide/Assembly</td>
<td class="org-left"><a href="https://kauffman77.github.io/tutorials/gdb.html#gdb-assembly">https://kauffman77.github.io/tutorials/gdb.html#gdb-assembly</a></td>
</tr>
</tbody>
</table>

<p>
The nature of this problem is similar to the previous project's
<code>puzzlebox</code>: there is a program called <code>puzzlebin</code> which expects
certain inputs from a parameter file as input. If the inputs are
"correct", a phase will be "passed" earning points and allowing access
to a subsequent phases. The major change is that <code>puzzlebin</code> is in
binary so must be debugged in assembly. The GDB guide above has a
special section on debugging binaries which is worth reading.  The
typical startup regime is:
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; gdb -tui puzzlebin
(gdb) set args input.txt      # set the command line arguments
(gdb) layout asm              # show disassembled instructions
(gdb) layout regs             # show the register file
(gdb) break phase01           # break at the start of the first phase01
(gdb) run                     # get cracking
</pre>
</div>

<p>
Below is a summary of useful information concerning the <code>puzzlebin</code>.
</p>

<dl class="org-dl">
<dt>Input File</dt><dd>Data for input should be placed in the <code>input.txt</code>
file.  The first value in this file will be the userID (first part
of your UMD email address) which is 8 or fewer characters.</dd>
<dt>UserID Randomization</dt><dd>Each phase has some randomization based on
the UserID so that the specific answers of an one students will not
necessarily work for another student.</dd>
<dt>One Phase Input per Line</dt><dd>Place the input for each phase on its
own line. Some input phases read a whole line and then dissect it
for individual data. Putting each input on its own line ensures you
won't confuse the input processing.</dd>
<dt>Passing Phases Earns Points</dt><dd>As with the earlier <code>puzzlebox</code>,
points for this problem are earned based on how many phases are
completed. Each phase that is completed will earn points.</dd>
<dt>Use GDB to work with Puzzlebin</dt><dd>The debugger is the best tool to
work with running the given program. It may be tempting to try to
brute force the puzzlebin by trying many possible inputs but in most
cases, a little exploration will suffice to solve most phases.</dd>
<dt>The input line "SKIP" will skip a phase with a small penalty</dt><dd>Students
woefully stuck on a phase may skip it to the next phase with the
input line <code>SKIP</code>. Be aware that this applies a small penalty to the
overall score AND changes the state of the random number generator
so that if you revisit an earlier skipped phase, answers to later
phases may change.</dd>
</dl>
</div>
</div>
<div id="outline-container-orgea6b1fe" class="outline-3">
<h3 id="orgea6b1fe"><span class="section-number-3">4.2</span> Permission Denied Errors</h3>
<div class="outline-text-3" id="text-4-2">
<p>
In some cases, the process of zipping an executable like <code>puzzliebin</code>
then unzipping it leads to the permissions on it being set
incorrectly.  Below is a common permissions error and how to fix it by
changing the permissions on <code>puzzlebin</code>.
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; ./puzzlebin input.txt
bash: ./puzzlebin: Permission denied

# Permission error on puzzlebin: it is not set to be executable. The
# fix is:

&gt;&gt; chmod u+x puzzlebin
# Manually add the execute 'x' permission
# OR
&gt;&gt; make
chmod u+x puzzlebin
# use the provided Makefile to run that command

&gt;&gt; ./puzzlebin input.txt
========================================
Puzzlebin (release Tue 10-Oct-2024)
'YOUR_DIRECTORY_ID' is a userID and must be max 8 characters
# Now running normally albeit with the need to modify the input file
</pre>
</div>
</div>
</div>
<div id="outline-container-org611779c" class="outline-3 grading 40">
<h3 id="org611779c"><span class="section-number-3">4.3</span> Puzzlebin Scoring&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grading">grading</span>&#xa0;<span class="40">40</span></span></h3>
<div class="outline-text-3" id="text-4-3">
<p>
Scoring is done according to the following table.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Pts</th>
<th scope="col" class="org-left">Phase</th>
<th scope="col" class="org-left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">5</td>
<td class="org-left">Phase 1</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Phase 2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">Phase 3</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">Phase 4</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">Phase 5</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">Phase 6</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">10</td>
<td class="org-left">Phase 7</td>
<td class="org-left">Not Required</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">???</td>
<td class="org-left">Additional Makeup credit if you can find it</td>
</tr>

<tr>
<td class="org-right">-1</td>
<td class="org-left">SKIP</td>
<td class="org-left">Penalty for using SKIP to bypass a phase</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">40</td>
<td class="org-left">60 Max</td>
<td class="org-left">40 point for full credit, 20 MAKEUP Credit available</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgf8465cc" class="outline-3">
<h3 id="orgf8465cc"><span class="section-number-3">4.4</span> Advice and Hints</h3>
<div class="outline-text-3" id="text-4-4">
<ul class="org-ul">
<li><p>
Most of the time you should run <code>puzzlebin</code> in <code>gdb</code> as in
</p>
<div class="org-src-container">
<pre class="src src-sh">  &gt;&gt; gdb -tui ./puzzlebin
</pre>
</div>
<p>
Refer to the <a href="https://kauffman77.github.io/tutorials/gdb.html">Quick Guide to GDB</a> if you have forgotten how to use
<code>gdb</code> and pay particular attention to the sections on debugging
assembly.
</p></li>
<li>Most phases process input via calls to <code>scanf()</code>-style
functions. Quick insight to the expected input for a phase comes
from analyzing the format strings like <code>"%d %d"</code>
and <code>"%s %f %d"</code> to those calls. Figure out how to do this early so
you can determine the quantity and types of input to each phase.</li>
<li>It is worthwhile to look at the Failure Messages when a phase is not
going to be passed. These are passed to the <code>failure()</code> function:
printing them out may give you some hints.</li>
<li>Make use of other tools to analyze puzzlebin aside from the
debugger.  Some of these like <code>strings</code> are described at the end of
the <a href="https://kauffman77.github.io/tutorials/gdb.html">Quick Guide to GDB</a>. They will allow you to search for
"interesting" data in the executable <code>puzzlebin</code>.</li>
<li><b>Disassemble</b> the executable to look at its entire source assembly code
as a text file. The Quick Guide to GDB shows how to use <code>objdump</code> to
do this. Looking at the whole source code reveals that one cannot
hide <b>secrets</b> easily in programs.</li>
<li>Feel free to do some internet research.  There is a well-known
"Binary Bomb Lab" assignment by Bryant and O'Hallaron, our textbook
authors, that inspired Puzzlebin. It has a long history and there
are some useful guides out there that can help you through rough
patches. Keep in mind that your code will differ from any online
tutorials BUT the techniques to defuse it may be similar to what is
required to solve puzzles.</li>
</ul>
</div>
</div>
<div id="outline-container-org58be2c0" class="outline-3">
<h3 id="org58be2c0"><span class="section-number-3">4.5</span> Compatibility</h3>
<div class="outline-text-3" id="text-4-5">
<p>
<code>puzzlebin</code> is a binary executable file and these are always a bit
flaky to distribute as is. It has been tested on GRACE and is know to
run normally there and is likely to run normally on most Linux
systems. If you see strange behavior on a different Linux platform
such as segmentation faults, revert to working on GRACE to for
immediate relief but also email Prof. Kauffman resolving
incompatibilities is of interest.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/> <i> <a href="https://www.umd.edu/web-accessibility" title="UMD Web Accessibility">Web Accessibility</a> <br/> Author: Chris Kauffman (<a href="mailto:profk@umd.edu">profk@umd.edu</a>) <br/> Date: 2025-03-24 Mon 16:10 <br/> </i>
</div>
</body>
</html>
